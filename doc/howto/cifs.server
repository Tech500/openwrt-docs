<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>Samba [OpenWrt Wiki]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="doc,howto,cifs.server"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="OpenWrt Wiki"/>
<link rel="start" href="../../index.html"/>
<link rel="contents" href="cifs.server?do=index" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Recent changes" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="../../feed.php?mode=list&amp;ns=doc:howto"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/doc/howto/cifs.server"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../../_export/raw/doc/howto/cifs.server"/>
<link rel="canonical" href="cifs.server"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php?t=openwrt&amp;tseed=6f44f363dc87908d905dc56ff3acbfc4"/>
<script type="text/javascript">/*<![CDATA[*/var NS='doc:howto';var JSINFO = {"id":"doc:howto:cifs.server","namespace":"doc:howto"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php?tseed=6f44f363dc87908d905dc56ff3acbfc4"></script>
<script type="text/javascript" charset="utf-8">/*<![CDATA[*/jQuery(function(){
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1432266538 166.182.3.136';
			document.forms[i].appendChild(myElement);
		}
	}
});
/*!]]>*/</script>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../../lib/tpl/openwrt/images/favicon.ico" />
<link rel="apple-touch-icon" href="../../lib/tpl/openwrt/images/apple-touch-icon.png" />
    </head>

<body>
    <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_openwrt     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="cifs.server#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="../../start"  accesskey="h" title="[H]"><img src="../../lib/tpl/openwrt/images/logo.png" width="386" height="98" alt="" /> <span>OpenWrt Wiki</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="cifs.server?do=register"  class="action register" rel="nofollow" title="Register">Register</a></li><li><a href="cifs.server?do=login&amp;sectok=382740b13d95f946eed36caa57076b4a"  class="action login" rel="nofollow" title="Login">Login</a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="../../start" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="../../doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="doc:howto:cifs.server" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Show pagesource</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Login</option><option value="register">Register</option></optgroup></select><input type="submit" value="&gt;" /></div></form>            </div>
            <ul>
                <li><a href="cifs.server?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a></li><li><a href="cifs.server?do=media&amp;ns=doc%253Ahowto"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a></li><li><a href="cifs.server?do=index"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                            <div class="youarehere"><span class="bchead">You are here: </span><span class="home"><bdi><a href="../../start" class="wikilink1" title="start">OpenWrt Wiki</a></bdi></span> » <bdi><a href="../start" class="wikilink1" title="doc:start">Documentation</a></bdi> » <bdi><a href="start" class="wikilink1" title="doc:howto:start">HOWTOs</a></bdi> » <bdi><span class="curid"><a href="cifs.server" class="wikilink1" title="doc:howto:cifs.server">Samba</a></span></bdi></div>
                                    <div class="plugin_multilingual">
        <ul>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/cz/doc/howto/cifs.server" class="media" title="cz:doc:howto:cifs.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=aff589&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fcz.gif" class="media" title="Čeština (Czech)" alt="Čeština (Czech)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/de/doc/howto/cifs.server" class="media" title="de:doc:howto:cifs.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=e24010&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fde.gif" class="media" title="Deutsch (German)" alt="Deutsch (German)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <span class="curid"><a href="cifs.server" class="media" title="doc:howto:cifs.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=2a37ae&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fgb.gif" class="media" title="English" alt="English" /></a></span>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/es/doc/howto/cifs.server" class="media" title="es:doc:howto:cifs.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=46c004&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fmx.gif" class="media" title="Español (Spanish, Mexico)" alt="Español (Spanish, Mexico)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/fr/doc/howto/cifs.server" class="media" title="fr:doc:howto:cifs.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=a5beba&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ffr.gif" class="media" title="Français (French)" alt="Français (French)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/hu/doc/howto/cifs.server" class="media" title="hu:doc:howto:cifs.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=6b5470&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fhu.gif" class="media" title="Magyar (Hungarian)" alt="Magyar (Hungarian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/jp/doc/howto/cifs.server" class="media" title="jp:doc:howto:cifs.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f999fc&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fjp.gif" class="media" title="日本語 (Japanese)" alt="日本語 (Japanese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pl/doc/howto/cifs.server" class="media" title="pl:doc:howto:cifs.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=c805c0&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fpl.gif" class="media" title="Poliski (Polish)" alt="Poliski (Polish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pt-br/doc/howto/cifs.server" class="media" title="pt-br:doc:howto:cifs.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=13127d&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fbr.gif" class="media" title="Português brasileiro (Portuguese, Brasil)" alt="Português brasileiro (Portuguese, Brasil)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/ru/doc/howto/cifs.server" class="media" title="ru:doc:howto:cifs.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=66ab5e&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fru.gif" class="media" title="Русский (Russsian)" alt="Русский (Russsian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/tr/doc/howto/cifs.server" class="media" title="tr:doc:howto:cifs.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f4beed&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ftr.gif" class="media" title="Tϋrkçe (Turkish)" alt="Tϋrkçe (Turkish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-cn/doc/howto/cifs.server" class="media" title="zh-cn:doc:howto:cifs.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=93625a&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-cn.gif" class="media" title="官話/官话 (Chinese)" alt="官話/官话 (Chinese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-tw/doc/howto/cifs.server" class="media" title="zh-tw:doc:howto:cifs.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=b56198&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-tw.gif" class="media" title="臺灣華語 (Taiwanese)" alt="臺灣華語 (Taiwanese)" /></a>
              </div>
            </div>
          </li>
        </ul>
      </div>
        </div>
    
    
    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">

                <div class="pageId"><span>doc:howto:cifs.server</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="cifs.server#preparations">Preparations</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="cifs.server#prerequisites">Prerequisites</a></div></li>
<li class="level2"><div class="li"><a href="cifs.server#required_packages">Required Packages</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="cifs.server#server_openwrt">Server (OpenWrt)</a></div></li>
<li class="level3"><div class="li"><a href="cifs.server#client_your_pcs">Client (your PCs)</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="cifs.server#configuration">Configuration</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="cifs.server#custom_configuration_surpassing_the_uci_configuration">Custom configuration surpassing the UCI configuration</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="cifs.server#start_on_boot">Start on Boot</a></div></li>
<li class="level1"><div class="li"><a href="cifs.server#troubleshooting">Troubleshooting</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="cifs.server#set_security_to_share">Set security to share</a></div></li>
<li class="level2"><div class="li"><a href="cifs.server#localhost">Localhost</a></div></li>
<li class="level2"><div class="li"><a href="cifs.server#browsing_shares_fails">Browsing shares fails</a></div></li>
<li class="level2"><div class="li"><a href="cifs.server#cannot_write_to_the_samba_share">Cannot write to the Samba share</a></div></li>
<li class="level2"><div class="li"><a href="cifs.server#international_characters_support">International Characters Support</a></div></li>
<li class="level2"><div class="li"><a href="cifs.server#throughput_issues">Throughput Issues</a></div></li>
<li class="level2"><div class="li"><a href="cifs.server#mac_network_discovery_issues">Mac Network Discovery Issues</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="cifs.server#notes">Notes</a></div></li>
<li class="level1"><div class="li"><a href="cifs.server#example">Example</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="samba">Samba</h1>
<div class="level1">

<p>
Samba is a free and open-source implementation of <a href="http://en.wikipedia.org/wiki/Server Message Block" class="interwiki iw_wp" title="http://en.wikipedia.org/wiki/Server Message Block">SMB/CIFS</a>. As of version 3, Samba provides file and print services over network which can be accessed by Windows, Unix and MacOS X clients. Alternatives are <a href="nfs.server" class="wikilink1" title="doc:howto:nfs.server">NFS</a> and <a href="sshfs.server" class="wikilink1" title="doc:howto:sshfs.server">SSHFS</a>.
</p>

<p>
<img src="../../lib/images/smileys/icon_exclaim.gif" class="icon" alt=":!:" /> It is hence <strong>strongly recommended</strong> that you use LuCI to establish the initial configuration and then edit the template file (/etc/samba/smb.conf.template) via LuCI Edit Template tab or from the shell as needed.
</p>

<p>
If luci-app-samba not working or can&#039;t find in web gui - &gt; type &quot;rm /tmp/luci-indexcache&quot; or restart router. 
</p>

</div>

<h2 class="sectionedit2" id="preparations">Preparations</h2>
<div class="level2">

</div>

<h3 class="sectionedit3" id="prerequisites">Prerequisites</h3>
<div class="level3">

<p>
Presuming you want to connect a USB harddisc to the device and then access its contents over the cifs protocol, you need to hook up that drive first:
</p>
<ol>
<li class="level1"><div class="li"> <a href="usb.essentials" class="wikilink1" title="doc:howto:usb.essentials">usb.essentials</a>  obtain basic support for the USB.</div>
</li>
<li class="level1"><div class="li"> <a href="usb.storage" class="wikilink1" title="doc:howto:usb.storage">usb.storage</a>  obtain support for USB storage and mount local filesystem</div>
</li>
<li class="level1"><div class="li"> Configure <code><a href="../uci/firewall" class="wikilink1" title="doc:uci:firewall">/etc/config/firewall</a></code> to open the following ports (if your <abbr title="Local Area Network">LAN</abbr> access is rejected by default):</div>
<ul>
<li class="level2"><div class="li"> TCP 137 - NetBIOS Name Service</div>
</li>
<li class="level2"><div class="li"> TCP 138 - NETBIOS Datagram Service</div>
</li>
<li class="level2"><div class="li"> TCP 139 - NETBIOS Session Service</div>
</li>
<li class="level2"><div class="li"> TCP 445 - Microsoft Directory Services</div>
</li>
</ul>
</li>
</ol>
<div class="table sectionedit4"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>config &#039;rule&#039;
        option &#039;src&#039; &#039;lan&#039;
        option &#039;proto&#039; &#039;udp&#039;
        option &#039;dest_port&#039; &#039;137-138&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;src&#039; &#039;lan&#039;
        option &#039;proto&#039; &#039;tcp&#039;
        option &#039;dest_port&#039; &#039;139&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;src&#039; &#039;lan&#039;
        option &#039;proto&#039; &#039;tcp&#039;
        option &#039;dest_port&#039; &#039;445&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;
</code></td>
	</tr>
</table></div>

</div>

<h3 class="sectionedit5" id="required_packages">Required Packages</h3>
<div class="level3">

</div>

<h4 id="server_openwrt">Server (OpenWrt)</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"><strong><code>samba??-server</code></strong> ←- check current available version using opkg list | grep -i samba</div>
</li>
<li class="level1"><div class="li"><strong><code>kmod-fs-????</code></strong> Kernel module for the <a href="http://en.wikipedia.org/wiki/file system" class="interwiki iw_wp" title="http://en.wikipedia.org/wiki/file system">file system</a> with which the partition, you want to grant access to with samba, is formated</div>
</li>
<li class="level1"><div class="li"><strong><code>luci-app-samba</code></strong> (<em>optional</em>) Configure from within the web interface <a href="../luci" class="wikilink1" title="doc:howto:luci.essentials">LuCI</a>.</div>
</li>
</ul>

</div>

<h4 id="client_your_pcs">Client (your PCs)</h4>
<div class="level4">

<p>
Windows and most GNU/Linux distribution come with pre-installed support for this. So does MacOS X since version 10.2. In case your distribution is missing support, you need to install the client software. ArchLinux offers a Wikipage: <a href="https://wiki.archlinux.org/index.php/Samba#Configuration" class="urlextern" title="https://wiki.archlinux.org/index.php/Samba#Configuration"  rel="nofollow">https://wiki.archlinux.org/index.php/Samba#Configuration</a>.
</p>

</div>

<h2 class="sectionedit6" id="configuration">Configuration</h2>
<div class="level2">

<p>
→<code><a href="../uci/samba" class="wikilink1" title="doc:uci:samba">/etc/config/samba</a></code> After modifying any of the config files, restart samba so that your changes take place:
</p>

<p>
<pre class="code">/etc/init.d/samba restart</pre>

</p>

<p>
<strong><code>Info:</code></strong> When samba is restarted that way, the file <code>/etc/samba/smb.conf</code> is created/recreated conform to the uci configuration file and <code>/etc/samba/smb.conf.template</code>, and the new settings will take effect.
</p>

<p>
Create samba users by adding them to /etc/passwd and /etc/group then using <code>smbpasswd</code> to set passwords and add to samba. Setup shared directories permissions according to your needs using <code>chown</code> and <code>chmod</code>. Any unknown usernames used for authentication against samba are mapped to a guest login silently by default.
</p>

</div>

<h3 class="sectionedit7" id="custom_configuration_surpassing_the_uci_configuration">Custom configuration surpassing the UCI configuration</h3>
<div class="level3">

<p>
Samba is the only built in way to share resources between computers running Microsoft Windows. Even in a professional environment. Thus it can be <em>very</em> complicated to configure! It is also not the protocol of choice to accomplish that task in a Linux/Mac environment. So, if for whatever reasons above configuration does not give you desired access to your configured shares, you can of course circumvent the uci system and hack the original samba configuration files instead or in addition. There may be entries which do not have a counterpart in UCI (yet) and thus can only be configured that way. Just bear in mind, that the uci config will overwrite the values configured with it (but not the whole configuration) at every boot up! If you want configure samba directly with <code>/etc/samba/smb.conf</code> instead of <code>/etc/config/samba</code>, it is possible to make changes to the smb.conf survive a reboot using the procedure below.
</p>

<p>
First, prevent OpenWrt from starting samba at boot time, thus overwriting <code>/etc/samba/smb.conf</code> with the settings in the uci file <code>/etc/config/samba</code>:
</p>

<p>
<pre class="code">/etc/init.d/samba disable</pre>

</p>

<p>
Then add the following lines to /etc/rc.local to allow smbd and nmbd to start at boot time, using <code>/etc/samba/smb.conf</code> as the configuration file
</p>

<p>
<pre class="code">smbd -D
nmbd -D</pre>

</p>

<p>
Now edit your <code>/etc/samba/smb.conf</code> all you like without worrying they will be lost the next time you reboot!
</p>

</div>

<h2 class="sectionedit8" id="start_on_boot">Start on Boot</h2>
<div class="level2">

<p>
Same procedure as with most OpenWrt packages: The first command will create a symlink <code>/etc/rc.d/S60samba</code>, the second will only start samba right now.
</p>

<p>
<pre class="code">/etc/init.d/samba enable
/etc/init.d/samba start</pre>

</p>

</div>

<h2 class="sectionedit9" id="troubleshooting">Troubleshooting</h2>
<div class="level2">
<ol>
<li class="level1"><div class="li"> is the partition you want to share mounted correctly? Check →<code><a href="../uci/fstab" class="wikilink1" title="doc:uci:fstab">/etc/config/fstab</a></code> again.</div>
</li>
<li class="level1"><div class="li"> does the samba-daemon have (read or write) access to the partition?</div>
</li>
<li class="level1"><div class="li"> is samba running?</div>
<ol>
<li class="level2"><div class="li"> <code>ps aux</code> should show <code>smbd -D</code> and <code>nmbd -D</code> up and running</div>
</li>
</ol>
</li>
<li class="level1"><div class="li"> <strong>is your samba configuration right</strong>?</div>
</li>
<li class="level1"><div class="li"> does your firewall allow clients to access the service on your router?</div>
</li>
</ol>

<p>
While using a Windows 7 client, you may have troubles accessing the network shares when samba is set to user security, especially when using the &quot;Map Network Drive&quot; option from within Explorer. To circumvent this problem, try logging, choose to login using different credentials and type your username all in caps.
</p>

<p>
If this still doesn&#039;t work, on the Windows 7 client(s) start a command shell (Win+R, type cmd and press enter), then issue the following command:
</p>

<p>
<pre class="code">net use R: \\openwrt\&lt;share&gt; /USER:&lt;USERNAME&gt; &lt;password&gt;</pre>

</p>

<p>
If you changed your router hostname, openwrt must be changed accordingly. <strong>&lt;share&gt;</strong> is the name of the share, as you have configured it using Luci or otherwise. <strong>&lt;USERNAME&gt;</strong> is the username you have added to the /etc/passwd name, and must be spelled all in caps. <strong>&lt;password&gt;</strong> is the one you set using smbpasswd.
</p>

</div>

<h3 class="sectionedit10" id="set_security_to_share">Set security to share</h3>
<div class="level3">

<p>
Some hints in advance: If you installed all needed packages, configured samba per UCI and it still does not work at all, have a look at the file /etc/samba/smb.conf.template. Change the entry <em>security</em> from <code>user</code> to <code>share</code>, restart the daemons and try accessing it directly: In <em>windows explorer</em> type <code>\\router_ip</code> in the address bar. In <em>nautilus</em> or <em>dolphin</em> press &lt;CTRL&gt;+&lt;L&gt; and type <code>smb://router_ip/</code> into the address bar.
</p>

<p>
Instead of looking up the whole configuration step by step, you maybe want to have a look at <a href="http://samba.org/samba/docs/man/Samba-Guide/ExNetworks.html" class="urlextern" title="http://samba.org/samba/docs/man/Samba-Guide/ExNetworks.html"  rel="nofollow">Samba.org: Example Network Configurations</a>. Chapter 1: No-Frills Samba Servers. Notice that you can already achieve a great deal of security by neatly setting up the <a href="../uci/firewall" class="wikilink1" title="doc:uci:firewall">firewall</a>  <img src="../../lib/images/smileys/icon_cool.gif" class="icon" alt="8-)" />
</p>

</div>

<h3 class="sectionedit11" id="localhost">Localhost</h3>
<div class="level3">

<p>
If samba does not start, try adding your router&#039;s name and ip in /etc/hosts.
(see also <a href="http://forum.openwrt.org/viewtopic.php?id=5401" class="urlextern" title="http://forum.openwrt.org/viewtopic.php?id=5401"  rel="nofollow">http://forum.openwrt.org/viewtopic.php?id=5401</a>)
</p>

</div>

<h3 class="sectionedit12" id="browsing_shares_fails">Browsing shares fails</h3>
<div class="level3">

<p>
When samba is configured, the shares are set browse-able, but they still don&#039;t appear when browsing the network, then it may be that <code>local master = yes</code> is missing from <code>/etc/samba/smb.conf.template</code>. Also check if <code>preferred master = yes</code> is in <code>/etc/samba/smb.conf.template</code>.
</p>

</div>

<h3 class="sectionedit13" id="cannot_write_to_the_samba_share">Cannot write to the Samba share</h3>
<div class="level3">

<p>
If you cannot write to the share, samba may not have the proper permissions to write to the shared folder.  
</p>

<p>
Some have reported success by modifying the permissions and owner of the folder:
</p>

<p>
<pre class="code">chmod -R 777 /mnt/sda1
chown -R nobody /mnt/sda1</pre>

</p>

<p>
If you are sharing a drive mounted wish fstab, you may need to modify <strong>/etc/config/fstab</strong> to include &#039;umask=000&#039; in the options section.
</p>
<div class="table sectionedit14"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code>config &#039;mount&#039;
        option &#039;options&#039; &#039;rw,umask=000&#039;
        option &#039;enabled_fsck&#039; &#039;0&#039;
        option &#039;enabled&#039; &#039;1&#039;
        option &#039;device&#039; &#039;/dev/scsi/host0/bus0/target0/lun0/part1&#039;
        option &#039;target&#039; &#039;/mnt/usbdisk&#039;
        option &#039;fstype&#039; &#039;vfat</code>&#039; </td>
	</tr>
</table></div>

<p>
More info here:
<a href="https://forum.openwrt.org/viewtopic.php?id=26625" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=26625"  rel="nofollow">https://forum.openwrt.org/viewtopic.php?id=26625</a>
</p>

</div>

<h3 class="sectionedit15" id="international_characters_support">International Characters Support</h3>
<div class="level3">

<p>
I&#039;ve replaced
</p>
<div class="table sectionedit16"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code>     unix charset = ISO-8859-1</code> </td>
	</tr>
</table></div>

<p>
with
</p>
<div class="table sectionedit17"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code>     unix charset = UTF-8</code> </td>
	</tr>
</table></div>

<p>
in the <code>/etc/samba/smb.conf.template</code> file and I can now read and write files and folders with accented characters.
</p>

</div>

<h3 class="sectionedit18" id="throughput_issues">Throughput Issues</h3>
<div class="level3">

<p>
Since <a href="netfilter" class="wikilink1" title="doc:howto:netfilter">netfilter</a> will track every connection, if you use MASQUERADING for example, you should disable con-tracking for data connections. The basic idea looks likes this, you must adapt this to your firewall setting.
<pre class="code bash"><span class="re1">$IPT</span> <span class="re5">-t</span> raw <span class="re5">-A</span> OUTPUT <span class="re5">-o</span> <span class="re1">$IF_LAN</span> <span class="re5">-s</span> <span class="re1">$IP_LAN</span> <span class="re5">-p</span> tcp <span class="re5">--sport</span> <span class="nu0">139</span> <span class="re5">-j</span> CT <span class="re5">--notrack</span> <span class="co0">#------------------ don't track SMB</span>
<span class="re1">$IPT</span> <span class="re5">-t</span> raw <span class="re5">-A</span> OUTPUT <span class="re5">-o</span> <span class="re1">$IF_LAN</span> <span class="re5">-s</span> <span class="re1">$IP_LAN</span> <span class="re5">-p</span> tcp <span class="re5">--sport</span> <span class="nu0">445</span> <span class="re5">-j</span> CT <span class="re5">--notrack</span> <span class="co0">#------------------ don't track SMB</span>
<span class="re1">$IPT</span> <span class="re5">-t</span> raw <span class="re5">-A</span> PREROUTING <span class="re5">-o</span> <span class="re1">$IF_LAN</span> <span class="re5">-s</span> <span class="re1">$IP_LAN</span> <span class="re5">-p</span> tcp <span class="re5">--dport</span> <span class="nu0">139</span> <span class="re5">-j</span> CT <span class="re5">--notrack</span> <span class="co0">#------------------ don't track SMB</span>
<span class="re1">$IPT</span> <span class="re5">-t</span> raw <span class="re5">-A</span> PREROUTING <span class="re5">-o</span> <span class="re1">$IF_LAN</span> <span class="re5">-s</span> <span class="re1">$IP_LAN</span> <span class="re5">-p</span> tcp <span class="re5">--dport</span> <span class="nu0">445</span> <span class="re5">-j</span> CT <span class="re5">--notrack</span> <span class="co0">#------------------ don't track SMB</span></pre>

</p>

<p>
It probably would rather avoid trouble if you do this UCI conform in <code><a href="../uci/firewall" class="wikilink1" title="doc:uci:firewall">/etc/config/firewall</a></code>:
</p>

<p>
<pre class="code">...
config &#039;rule&#039;
	option &#039;_name&#039; &#039;Don&#039;\&#039;&#039;t track NETBIOS Service&#039;
	option &#039;src&#039; &#039;lan&#039;
	option &#039;src_port&#039; &#039;137-139&#039;
	option &#039;dest&#039; &#039;lan&#039;
	option &#039;target&#039; &#039;NOTRACK&#039;

config &#039;rule&#039;
	option &#039;_name&#039; &#039;Don&#039;\&#039;&#039;t track NETBIOS Service&#039;
	option &#039;src&#039; &#039;lan&#039;
	option &#039;dest&#039; &#039;lan&#039;
	option &#039;dest_port&#039; &#039;137-139&#039;
	option &#039;target&#039; &#039;NOTRACK&#039;

config &#039;rule&#039;
	option &#039;_name&#039; &#039;Don&#039;\&#039;&#039;t track Windows Filesharing&#039;
	option &#039;src&#039; &#039;lan&#039;
	option &#039;src_port&#039; &#039;445&#039;
	option &#039;dest&#039; &#039;lan&#039;
	option &#039;target&#039; &#039;NOTRACK&#039;

config &#039;rule&#039;
	option &#039;_name&#039; &#039;Don&#039;\&#039;&#039;t track Windows Filesharing&#039;
	option &#039;src&#039; &#039;lan&#039;
	option &#039;dest&#039; &#039;lan&#039;
	option &#039;dest_port&#039; &#039;445&#039;
	option &#039;target&#039; &#039;NOTRACK&#039;
</pre>

</p>

</div>

<h3 class="sectionedit19" id="mac_network_discovery_issues">Mac Network Discovery Issues</h3>
<div class="level3">

<p>
As the latest version of Mac <abbr title="Operating System">OS</abbr> X (Yosemite) has problems discovering SMB network shares broadcasted by each client over the <abbr title="Local Area Network">LAN</abbr>, you can set up a WINS server on your router which will help them out.
</p>

<p>
A WINS server is a centralised name server for SMB network shares. The objective is to make the router the master browser which means it will discover SMB network shares then make them available over the WINS service. Macs will connect to the WINS service to receive the list of network shares, hopefully with more success than discovering network shares themselves.
</p>

<p>
We will edit the UCI template (<code>/etc/samba/smb.conf.template</code>) instead of directly changing <code>/etc/samba/smb.conf</code> so as to maintain compatibility with UCI and LuCI.
</p>

<p>
Log into LuCI, go to Services &gt; Network Shares, go to the Edit Template tab, and add or change the following entries in the &quot;[global]&quot; section in the template.
</p>

<p>
<pre class="code">[global]
	domain master = yes
	local master = yes
	name resolve order = wins lmhosts hosts bcast
	os level = 99
	preferred master = yes
	wins support = yes</pre>

</p>

<p>
Finally Save &amp; Apply the changes.
</p>

<p>
You can also configure dnsmasq to broadcast the WINS server address via DHCP so that clients on the <abbr title="Local Area Network">LAN</abbr> don’t have to be manually configured.
</p>

<p>
As there is no template editor in LuCI for <code>/etc/config/dhcp</code> it has to be edited in the terminal instead. ssh into your router then enter the following:
</p>

<p>
<pre class="code">root@router:/# cd /etc/config
root@router:/etc/config# vi dhcp</pre>

</p>

<p>
Now add the following entry to the &quot;config &#039;dhcp&#039; &#039;lan&#039;&quot; section in the template:
</p>

<p>
<pre class="code">...
config &#039;dhcp&#039; &#039;lan&#039;
	list &#039;dhcp_option&#039; &#039;44,192.168.1.1&#039;
...</pre>

</p>

<p>
If your router has a different IP address to 192.168.1.1 then put your router&#039;s address.
</p>

<p>
Use &quot;:wq&quot; to save and quit then reboot the router (type <code>reboot</code> on the command line) and reboot the Macs. SMB network shares should appear in Network home a few minutes after rebooting the Mac.
</p>

</div>

<h2 class="sectionedit20" id="notes">Notes</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/viewtopic.php?pid=140976#p140976" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?pid=140976#p140976"  rel="nofollow">Samba user administration script</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/viewtopic.php?id=33510" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=33510"  rel="nofollow">Storage Administration Tool</a></div>
</li>
</ul>

</div>

<h2 class="sectionedit21" id="example">Example</h2>
<div class="level2">

<p>
A video demonstration of how Samba 3.6 from the repositories can be installed on OpenWrt 14.07 Barrier Breaker: <a href="https://www.youtube.com/watch?v=1tEROyfvkv4" class="urlextern" title="https://www.youtube.com/watch?v=1tEROyfvkv4"  rel="nofollow">https://www.youtube.com/watch?v=1tEROyfvkv4</a>
</p>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>doc/howto/cifs.server.txt</bdi> · Last modified: 2015/05/16 17:44 by <bdi>somebody</bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="cifs.server?do=edit"  class="action source" accesskey="v" rel="nofollow" title="Show pagesource [V]"><span>Show pagesource</span></a></li><li><a href="cifs.server?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="cifs.server?do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="cifs.server#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license" class="urlextern">CC Attribution-Noncommercial-Share Alike 3.0 Unported</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license"><img src="../../lib/images/license/button/cc-by-nc-sa.png" alt="CC Attribution-Noncommercial-Share Alike 3.0 Unported" /></a>        <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/openwrt/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://www.php.net" title="Powered by PHP" ><img
            src="../../lib/tpl/openwrt/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/openwrt/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../../lib/tpl/openwrt/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/openwrt/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="../../lib/exe/indexer.php?id=doc%253Ahowto%253Acifs.server&amp;1432266538" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</body>
</html>
