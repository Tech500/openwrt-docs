<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>CUPS Server [OpenWrt Wiki]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="doc,howto,cups.server"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="OpenWrt Wiki"/>
<link rel="start" href="../../index.html"/>
<link rel="contents" href="cups.server?do=index" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Recent changes" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="../../feed.php?mode=list&amp;ns=doc:howto"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/doc/howto/cups.server"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../../_export/raw/doc/howto/cups.server"/>
<link rel="canonical" href="cups.server"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php?t=openwrt&amp;tseed=6f44f363dc87908d905dc56ff3acbfc4"/>
<script type="text/javascript">/*<![CDATA[*/var NS='doc:howto';var JSINFO = {"id":"doc:howto:cups.server","namespace":"doc:howto"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php?tseed=6f44f363dc87908d905dc56ff3acbfc4"></script>
<script type="text/javascript" charset="utf-8">/*<![CDATA[*/jQuery(function(){
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1432273780 166.182.3.53';
			document.forms[i].appendChild(myElement);
		}
	}
});
/*!]]>*/</script>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../../lib/tpl/openwrt/images/favicon.ico" />
<link rel="apple-touch-icon" href="../../lib/tpl/openwrt/images/apple-touch-icon.png" />
    </head>

<body>
    <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_openwrt     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="cups.server#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="../../start"  accesskey="h" title="[H]"><img src="../../lib/tpl/openwrt/images/logo.png" width="386" height="98" alt="" /> <span>OpenWrt Wiki</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="cups.server?do=register"  class="action register" rel="nofollow" title="Register">Register</a></li><li><a href="cups.server?do=login&amp;sectok=382740b13d95f946eed36caa57076b4a"  class="action login" rel="nofollow" title="Login">Login</a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="../../start" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="../../doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="doc:howto:cups.server" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Show pagesource</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Login</option><option value="register">Register</option></optgroup></select><input type="submit" value="&gt;" /></div></form>            </div>
            <ul>
                <li><a href="cups.server?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a></li><li><a href="cups.server?do=media&amp;ns=doc%253Ahowto"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a></li><li><a href="cups.server?do=index"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                            <div class="youarehere"><span class="bchead">You are here: </span><span class="home"><bdi><a href="../../start" class="wikilink1" title="start">OpenWrt Wiki</a></bdi></span> » <bdi><a href="../start" class="wikilink1" title="doc:start">Documentation</a></bdi> » <bdi><a href="start" class="wikilink1" title="doc:howto:start">HOWTOs</a></bdi> » <bdi><span class="curid"><a href="cups.server" class="wikilink1" title="doc:howto:cups.server">CUPS Server</a></span></bdi></div>
                                    <div class="plugin_multilingual">
        <ul>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/cz/doc/howto/cups.server" class="media" title="cz:doc:howto:cups.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=aff589&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fcz.gif" class="media" title="Čeština (Czech)" alt="Čeština (Czech)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/de/doc/howto/cups.server" class="media" title="de:doc:howto:cups.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=e24010&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fde.gif" class="media" title="Deutsch (German)" alt="Deutsch (German)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <span class="curid"><a href="cups.server" class="media" title="doc:howto:cups.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=2a37ae&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fgb.gif" class="media" title="English" alt="English" /></a></span>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/es/doc/howto/cups.server" class="media" title="es:doc:howto:cups.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=46c004&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fmx.gif" class="media" title="Español (Spanish, Mexico)" alt="Español (Spanish, Mexico)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/fr/doc/howto/cups.server" class="media" title="fr:doc:howto:cups.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=a5beba&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ffr.gif" class="media" title="Français (French)" alt="Français (French)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/hu/doc/howto/cups.server" class="media" title="hu:doc:howto:cups.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=6b5470&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fhu.gif" class="media" title="Magyar (Hungarian)" alt="Magyar (Hungarian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/jp/doc/howto/cups.server" class="media" title="jp:doc:howto:cups.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f999fc&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fjp.gif" class="media" title="日本語 (Japanese)" alt="日本語 (Japanese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pl/doc/howto/cups.server" class="media" title="pl:doc:howto:cups.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=c805c0&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fpl.gif" class="media" title="Poliski (Polish)" alt="Poliski (Polish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pt-br/doc/howto/cups.server" class="media" title="pt-br:doc:howto:cups.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=13127d&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fbr.gif" class="media" title="Português brasileiro (Portuguese, Brasil)" alt="Português brasileiro (Portuguese, Brasil)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/ru/doc/howto/cups.server" class="media" title="ru:doc:howto:cups.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=66ab5e&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fru.gif" class="media" title="Русский (Russsian)" alt="Русский (Russsian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/tr/doc/howto/cups.server" class="media" title="tr:doc:howto:cups.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f4beed&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ftr.gif" class="media" title="Tϋrkçe (Turkish)" alt="Tϋrkçe (Turkish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-cn/doc/howto/cups.server" class="media" title="zh-cn:doc:howto:cups.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=93625a&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-cn.gif" class="media" title="官話/官话 (Chinese)" alt="官話/官话 (Chinese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-tw/doc/howto/cups.server" class="media" title="zh-tw:doc:howto:cups.server"><img src="../../lib/exe/fetch.php?cache=&amp;tok=b56198&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-tw.gif" class="media" title="臺灣華語 (Taiwanese)" alt="臺灣華語 (Taiwanese)" /></a>
              </div>
            </div>
          </li>
        </ul>
      </div>
        </div>
    
    
    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">

                <div class="pageId"><span>doc:howto:cups.server</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="cups.server#preparation">Preparation</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="cups.server#prerequisites">Prerequisites</a></div></li>
<li class="level2"><div class="li"><a href="cups.server#required_packages">Required Packages</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="cups.server#server_openwrt">Server (OpenWrt)</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="cups.server#installation">Installation</a></div></li>
<li class="level1"><div class="li"><a href="cups.server#configuration">Configuration</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="cups.server#cupsd_configuration">CUPSD configuration</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="cups.server#permissions_problems">Permissions Problems</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="cups.server#adding_printers">Adding Printers</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="cups.server#usb_printers_notes_and_throubleshooting">USB printers notes and throubleshooting</a></div></li>
<li class="level3"><div class="li"><a href="cups.server#printers_must_be_shared">Printers must be Shared</a></div></li>
<li class="level3"><div class="li"><a href="cups.server#adding_driversppds">Adding drivers / PPDs</a></div></li>
<li class="level3"><div class="li"><a href="cups.server#macos_x_tip">MacOS X tip</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="cups.server#client_configuration">Client configuration</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="cups.server#start_on_boot">Start on boot</a></div></li>
<li class="level1"><div class="li"><a href="cups.server#administration">Administration</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="cups.server#log_messages">Log Messages</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="cups.server#notes">Notes</a></div>
<ul class="toc">
<li class="clear">
<ul class="toc">
<li class="level3"><div class="li"><a href="cups.server#openwrt_user_posts_about_installing_cups">OpenWrt User posts about installing CUPS</a></div></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="cups_server">CUPS Server</h1>
<div class="level1">

<p>
This HowTo provides information on installing and configuring a <a href="http://en.wikipedia.org/wiki/Common Unix Printing System" class="interwiki iw_wp" title="http://en.wikipedia.org/wiki/Common Unix Printing System">Common Unix Printing System</a> on OpenWrt.
</p>

</div>

<h2 class="sectionedit2" id="preparation">Preparation</h2>
<div class="level2">

</div>

<h3 class="sectionedit3" id="prerequisites">Prerequisites</h3>
<div class="level3">
<ol>
<li class="level1"><div class="li"> obtain <a href="usb.essentials" class="wikilink1" title="doc:howto:usb.essentials">usb.essentials</a> basic USB support or (<a href="http://wiki.openwrt.org/doc/howto/parport" class="wikilink2" title="doc:howto:parport" rel="nofollow">parport</a> Parallel Port support)</div>
</li>
<li class="level1"><div class="li"> drivers</div>
</li>
<li class="level1"><div class="li"> kernel module for USB printers: opkg install kmod-usb-printer</div>
</li>
<li class="level1"><div class="li"> Firewall: open ports    tcp and   udp.</div>
</li>
</ol>

<p>
CUPS mandatory uses spooling, which means that the entire print job data gets stored in a buffer (on harddisc or in RAM) before the printing is even started. Dependent of what you want to print, your resources are probably that limited that you should not use CUPS. But of course you can add resources to your hardware, like say connect a harddisc per USB.
</p>
<ol>
<li class="level1"><div class="li"> <a href="usb.storage" class="wikilink1" title="doc:howto:usb.storage">usb.storage</a> to mount a filesystem or a SWAP partition. This should massively upgrade your endowment.</div>
</li>
<li class="level1"><div class="li"> you cannot mount SWAP over network but you could mount any other filesystem over the network and park the data there, see <a href="server.overview#filesystem" class="wikilink1" title="doc:howto:server.overview">filesystem</a></div>
</li>
</ol>

</div>

<h3 class="sectionedit4" id="required_packages">Required Packages</h3>
<div class="level3">

</div>

<h4 id="server_openwrt">Server (OpenWrt)</h4>
<div class="level4">
<div class="table sectionedit5"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Version </th><th class="col2"> Size in Bytes </th><th class="col3 leftalign"> Description  </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> cups        </td><td class="col1 centeralign">  1.4.4-1      </td><td class="col2 rightalign">  <strong>2 217 619</strong> </td><td class="col3 leftalign"> A printer spooling system for devices with USB or LP support.  </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> zlib        </td><td class="col1 centeralign">  1.2.5-1      </td><td class="col2 rightalign">    39 388 </td><td class="col3 leftalign"> Library implementing the deflate compression method  </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> libpthread  </td><td class="col1 centeralign">  0.9.32-65    </td><td class="col2 rightalign">    30 717 </td><td class="col3 leftalign"> POSIX thread library  </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> libpng      </td><td class="col1 centeralign">  1.2.44-1     </td><td class="col2 rightalign">   128 723 </td><td class="col3 leftalign"> A PNG format files handling library  </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> libjpeg     </td><td class="col1 centeralign">  6b-1         </td><td class="col2 rightalign">    61 963 </td><td class="col3 leftalign"> The Independent JPEG Group&#039;s JPEG runtime library  </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> libstdcpp   </td><td class="col1 centeralign">  4.3.3+cs-65  </td><td class="col2 rightalign">   232 642 </td><td class="col3 leftalign"> GNU Standard C++ Library v3  </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> cups-bjnp   </td><td class="col1 centeralign">   0.5.4-1     </td><td class="col2 rightalign">    11 293 </td><td class="col3 leftalign"> (optional) Description: CUPS backend for the canon printers using the proprietary USB over IP BJNP protocol. This backend allows Cups to print over the network to a Canon printer. It currently supports Cups 1.2 and Cups 1.3 and is designed by reverse engineering.  </td>
	</tr>
</table></div>

</div>

<h2 class="sectionedit6" id="installation">Installation</h2>
<div class="level2">

<p>
<a href="../techref/opkg" class="wikilink1" title="doc:techref:opkg">opkg</a>
<pre class="code bash">opkg <span class="kw2">install</span> cups
<span class="kw2">vi</span> <span class="sy0">/</span>etc<span class="sy0">/</span>cups.conf
If you have external storage, change the CUPS spool directory so that it resides on this storage:  
<span class="kw2">vi</span> <span class="sy0">/</span>etc<span class="sy0">/</span>cups<span class="sy0">/</span>cupsd.conf and change- RequestRoot <span class="sy0">/</span>opt<span class="sy0">/</span>var<span class="sy0">/</span>spool<span class="sy0">/</span>cups
. <span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>cupsd <span class="kw3">enable</span>
. <span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>cupsd start
<span class="kw2">netstat</span> <span class="re5">-a</span>
iptables <span class="re5">-I</span> INPUT <span class="re5">-j</span> ACCEPT <span class="re5">-i</span> eth0.1 <span class="re5">-p</span> tcp <span class="re5">--port</span> ?????
iptables <span class="re5">-I</span> INPUT <span class="re5">-j</span> ACCEPT <span class="re5">-i</span> eth0.1 <span class="re5">-p</span> udp <span class="re5">--port</span> ?????</pre>

</p>

</div>

<h2 class="sectionedit7" id="configuration">Configuration</h2>
<div class="level2">

</div>

<h3 class="sectionedit8" id="cupsd_configuration">CUPSD configuration</h3>
<div class="level3">

<p>
Use Cups own configuration Web <abbr title="Graphical User Interface">GUI</abbr>. If cups is running, you should be able to find it at <a href="http://192.168.1.1:631" class="urlextern" title="http://192.168.1.1:631"  rel="nofollow">http://192.168.1.1:631</a> (that is port <code>631</code> of your router&#039;s own address). The default cups configuration in <em>Attitude Adjustment</em> uses the host system authentication mechanism, so in order to log in as Administrator, use the <code>root</code> username and its password (the same you use at the Lucy log-in screen).
</p>

<p>
An alternative to the Web <abbr title="Graphical User Interface">GUI</abbr> is text file configuration: configure <code>/etc/cups/cups.conf</code> according to <a href="http://linux.die.net/man/5/cupsd.conf" class="urlextern" title="http://linux.die.net/man/5/cupsd.conf"  rel="nofollow">man cupsd.conf</a>. Notice that some configuration files (such as <code>/etc/cups/printers.conf</code>) should <strong>not</strong> be edited while cups is running. Many cups text files are meant to be modified by the <code>lpadmin</code> command.
</p>

</div>

<h4 id="permissions_problems">Permissions Problems</h4>
<div class="level4">

<p>
If you have problems with permissions, try to change <code>/etc/cups/cupsd.conf</code> to fit your local TCP/IP network:
</p>

<p>
<pre class="code">Order Deny,Allow
Deny From All
Allow from 127.0.0.1
Allow from 192.168.1.0/24 #your ip area.</pre>

</p>

</div>

<h5 id="toubleshootingneed_drivers_uploaded_on_power_up">Toubleshooting: Need drivers uploaded on power up ?</h5>
<div class="level5">

<p>
Got an HP Laserjet or similar device that requires the driver to be uploaded to the printer each time it&#039;s turned on? See this post <a href="http://mattie47.com/getting-cups-working-on-openwrt/#comment-12" class="urlextern" title="http://mattie47.com/getting-cups-working-on-openwrt/#comment-12"  rel="nofollow">here</a>
</p>

</div>

<h3 class="sectionedit9" id="adding_printers">Adding Printers</h3>
<div class="level3">

<p>
Notice you can&#039;t print a testpage on the local cups, because this would need to have ghostscript installed on your embedded system.
</p>

</div>

<h4 id="usb_printers_notes_and_throubleshooting">USB printers notes and throubleshooting</h4>
<div class="level4">

<p>
Backfire:
There may be a problem interfacing with USB printers if usb-printers kernel module is also loaded.  These conflict with the cups-provided USB support.  There are plenty of bugs and one working solution is as follows:
</p>
<ol>
<li class="level1"><div class="li"> Remove usblp support: opkg remove kmod-usb-printer</div>
</li>
<li class="level1"><div class="li"> Edit user and group in /etc/cups/cupsd.conf from <code>User Nobody/Group Nogroup</code> to <code>User root/Group root</code></div>
</li>
<li class="level1"><div class="li"> Change <abbr title="Access Control List">ACL</abbr> on /usr/lib/cups/backend/usb to 700 (<code>chmod 700 /usr/lib/cups/backend/usb</code>).  This changes the behaviour of cups, which normally tries to execute the backend through a user account other than root.  This forces the backend to run as root from cups.</div>
</li>
<li class="level1"><div class="li"> Finally, it should be possible to add printers through the web page <a href="http://host:631/admin" class="urlextern" title="http://host:631/admin"  rel="nofollow">http://host:631/admin</a> or manually.  The USB device name cannot be displayed through lpinfo but can instead be listed by running <code>/usr/lib/cups/backend/usb</code> as root.</div>
</li>
</ol>

<p>
There is a problem with the permissions on USB printers not being writable by nobody, which is what CUPS expects.  An alternative is to make a wrapper backend that executes a sudo script which does <code>find /proc/bus/usb -type f -exec chmod +rw {} \;</code>.  Point being, there is a permission problem between USB/udev and CUPS preventing USB-printers from working.  Also, CUPS is removing support or has a lot of issues currently with usblp support.
</p>

<p>
In Attitude Adjustment, you just need to change <abbr title="Access Control List">ACL</abbr> on /usr/lib/cups/backend/usb to 700 (<code>chmod 700 /usr/lib/cups/backend/usb</code>).  This changes the behaviour of cups, which normally tries to execute the backend through a user account other than root.  This forces the backend to run as root from cups, the reason have been said above.
</p>

</div>

<h4 id="printers_must_be_shared">Printers must be Shared</h4>
<div class="level4">

<p>
In order to use the printers from other clients in your network, the printers must be <em>shared</em>. In the Web <abbr title="Graphical User Interface">GUI</abbr>, when adding a printer you should mark the check box <code>&quot;Share This Printer&quot;</code>.
</p>

</div>

<h4 id="adding_driversppds">Adding drivers / PPDs</h4>
<div class="level4">

<p>
If you have a special <a href="http://en.wikipedia.org/wiki/PostScript Printer Description" class="interwiki iw_wp" title="http://en.wikipedia.org/wiki/PostScript Printer Description">PostScript Printer Description (ppd)</a>-file for your printer, copy it to <code>/usr/share/cups/model/</code> and restart <code>cupsd</code>. Cups will install it in <code>/etc/cups/ppd</code> and you can choose it via the web interface. (<a href="http://192.168.1.1:631" class="urlextern" title="http://192.168.1.1:631"  rel="nofollow">http://192.168.1.1:631</a>). You can also upload a PPD file through the web interface. <strong>The trick here is that without Ghostscript you are unlikely to get on-router file conversion to work</strong>. 
</p>

<p>
You really get two alternatives:
</p>
<ol>
<li class="level1"><div class="li"> use the printer with a raw queue, and set drivers (i.e. PPD) in your computer/laptop. In this case, the file conversion and preparation will be done on your computer/laptop (as opposed to on the router)</div>
</li>
<li class="level1"><div class="li"> add printing drivers to your router. Notice that the usual &quot;Linux printing drivers/filters&quot; stack requires more space than a normal router has. If you&#039;ve <a href="extroot" class="wikilink1" title="doc:howto:extroot">extended your root space</a> and are willing to do some <a href="../devel/crosscompile" class="urlextern" title="http://wiki.openwrt.org/doc/devel/crosscompile"  rel="nofollow">cross compilation</a>, you can try these unofficial packages <a href="https://github.com/FranciscoBorges/openwrt-printing-packages" class="urlextern" title="https://github.com/FranciscoBorges/openwrt-printing-packages"  rel="nofollow">openwrt-printing-packages</a></div>
</li>
</ol>

</div>

<h4 id="macos_x_tip">MacOS X tip</h4>
<div class="level4">

<p>
Configure your extended printer settings. If you use the standard printer settings and add an IPP printer, MacOS X will add after the server adress /ipp . But this class etc. does not exist on your cupsd.
</p>

</div>

<h3 class="sectionedit10" id="client_configuration">Client configuration</h3>
<div class="level3">

<p>
This page has good notes about configuring clients for Linux, Windows and Mac OSX:
</p>

<p>
<a href="p910nd.server#configuretheclientsforprinting" class="wikilink1" title="doc:howto:p910nd.server">configure.the.clients.for.printing</a>.
</p>

<p>
The main point is that if you added printers and marked them as shared, all these operating system should be able to find it as a network printer.
</p>

</div>

<h2 class="sectionedit11" id="start_on_boot">Start on boot</h2>
<div class="level2">

<p>
To enable/disable start on boot:
</p>

<p>
<code>/etc/init.d/cupsd enable</code> (it creates a symlink: <code>/etc/rc.d/S??cupsd → /etc/init.d/cupsd</code>)
</p>

<p>
<code>/etc/init.d/cupsd disable</code> (this removes the symlink).
</p>

</div>

<h2 class="sectionedit12" id="administration">Administration</h2>
<div class="level2">

<p>
Use Cups own Web <abbr title="Graphical User Interface">GUI</abbr>. If cups is running, you should be able to find it at <a href="http://192.168.1.1:631" class="urlextern" title="http://192.168.1.1:631"  rel="nofollow">http://192.168.1.1:631</a> (that is port 631 of your router&#039;s own address). If you did not change its configuration, to log in to Administration use the <code>root</code> username and its password.
</p>

<p>
Alternatively you can login to OpenWrt and edit <code>/etc/cups/cups.conf</code>. Restart cupsd.
</p>

</div>

<h3 class="sectionedit13" id="log_messages">Log Messages</h3>
<div class="level3">

<p>
Check <a href="log.messages#cupsd" class="wikilink1" title="doc:howto:log.messages">cupsd</a> to learn what they mean.
</p>

</div>

<h2 class="sectionedit14" id="notes">Notes</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Project Homepage <a href="http://www.cups.org/" class="urlextern" title="http://www.cups.org/"  rel="nofollow">http://www.cups.org/</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/viewtopic.php?pid=135838#p135838" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?pid=135838#p135838"  rel="nofollow">Notes on possibilities of using drivers</a></div>
</li>
<li class="level1"><div class="li"> Package feed for cross-compiling the whole Linux printing stack for your router <a href="https://github.com/FranciscoBorges/openwrt-printing-packages" class="urlextern" title="https://github.com/FranciscoBorges/openwrt-printing-packages"  rel="nofollow">https://github.com/FranciscoBorges/openwrt-printing-packages</a></div>
</li>
</ul>

</div>

<h4 id="openwrt_user_posts_about_installing_cups">OpenWrt User posts about installing CUPS</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <a href="http://mattie47.com/getting-cups-working-on-openwrt/" class="urlextern" title="http://mattie47.com/getting-cups-working-on-openwrt/"  rel="nofollow">http://mattie47.com/getting-cups-working-on-openwrt/</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.newren.com.au/ibbs/forum.php?mod=viewthread&amp;tid=392" class="urlextern" title="http://www.newren.com.au/ibbs/forum.php?mod=viewthread&amp;tid=392"  rel="nofollow">http://www.newren.com.au/ibbs/forum.php?mod=viewthread&amp;tid=392</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://9m2tpt.blogspot.co.nz/2012/01/cups-hl-2140-usb-printer-wzr-hp-g300nh.html" class="urlextern" title="http://9m2tpt.blogspot.co.nz/2012/01/cups-hl-2140-usb-printer-wzr-hp-g300nh.html"  rel="nofollow">http://9m2tpt.blogspot.co.nz/2012/01/cups-hl-2140-usb-printer-wzr-hp-g300nh.html</a></div>
</li>
</ul>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>doc/howto/cups.server.txt</bdi> · Last modified: 2013/09/04 20:41 by <bdi>francisco</bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="cups.server?do=edit"  class="action source" accesskey="v" rel="nofollow" title="Show pagesource [V]"><span>Show pagesource</span></a></li><li><a href="cups.server?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="cups.server?do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="cups.server#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license" class="urlextern">CC Attribution-Noncommercial-Share Alike 3.0 Unported</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license"><img src="../../lib/images/license/button/cc-by-nc-sa.png" alt="CC Attribution-Noncommercial-Share Alike 3.0 Unported" /></a>        <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/openwrt/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://www.php.net" title="Powered by PHP" ><img
            src="../../lib/tpl/openwrt/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/openwrt/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../../lib/tpl/openwrt/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/openwrt/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="../../lib/exe/indexer.php?id=doc%253Ahowto%253Acups.server&amp;1432273780" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</body>
</html>
