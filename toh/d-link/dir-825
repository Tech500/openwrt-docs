<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>D-Link DIR-825 [OpenWrt Wiki]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="gigabitethernet,5port,2nic,usb,1usb,jtag,802.11abgn simultan,detachableantenna,2ant,2wnic,ath9k,64ram,8flash,mips,mips32,24kc"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="OpenWrt Wiki"/>
<link rel="start" href="../../index.html"/>
<link rel="contents" href="dir-825?do=index" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Recent changes" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="../../feed.php?mode=list&amp;ns=toh:d-link"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/toh/d-link/dir-825"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../../_export/raw/toh/d-link/dir-825"/>
<link rel="canonical" href="dir-825"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php?t=openwrt&amp;tseed=6f44f363dc87908d905dc56ff3acbfc4"/>
<script type="text/javascript">/*<![CDATA[*/var NS='toh:d-link';var JSINFO = {"id":"toh:d-link:dir-825","namespace":"toh:d-link"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php?tseed=6f44f363dc87908d905dc56ff3acbfc4"></script>
<script type="text/javascript" charset="utf-8">/*<![CDATA[*/jQuery(function(){
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1432266221 166.182.3.17';
			document.forms[i].appendChild(myElement);
		}
	}
});
/*!]]>*/</script>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../../lib/tpl/openwrt/images/favicon.ico" />
<link rel="apple-touch-icon" href="../../lib/tpl/openwrt/images/apple-touch-icon.png" />
    </head>

<body>
    <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_openwrt     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="dir-825#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="../../start"  accesskey="h" title="[H]"><img src="../../lib/tpl/openwrt/images/logo.png" width="386" height="98" alt="" /> <span>OpenWrt Wiki</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="dir-825?do=register"  class="action register" rel="nofollow" title="Register">Register</a></li><li><a href="dir-825?do=login&amp;sectok=382740b13d95f946eed36caa57076b4a"  class="action login" rel="nofollow" title="Login">Login</a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="../../start" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="../../doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="toh:d-link:dir-825" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Show pagesource</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Login</option><option value="register">Register</option></optgroup></select><input type="submit" value="&gt;" /></div></form>            </div>
            <ul>
                <li><a href="dir-825?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a></li><li><a href="dir-825?do=media&amp;ns=toh%253Ad-link"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a></li><li><a href="dir-825?do=index"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                            <div class="youarehere"><span class="bchead">You are here: </span><span class="home"><bdi><a href="../../start" class="wikilink1" title="start">OpenWrt Wiki</a></bdi></span> » <bdi><a href="../start" class="wikilink1" title="toh:start">Table of Hardware</a></bdi> » <bdi><a href="start" class="wikilink1" title="toh:d-link:start">D-Link</a></bdi> » <bdi><span class="curid"><a href="dir-825" class="wikilink1" title="toh:d-link:dir-825">D-Link DIR-825</a></span></bdi></div>
                                    <div class="plugin_multilingual">
        <ul>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/cz/toh/d-link/dir-825" class="media" title="cz:toh:d-link:dir-825"><img src="../../lib/exe/fetch.php?cache=&amp;tok=aff589&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fcz.gif" class="media" title="Čeština (Czech)" alt="Čeština (Czech)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/de/toh/d-link/dir-825" class="media" title="de:toh:d-link:dir-825"><img src="../../lib/exe/fetch.php?cache=&amp;tok=e24010&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fde.gif" class="media" title="Deutsch (German)" alt="Deutsch (German)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <span class="curid"><a href="dir-825" class="media" title="toh:d-link:dir-825"><img src="../../lib/exe/fetch.php?cache=&amp;tok=2a37ae&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fgb.gif" class="media" title="English" alt="English" /></a></span>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/es/toh/d-link/dir-825" class="media" title="es:toh:d-link:dir-825"><img src="../../lib/exe/fetch.php?cache=&amp;tok=46c004&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fmx.gif" class="media" title="Español (Spanish, Mexico)" alt="Español (Spanish, Mexico)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/fr/toh/d-link/dir-825" class="media" title="fr:toh:d-link:dir-825"><img src="../../lib/exe/fetch.php?cache=&amp;tok=a5beba&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ffr.gif" class="media" title="Français (French)" alt="Français (French)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/hu/toh/d-link/dir-825" class="media" title="hu:toh:d-link:dir-825"><img src="../../lib/exe/fetch.php?cache=&amp;tok=6b5470&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fhu.gif" class="media" title="Magyar (Hungarian)" alt="Magyar (Hungarian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/jp/toh/d-link/dir-825" class="media" title="jp:toh:d-link:dir-825"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f999fc&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fjp.gif" class="media" title="日本語 (Japanese)" alt="日本語 (Japanese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pl/toh/d-link/dir-825" class="media" title="pl:toh:d-link:dir-825"><img src="../../lib/exe/fetch.php?cache=&amp;tok=c805c0&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fpl.gif" class="media" title="Poliski (Polish)" alt="Poliski (Polish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pt-br/toh/d-link/dir-825" class="media" title="pt-br:toh:d-link:dir-825"><img src="../../lib/exe/fetch.php?cache=&amp;tok=13127d&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fbr.gif" class="media" title="Português brasileiro (Portuguese, Brasil)" alt="Português brasileiro (Portuguese, Brasil)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/ru/toh/d-link/dir-825" class="media" title="ru:toh:d-link:dir-825"><img src="../../lib/exe/fetch.php?cache=&amp;tok=66ab5e&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fru.gif" class="media" title="Русский (Russsian)" alt="Русский (Russsian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/tr/toh/d-link/dir-825" class="media" title="tr:toh:d-link:dir-825"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f4beed&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ftr.gif" class="media" title="Tϋrkçe (Turkish)" alt="Tϋrkçe (Turkish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <a href="../../zh-cn/toh/d-link/dir-825" class="media" title="zh-cn:toh:d-link:dir-825"><img src="../../lib/exe/fetch.php?cache=&amp;tok=93625a&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-cn.gif" class="media" title="官話/官话 (Chinese)" alt="官話/官话 (Chinese)" /></a>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-tw/toh/d-link/dir-825" class="media" title="zh-tw:toh:d-link:dir-825"><img src="../../lib/exe/fetch.php?cache=&amp;tok=b56198&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-tw.gif" class="media" title="臺灣華語 (Taiwanese)" alt="臺灣華語 (Taiwanese)" /></a>
              </div>
            </div>
          </li>
        </ul>
      </div>
        </div>
    
    
    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">

                <div class="pageId"><span>toh:d-link:dir-825</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="dir-825#known_hardware_versions">Known Hardware Versions</a></div></li>
<li class="level1"><div class="li"><a href="dir-825#hardware_highlights">Hardware Highlights</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="dir-825#switch_ports">Switch Ports</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="dir-825#installation">Installation</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="dir-825#installation_using_firmware_update_page">Installation using firmware update page</a></div></li>
<li class="level2"><div class="li"><a href="dir-825#installation_using_firmware_recovery_mode">Installation using firmware recovery mode</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="dir-825#phase_1os_specific_quirks">Phase 1: OS specific quirks</a></div></li>
<li class="level3"><div class="li"><a href="dir-825#phase_2general_steps">Phase 2: General steps</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="dir-825#flash_layout">Flash Layout</a></div></li>
<li class="level2"><div class="li"><a href="dir-825#upgrading_openwrt">Upgrading OpenWrt</a></div></li>
<li class="level2"><div class="li"><a href="dir-825#openwrt_failsafe_mode">OpenWrt failsafe mode</a></div></li>
<li class="level2"><div class="li"><a href="dir-825#firmware_recovery">Firmware recovery</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="dir-825#basic_configuration">Basic configuration</a></div></li>
<li class="level1"><div class="li"><a href="dir-825#hardware">Hardware</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="dir-825#info">Info</a></div></li>
<li class="level2"><div class="li"><a href="dir-825#photos">Photos</a></div></li>
<li class="level2"><div class="li"><a href="dir-825#physically_breaking_into_the_dir-825">Physically breaking into the DIR-825</a></div></li>
<li class="level2"><div class="li"><a href="dir-825#serial">Serial</a></div></li>
<li class="level2"><div class="li"><a href="dir-825#jtag">JTAG</a></div></li>
<li class="level2"><div class="li"><a href="dir-825#leds">LEDs</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="dir-825#repair_leds_after_flashing_openwrt">Repair LEDs after flashing OpenWRT</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="dir-825#buttons">Buttons</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="dir-825#hardware_mods">Hardware Mods</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="dir-825#second_usb_port">Second USB port</a></div></li>
<li class="level2"><div class="li"><a href="dir-825#mb_ram_mod">128 MB RAM Mod</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="dir-825#connection_information">Connection Information</a></div></li>
<li class="level1"><div class="li"><a href="dir-825#other_info">Other Info</a></div></li>
<li class="level1"><div class="li"><a href="dir-825#vlan_configuration_on_lan-port_4">VLAN Configuration ( on LAN-Port 4)</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="dir-825#introduction">1) Introduction</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="dir-825#what_is_vlan">What is VLAN?</a></div></li>
<li class="level3"><div class="li"><a href="dir-825#situation_-_6_global_ips_from_the_isp">Situation - 6 global IPs from the ISP</a></div></li>
<li class="level3"><div class="li"><a href="dir-825#what_is_the_aim">What is the aim ?</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="dir-825#setup_vlan">2) Setup VLAN</a></div></li>
<li class="level2"><div class="li"><a href="dir-825#firewallcontrol_traffic">3) Firewall: control traffic</a></div></li>
<li class="level2"><div class="li"><a href="dir-825#setup_machine_connected_to_vlan">4) Setup machine connected to VLAN</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="dir-825#a_c_program_to_flash_dir-825">A C Program to flash DIR-825</a></div></li>
<li class="level1"><div class="li"><a href="dir-825#a_simple_script_to_flash_dir-825">A simple script to flash DIR-825</a></div></li>
<li class="level1"><div class="li"><a href="dir-825#custom_openwrt_image_with_luci_integrated">Custom OpenWrt image with LuCi integrated</a></div></li>
<li class="level1"><div class="li"><a href="dir-825#fat_images">Fat images</a></div></li>
<li class="level1"><div class="li"><a href="dir-825#tags">Tags</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="d-link_dir-825">D-Link DIR-825</h1>
<div class="level1">

</div>

<h2 class="sectionedit2" id="known_hardware_versions">Known Hardware Versions</h2>
<div class="level2">
<div class="table sectionedit3"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Revision </th><th class="col1"> Supported since </th><th class="col2"> Model Specific Notes </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <span style='color:red; '> A1 </span> </td><td class="col1"> not supported </td><td class="col2"> </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> B1       </td><td class="col1 leftalign"> Kamikaze trunk     </td><td class="col2"> working with trunk as of r18621 </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> B2       </td><td class="col1 leftalign"> Kamikaze trunk     </td><td class="col2"> working with trunk as of r25121 </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> B1/2     </td><td class="col1 leftalign"> Attitude Adjustment trunk     </td><td class="col2"> Newer revisions (FW 2.05EU) store mac-addresses differently,<br/>
which leads to non-working wlan0/1. Working with trunk as <br/>
of r29119</td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> C1       </td><td class="col1 leftalign"> Barrier Breaker trunk <a href="https://dev.openwrt.org/changeset/35403" class="urlextern" title="https://dev.openwrt.org/changeset/35403"  rel="nofollow">r35403</a>    </td><td class="col2"> See <a href="https://dev.openwrt.org/changeset/35401" class="urlextern" title="https://dev.openwrt.org/changeset/35401"  rel="nofollow">r35401</a>, <a href="https://dev.openwrt.org/changeset/35402" class="urlextern" title="https://dev.openwrt.org/changeset/35402"  rel="nofollow">r35402</a>, <a href="https://dev.openwrt.org/changeset/35403" class="urlextern" title="https://dev.openwrt.org/changeset/35403"  rel="nofollow">r35403</a>, Also see <a href="dir-835" class="wikilink1" title="toh:d-link:dir-835">DIR-835</a> </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <span style='color:red; '> D1 </span> </td><td class="col1"> <strong>not supported</strong> </td><td class="col2"> See <a href="https://forum.openwrt.org/viewtopic.php?id=46774" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=46774"  rel="nofollow">Forum</a> </td>
	</tr>
</table></div>

<p>
<strong><code>Note:</code></strong> B2 appears to only be different in labeling. The default firmware claims B1 and even <code>/proc/cpuinfo</code> claim to be B1 revisions even though the packaging and the sticker say B2.
</p>

</div>

<h2 class="sectionedit4" id="hardware_highlights">Hardware Highlights</h2>
<div class="level2">
<div class="table sectionedit5"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> HW Rev </th><th class="col1"> CPU </th><th class="col2"> Ram </th><th class="col3"> Flash </th><th class="col4"> Network </th><th class="col5"> Gigabit </th><th class="col6"> USB </th><th class="col7"> Serial </th><th class="col8"> JTag </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <span style='color:red; '> A1 </span> </td><td class="col1"> <span style='color:red; '> Ubicom IP5170U@? </span> </td><td class="col2"> 16MB </td><td class="col3"> ? </td><td class="col4"> 4x1 </td><td class="col5"> Yes </td><td class="col6"> Yes </td><td class="col7"> ? </td><td class="col8"> ? </td>
	</tr>
	<tr class="row2">
		<td class="col0"> B1/B2 </td><td class="col1"> Atheros AR7161@680MHz</td><td class="col2"> 64MB </td><td class="col3"> 8MB </td><td class="col4"> 4x1 </td><td class="col5"> Yes </td><td class="col6"> Yes </td><td class="col7"> Yes </td><td class="col8"> Yes </td>
	</tr>
	<tr class="row3">
		<td class="col0"> C1 </td><td class="col1"> Atheros AR9344@560MHz</td><td class="col2"> 128MB </td><td class="col3"> 16MB </td><td class="col4"> 4x1 </td><td class="col5"> Yes </td><td class="col6"> Yes </td><td class="col7"> Yes </td><td class="col8"> Yes </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <span style='color:red; '> D1 </span> </td><td class="col1"> <span style='color:red; '> Realtek RTL8197D@? </span> </td><td class="col2"> ? </td><td class="col3"> ? </td><td class="col4"> 4x1 </td><td class="col5"> Yes </td><td class="col6"> Yes </td><td class="col7"> ? </td><td class="col8"> ? </td>
	</tr>
</table></div>

<p>
<strong><code>Note:</code></strong> Although C1 has SoC of AR9344 but it&#039;s categorized under &quot;target&quot; of <strong>ar71xx</strong>. So you should find its related source code in &#039;trunk/target/linux/ar71xx&#039; and its builds under <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/" class="urlextern" title="http://downloads.openwrt.org/snapshots/trunk/ar71xx/"  rel="nofollow">ar71xx/</a> folder.
</p>

</div>

<h3 class="sectionedit6" id="switch_ports">Switch Ports</h3>
<div class="level3">

<p>
Numbers 0-3 are Ports 4 to 1 as labeled on the unit, 5 is the internal connection to the router itself.
</p>
<div class="table sectionedit7"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Port </th><th class="col1"> Switch port </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> CPU (eth0) </td><td class="col1"> 5 </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> No port    </td><td class="col1"> 4 </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <abbr title="Local Area Network">LAN</abbr> 1      </td><td class="col1"> 3 </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <abbr title="Local Area Network">LAN</abbr> 2      </td><td class="col1"> 2 </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> <abbr title="Local Area Network">LAN</abbr> 3      </td><td class="col1"> 1 </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> <abbr title="Local Area Network">LAN</abbr> 4      </td><td class="col1"> 0 </td>
	</tr>
</table></div>

</div>

<h2 class="sectionedit8" id="installation">Installation</h2>
<div class="level2">

<p>
Consult <a href="../../doc/techref/flash.layout" class="wikilink1" title="doc:techref:flash.layout">Flash.Layout</a> for a better understanding.
</p>

<p>
There are two ways of installing firmware, either by using normal D-Link firmware update web-interface or by using firmware recovery mode.
</p>

</div>

<h3 class="sectionedit9" id="installation_using_firmware_update_page">Installation using firmware update page</h3>
<div class="level3">

<p>
<strong><code>Note:</code></strong> Since original Firmware 2.05WW Build: 05Beta01 it is <span style='color:red; '>not possible</span> to flash OpenWrt via the firmware update page. 
(worked on a B2 revision with Ubuntu&#039;s Firefox in 2.05NA and 2.06NA)
It looks like Firmware 2.01EU behaves the same way. Please use the firmware recovery mode instead.
</p>

<p>
<strong><code>Note:</code></strong> This method works for revision C2 with Firmware 3.00 using Ubuntu&#039;s Firefox. I used <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-dir-825-c1-squashfs-factory.bin" class="urlextern" title="http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-dir-825-c1-squashfs-factory.bin"  rel="nofollow">openwrt-ar71xx-generic-dir-825-c1-squashfs-factory.bin</a>
</p>
<ol>
<li class="level1"><div class="li"> Login into the factory D-Link firmware web-interface as usual. Default procedure for the freshly purchased router is: </div>
<ol>
<li class="level2"><div class="li"> Set the static IP <strong><code>192.168.0.100/24</code></strong> on the PC</div>
</li>
<li class="level2"><div class="li"> With any web browser go to <a href="http://192.168.0.1/" class="urlextern" title="http://192.168.0.1/"  rel="nofollow">http://192.168.0.1/</a>, use &quot;admin&quot; as the username, and &quot;&quot; as the password (leave the field blank).</div>
</li>
</ol>
</li>
<li class="level1"><div class="li"> Proceed into the firmware update page, click &quot;Browse&quot; and select your OpenWrt image file (<strong>openwrt-ar71xx-generic-dir-825-b1-squashfs-factory.bin</strong>)</div>
</li>
<li class="level1"><div class="li"> Click &quot;Update&quot; and let the router reflash itself.</div>
</li>
<li class="level1"><div class="li"> Device should now reboot itself and boot up the OpenWrt.</div>
</li>
<li class="level1"><div class="li"> Give the router some time to finish firstboot tasks (initial configuration, jffs2 initialization, e.t.c.).</div>
</li>
<li class="level1"><div class="li"> The router&#039;s power LED should blink orange during bootup, as soon as it stops flashing, you can connect to it</div>
</li>
<li class="level1"><div class="li"> obtain new IP from the router via DHCP and follow <a href="../../doc/howto/firstlogin" class="wikilink1" title="doc:howto:firstlogin">firstlogin</a></div>
</li>
</ol>

</div>

<h3 class="sectionedit10" id="installation_using_firmware_recovery_mode">Installation using firmware recovery mode</h3>
<div class="level3">

</div>

<h4 id="phase_1os_specific_quirks">Phase 1: OS specific quirks</h4>
<div class="level4">

<p>
<span style='color:red; '><strong><code>Note:</code></strong> The firmware recovery mode has following quirks:</span>
</p>
<ul>
<li class="level1"><div class="li"> If you have a Windows machine available you can use Microsoft Internet Explorer 7 (a Windows running on a VM, like VMware, does not work)</div>
<ul>
<li class="level2"><div class="li"> Windows 8: Firefox cannot be used to update firmware (presumably applies to other versions of Windows).</div>
</li>
<li class="level2"><div class="li"> Windows 8: Use Internet Explorer 10. Press F12. Select Browser Mode: IE8. Leave the compatibility setting at IE5 Quirks.</div>
</li>
<li class="level2"><div class="li"> Windows 7: try to turn off ipv6</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> If you are running Linux you can:</div>
<ul>
<li class="level2"><div class="li"> Ideally use C program below, otherwise:</div>
</li>
<li class="level2"><div class="li"> Set your interface to 100Mbps using <code>sudo ethtool -s eth0 speed 100 autoneg off</code>, install <a href="http://appdb.winehq.org/objectManager.php?sClass=version&amp;iId=4195" class="urlextern" title="http://appdb.winehq.org/objectManager.php?sClass=version&amp;iId=4195"  rel="nofollow">IE7 in Wine</a> and use it to flash.</div>
</li>
<li class="level2"><div class="li"> Later models (or some hardware combinations) may need <code>sudo ethtool -s eth0 speed 100 duplex half autoneg off</code> (e.g. B2, FW ver 2.05EU).</div>
</li>
<li class="level2"><div class="li"> Use <span class="curid"><a href="dir-825#a_simple_script_to_flash_dir-825" class="wikilink1" title="toh:d-link:dir-825">the following script</a></span>.</div>
</li>
<li class="level2"><div class="li"> firmware 2.02EU should still be available on <a href="ftp://ftp.dlink.de" class="urlextern" title="ftp://ftp.dlink.de"  rel="nofollow">ftp.dlink.de</a> and it doesn&#039;t require <abbr title="Internet Explorer">IE</abbr>, nor Mac.</div>
</li>
<li class="level2"><div class="li"> 2.05EUB09_7 can&#039;t be downgraded to 2.04 but fortunately can be downgraded to 2.02EU</div>
</li>
<li class="level2"><div class="li"> I had to disable both avahi, cups and IPv6 to get it working. (B2 FW ver 2.01EU)</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> If you are running MacOS you can use <del>Google Chrome</del> Opera</div>
</li>
<li class="level1"><div class="li"> FW version 2.05EU seems very difficult to flash, there may be timing issues (that&#039;s just a guess). After downgrading to 2.04EU (get it from <a href="ftp://ftp.dlink.de" class="urlextern" title="ftp://ftp.dlink.de"  rel="nofollow">ftp.dlink.de</a>) it worked the first time, using IE7 on a virtualbox Win XP &quot;guest&quot;. <abbr title="Your mileage may vary">YMMV</abbr>.</div>
</li>
</ul>

</div>

<h4 id="phase_2general_steps">Phase 2: General steps</h4>
<div class="level4">
<ol>
<li class="level1"><div class="li"> Get into the D-Link recovery console with the steps below:</div>
<ol>
<li class="level2"><div class="li"> While powering up the router, press and hold the <em>reset button</em> until the power LED starts blinking orange (usually takes around 45 (forty-five) seconds )</div>
</li>
<li class="level2"><div class="li"> Set a static IP on your PC to <strong><code>192.168.0.100/24</code></strong></div>
</li>
<li class="level2"><div class="li"> connect to <a href="http://192.168.0.1" class="urlextern" title="http://192.168.0.1"  rel="nofollow">http://192.168.0.1</a>, mind the quirks!</div>
</li>
</ol>
</li>
<li class="level1"><div class="li"> Click &quot;Browse&quot; and select your OpenWrt image file (<strong>openwrt-ar71xx-dir-825-b1-squashfs-factory.bin</strong>, this binary image is available in the Backfire 10.03.1rc1 download directory and above)</div>
</li>
<li class="level1"><div class="li"> Click &quot;Update&quot; and let router flash the image (don&#039;t worry if it reboots before it reaches 100%). The page should display &quot;Device is Upgrading the Firmware&quot; in blue letters with the current percentage in red (with an incompatible Browser it doesn&#039;t). Look at the screenshot at the end of this section.</div>
</li>
<li class="level1"><div class="li"> The router&#039;s power LED should blink orange during bootup, as soon as it stops flashing, you can connect to it</div>
</li>
<li class="level1"><div class="li"> Tip! Note that default DHCP will allocate on 192.168.<strong>1</strong>.x, which is different subnet to the address you allocated above. This is why you can&#039;t connect until you change your IP address.</div>
</li>
<li class="level1"><div class="li"> obtain new IP from the router via DHCP and follow <a href="../../doc/howto/firstlogin" class="wikilink1" title="doc:howto:firstlogin">firstlogin</a></div>
</li>
</ol>

<p>
<a href="../../_detail/media/d-link.dir-825.b2.firmware.recovery.mode.using.ie7.on.wine.in.linux.png?id=toh%253Ad-link%253Adir-825" class="media" title="media:d-link.dir-825.b2.firmware.recovery.mode.using.ie7.on.wine.in.linux.png"><img src="../../_media/media/d-link.dir-825.b2.firmware.recovery.mode.using.ie7.on.wine.in.linux.png?w=400&amp;h=384&amp;tok=53adf7" class="media" title="D-Link DIR-825 B2 after clicking &quot;Update&quot; in Firmware Recovery Mode, using IE7 on Wine in Linux" alt="D-Link DIR-825 B2 after clicking &quot;Update&quot; in Firmware Recovery Mode, using IE7 on Wine in Linux" width="400" height="384" /></a>
</p>

</div>

<h3 class="sectionedit11" id="flash_layout">Flash Layout</h3>
<div class="level3">

<p>
First, for familiarity you can look at the concept of <a href="../../doc/techref/flash.layout" class="wikilink1" title="doc:techref:flash.layout">Flash.Layout</a>. It is also recommended that you know flash layout of DIR-825 before <a href="../../doc/howto/generic.sysupgrade" class="wikilink1" title="doc:howto:generic.sysupgrade">generic.sysupgrade</a>, <a href="../../doc/howto/generic.backup" class="wikilink1" title="doc:howto:generic.backup">generic.backup</a>, <a href="../../doc/howto/generic.debrick" class="wikilink1" title="doc:howto:generic.debrick">generic.debrick</a> or <a href="../../doc/howto/generic.failsafe" class="wikilink1" title="doc:howto:generic.failsafe">generic.failsafe</a>.
</p>
<div class="table sectionedit12"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 centeralign" colspan="9">  D-Link DIR-825 Rev B  Flash Layout  </th>
	</tr>
	</thead>
	<tr class="row1">
		<th class="col0"> Layer0 </th><td class="col1 centeralign" colspan="8">  m25p80 <a href="http://en.wikipedia.org/wiki/Serial Peripheral Interface Bus" class="interwiki iw_wp" title="http://en.wikipedia.org/wiki/Serial Peripheral Interface Bus">spi</a>0.0: s25sl064a 8192KiB  </td>
	</tr>
	<tr class="row2">
		<th class="col0"> Layer1 </th><td class="col1 centeralign">  mtd0 <strong><em>u-boot</em></strong> 256KiB  </td><td class="col2 centeralign">  mtd1 <strong><em>config</em></strong> 64KiB  </td><td class="col3 centeralign" colspan="3">  mtd7 <strong><em>firmware</em></strong> 6208KiB  </td><td class="col6 centeralign">  mtd5 <strong><em>caldata</em></strong> 64KiB  </td><td class="col7 centeralign" colspan="2">  mtd6 <strong><em>unkown</em></strong> 1600KiB  </td>
	</tr>
	<tr class="row3">
		<th class="col0"> Layer2 </th><td class="col1"> </td><td class="col2"> </td><td class="col3 centeralign">  mtd2 <strong><em>kernel</em></strong> 1024KiB  </td><td class="col4 centeralign" colspan="2">  mtd3 <strong><em>rootfs</em></strong> 5184KiB  </td><td class="col6"> </td><td class="col7"> </td><td class="col8 centeralign">  mtd8 <strong><em>caldata_copy</em></strong> 64KiB  </td>
	</tr>
	<tr class="row4">
		<th class="col0"> <span style='color:magenta; '>mountpoint</span> </th><td class="col1"> </td><td class="col2"> </td><td class="col3"> </td><td class="col4 centeralign" colspan="2">  <span style='color:magenta; '><code>/</code></span>  </td><td class="col6"> </td><td class="col7"> </td><td class="col8"> </td>
	</tr>
	<tr class="row5">
		<th class="col0"> filesystem </th><td class="col1"> </td><td class="col2"> </td><td class="col3"> </td><td class="col4 centeralign" colspan="2">  <a href="../../doc/techref/filesystems#overlayfs" class="wikilink1" title="doc:techref:filesystems">overlayfs</a>  </td><td class="col6"> </td><td class="col7"> </td><td class="col8"> </td>
	</tr>
	<tr class="row6">
		<th class="col0"> Layer3 </th><td class="col1"> </td><td class="col2"> </td><td class="col3"> </td><td class="col4"> </td><td class="col5 centeralign">  mtd4 <strong><em>rootfs_data</em></strong> 3328KiB  </td><td class="col6"> </td><td class="col7"> </td><td class="col8"> </td>
	</tr>
	<tr class="row7">
		<th class="col0"> Size in KiB </th><td class="col1 centeralign">  256KiB  </td><td class="col2 centeralign">  64KiB  </td><td class="col3 centeralign">  1024KiB  </td><td class="col4 centeralign">  1856KiB  </td><td class="col5 centeralign">  3328KiB  </td><td class="col6 centeralign">  64KiB  </td><td class="col7 centeralign">  1536KiB  </td><td class="col8 centeralign">  64KiB  </td>
	</tr>
	<tr class="row8">
		<th class="col0"> Name </th><td class="col1 centeralign">  <strong><em>u-boot</em></strong>  </td><td class="col2 centeralign">  <strong><em>config</em></strong>  </td><td class="col3 centeralign">  <strong><em>kernel</em></strong>  </td><td class="col4"> </td><td class="col5 centeralign">  <strong><em>rootfs_data</em></strong>  </td><td class="col6 centeralign">  <strong><em>caldata</em></strong>  </td><td class="col7"> </td><td class="col8 centeralign">  <strong><em>caldata_copy</em></strong>  </td>
	</tr>
	<tr class="row9">
		<th class="col0"> <span style='color:magenta; '>mountpoint</span> </th><td class="col1 centeralign">  <em>none</em>  </td><td class="col2 centeralign">  <em>none</em>  </td><td class="col3 centeralign">  <em>none</em>  </td><td class="col4 centeralign">  <span style='color:magenta; '><code>/rom</code></span>  </td><td class="col5 centeralign">  <span style='color:magenta; '><code>/overlay</code></span>  </td><td class="col6 centeralign">  <em>none</em>  </td><td class="col7 centeralign">  <em>none</em>  </td><td class="col8 centeralign">  <em>none</em>  </td>
	</tr>
	<tr class="row10">
		<th class="col0"> filesystem </th><td class="col1 centeralign">  <em>none</em>  </td><td class="col2 centeralign">  <em>none</em>  </td><td class="col3 centeralign">  <em>none</em>  </td><td class="col4 centeralign">  <a href="../../doc/techref/filesystems#squashfs" class="wikilink1" title="doc:techref:filesystems">SquashFS</a>  </td><td class="col5 centeralign">  <a href="../../doc/techref/filesystems#jffs2" class="wikilink1" title="doc:techref:filesystems">JFFS2</a>  </td><td class="col6 centeralign">  <em>none</em>  </td><td class="col7 centeralign">  <em>none</em>  </td><td class="col8 centeralign">  <em>none</em>  </td>
	</tr>
</table></div>

<p>
<strong>*Note</strong>* The partitions &quot;mtd1 <strong><em>config</em></strong>&quot;, &quot;mtd5 <strong><em>caldata</em></strong>&quot;, &quot;mtd6 <strong><em>unkown</em></strong>&quot; and &quot;mtd8 <strong><em>caldata_copy</em></strong>&quot; contain vendor specific raw (without filesystem) config values about your router, like WiFi calibration data, MAC addresses, etc. It&#039;s a good idea to <a href="../../doc/howto/generic.backup" class="wikilink1" title="doc:howto:generic.backup">make a backup from them</a>. Similarly, &quot;mtd0 <strong><em>u-boot</em></strong>&quot; has some specific codes for Dir-825 (e.g. its &quot;firmware recovery mode&quot;); So you can backup that partition too.
</p>

<p>
<strong>*Note2</strong>* You can check mtd partitions of your router yourself by using commands &quot;<code>cat /proc/mtd</code>&quot; and &quot;<code>dmesg</code>&quot;. Refer to <a href="https://www.mail-archive.com/kernelnewbies@nl.linux.org/msg02774.html" class="urlextern" title="https://www.mail-archive.com/kernelnewbies@nl.linux.org/msg02774.html"  rel="nofollow">this link</a>.
</p>

</div>

<h3 class="sectionedit13" id="upgrading_openwrt">Upgrading OpenWrt</h3>
<div class="level3">

<p>
→<a href="../../doc/howto/generic.sysupgrade" class="wikilink1" title="doc:howto:generic.sysupgrade">generic.sysupgrade</a>
</p>

</div>

<h3 class="sectionedit14" id="openwrt_failsafe_mode">OpenWrt failsafe mode</h3>
<div class="level3">

<p>
→<a href="../../doc/howto/generic.failsafe" class="wikilink1" title="doc:howto:generic.failsafe">generic.failsafe</a>
</p>

</div>

<h3 class="sectionedit15" id="firmware_recovery">Firmware recovery</h3>
<div class="level3">

<p>
→<a href="../../doc/howto/generic.debrick" class="wikilink1" title="doc:howto:generic.debrick">generic.debrick</a>
</p>

</div>

<h2 class="sectionedit16" id="basic_configuration">Basic configuration</h2>
<div class="level2">

<p>
Since this part is identical for all devices, see <a href="../../doc/howto/configuration" class="wikilink1" title="doc:howto:basic.config">Basic configuration</a>.
</p>

<p>
→<a href="../../doc/howto/wireless.overview" class="wikilink1" title="doc:howto:wireless.overview">wireless.overview</a> This router requires the packages <code>kmod-ath9k</code> and <code>wpad-mini</code>.
</p>

</div>

<h2 class="sectionedit17" id="hardware">Hardware</h2>
<div class="level2">

</div>

<h3 class="sectionedit18" id="info">Info</h3>
<div class="level3">
<div class="table sectionedit19"><table class="inline">
	<tr class="row0">
		<td class="col0 leftalign"> <strong><a href="http://en.wikipedia.org/wiki/Instruction set" class="interwiki iw_wp" title="http://en.wikipedia.org/wiki/Instruction set">Architecture</a>:</strong>    </td><td class="col1"> <a href="http://en.wikipedia.org/wiki/MIPS architecture" class="interwiki iw_wp" title="http://en.wikipedia.org/wiki/MIPS architecture">MIPS</a> </td>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> <strong>Vendor:</strong>          </td><td class="col1 leftalign"> <a href="http://en.wikipedia.org/wiki/Qualcomm Atheros" class="interwiki iw_wp" title="http://en.wikipedia.org/wiki/Qualcomm Atheros">Qualcomm Atheros</a>  </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <strong><a href="../../doc/techref/bootloader.1" class="wikilink1" title="doc:techref:bootloader">Bootloader</a>:</strong>     </td><td class="col1"> <a href="../../doc/techref/bootloader/uboot" class="wikilink1" title="doc:techref:bootloader:uboot">U-Boot</a> </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <strong><a href="../../doc/hardware/soc.1" class="wikilink1" title="doc:hardware:soc">System-On-Chip</a>:</strong>  </td><td class="col1"> AR7161 rev 2 (MIPS 24Kc V7.4) </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <strong><a href="../../doc/hardware/cpu" class="wikilink1" title="doc:hardware:cpu">CPU</a>/Speed</strong>        </td><td class="col1 leftalign"> 24Kc V7.4 680 <abbr title="Megahertz">MHz</abbr>  </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> <strong>Flash-Chip:</strong>      </td><td class="col1"> Spansion S25FL064A </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> <strong>Flash size:</strong>      </td><td class="col1"> 8192 KiB </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> <strong>RAM:</strong>             </td><td class="col1 leftalign"> 64 MiB   </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> <strong>Wireless:</strong>        </td><td class="col1"> 2 x Atheros AR922X 2.4GHz/5.0GHz 802.11abgn </td>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> <strong>Ethernet:</strong>        </td><td class="col1"> RealTek RTL8366S Gigabit w/ port based vlan support </td>
	</tr>
	<tr class="row10">
		<td class="col0 leftalign"> <strong>Internet:</strong>        </td><td class="col1 leftalign"> n/a  </td>
	</tr>
	<tr class="row11">
		<td class="col0 leftalign"> <strong>USB:</strong>             </td><td class="col1 leftalign"> Yes 2 x 2.0 (Only 1 header to the outside)    </td>
	</tr>
	<tr class="row12">
		<td class="col0 leftalign"> <strong>Serial:</strong>          </td><td class="col1 leftalign"> <a href="dir-825#serial" title="toh:d-link:dir-825 ↵" class="wikilink1">Yes</a> /dev/ttyS0  </td>
	</tr>
	<tr class="row13">
		<td class="col0 leftalign"> <strong>JTAG:</strong>            </td><td class="col1 leftalign"> <a href="dir-825#jtag" title="toh:d-link:dir-825 ↵" class="wikilink1">Yes</a>  </td>
	</tr>
</table></div>

</div>

<h3 class="sectionedit20" id="photos">Photos</h3>
<div class="level3">

<p>
<a href="../../_detail/toh/d-link/dir825-without-bottom-cover.jpg?id=toh%253Ad-link%253Adir-825" class="media" title="toh:d-link:dir825-without-bottom-cover.jpg"><img src="../../_media/toh/d-link/dir825-without-bottom-cover.jpg?w=400&amp;h=257&amp;tok=20c4a9" class="media" title="D-Link DIR-825 with the bottom cover removed." alt="D-Link DIR-825 with the bottom cover removed." width="400" height="257" /></a>
<a href="../../_detail/toh/d-link/dir825-b2-soldered-bridges-for-second-usb-port.jpg?id=toh%253Ad-link%253Adir-825" class="media" title="toh:d-link:dir825-b2-soldered-bridges-for-second-usb-port.jpg"><img src="../../_media/toh/d-link/dir825-b2-soldered-bridges-for-second-usb-port.jpg?w=400&amp;h=258&amp;tok=cfdbd5" class="media" title="D-Link DIR-825 with bridges soldered to enable second USB port." alt="D-Link DIR-825 with bridges soldered to enable second USB port." width="400" height="258" /></a>
<a href="../../_detail/toh/d-link/dir825-b2-second-usb-in-action.jpg?id=toh%253Ad-link%253Adir-825" class="media" title="toh:d-link:dir825-b2-second-usb-in-action.jpg"><img src="../../_media/toh/d-link/dir825-b2-second-usb-in-action.jpg?w=400&amp;h=251&amp;tok=c58b3b" class="media" title="D-Link DIR-825 B2 with second USB port in use." alt="D-Link DIR-825 B2 with second USB port in use." width="400" height="251" /></a>
<a href="../../_detail/media/dir-825.b2.2nd.usb.wires.order.low.res.jpg?id=toh%253Ad-link%253Adir-825" class="media" title="media:dir-825.b2.2nd.usb.wires.order.low.res.jpg"><img src="../../_media/media/dir-825.b2.2nd.usb.wires.order.low.res.jpg?w=400&amp;h=300&amp;tok=49938e" class="media" title="DIR-825 B2 2nd USB Wires Order" alt="DIR-825 B2 2nd USB Wires Order" width="400" height="300" /></a>
<a href="../../_detail/toh/d-link/dir825-c1-board.jpg?id=toh%253Ad-link%253Adir-825" class="media" title="toh:d-link:dir825-c1-board.jpg"><img src="../../_media/toh/d-link/dir825-c1-board.jpg?w=400&amp;h=251&amp;tok=afb1b7" class="media" title="D-Link DIR-825 C1 board." alt="D-Link DIR-825 C1 board." width="400" height="251" /></a>
<a href="../../_detail/toh/d-link/dir825-c1-ar9344.jpg?id=toh%253Ad-link%253Adir-825" class="media" title="toh:d-link:dir825-c1-ar9344.jpg"><img src="../../_media/toh/d-link/dir825-c1-ar9344.jpg?w=400&amp;h=300&amp;tok=84fbb5" class="media" title="D-Link DIR-825 C1 Atheros chipset." alt="D-Link DIR-825 C1 Atheros chipset." width="400" height="300" /></a>
<a href="../../_detail/toh/d-link/dir825-c1-ram.jpg?id=toh%253Ad-link%253Adir-825" class="media" title="toh:d-link:dir825-c1-ram.jpg"><img src="../../_media/toh/d-link/dir825-c1-ram.jpg?w=250&amp;h=300&amp;tok=0a379a" class="media" title="D-Link DIR-825 C1 RAM chips." alt="D-Link DIR-825 C1 RAM chips." width="250" height="300" /></a>
</p>

</div>

<h3 class="sectionedit21" id="physically_breaking_into_the_dir-825">Physically breaking into the DIR-825</h3>
<div class="level3">

<p>
<strong>Note:</strong> This may void your warranty!
</p>

<p>
To remove the cover simply:
</p>
<ol>
<li class="level1"><div class="li"> Remove the two (2) back rubber feet. (closest to the ethernet ports and antennas)</div>
</li>
<li class="level1"><div class="li"> Unscrew the two (2) screws underneath the feet.</div>
</li>
<li class="level1"><div class="li"> Pry case halves apart from back side to front side, carefully.</div>
</li>
</ol>

<p>
To remove the board from the casing:
</p>
<ol>
<li class="level1"><div class="li"> Unscrew the two (2) front (inner) screws and remove the LED shield.</div>
</li>
<li class="level1"><div class="li"> Lift board from front and slide out in a forward motion.</div>
</li>
</ol>

</div>

<h3 class="sectionedit22" id="serial">Serial</h3>
<div class="level3">
<div class="table sectionedit23"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>  PIN1–&gt;3.3V 
  PIN2–&gt;RX 
  PIN3–&gt;TX 
  PIN4–&gt;GND
</code></td>
	</tr>
</table></div>

<p>
Remember to use <strong>12V</strong>↔<strong>3.3V</strong> serial port voltage converter or you might break the router by over-voltage.
</p>

<p>
COM port settings: Speed:115200, Data bits:8, Stop bits:1, Parity:none, Flow control:none
</p>

</div>

<h3 class="sectionedit24" id="jtag">JTAG</h3>
<div class="level3">

<p>
How to connect to JTAG interface, and how to reflash the device with <a href="http://downloads.openwrt.org/tools/oem/jtag/tools.zip" class="urlextern" title="http://downloads.openwrt.org/tools/oem/jtag/tools.zip"  rel="nofollow">JTAG tools</a>
</p>

<p>
See <a href="../../doc/hardware/port.jtag" class="wikilink1" title="doc:hardware:port.jtag">port.jtag</a> for more JTAG details.
</p>

</div>

<h3 class="sectionedit25" id="leds">LEDs</h3>
<div class="level3">

<p>
See the LED section in <code><a href="../../doc/uci/system" class="wikilink1" title="doc:uci:system">/etc/config/system</a></code> on general LED configuration.
</p>

<p>
The DIR-825 has 11 blue and 2 orange LEDs:  The four <abbr title="Local Area Network">LAN</abbr> LEDs are controlled by the switch chip.  By default they show link and blink for activity.  They are LED Bank 0. To configure the RealTek RTL8366S, you can use <code><a href="../../doc/techref/swconfig" class="wikilink1" title="doc:techref:swconfig">swconfig</a></code>, e.g. <pre class="code">swconfig dev rtl8366s port 0 set led 2</pre>

</p>
<div class="table sectionedit26"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> LED name </th><th class="col1"> LED symbol </th><th class="col2"> Internal name blue </th><th class="col3"> Internal name orange </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> unknown </td><td class="col1"> D-Link </td><td class="col2"> unknown </td><td class="col3"> n/a </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Power </td><td class="col1"> Power </td><td class="col2"> dir825b1:blue:power </td><td class="col3"> dir825b1:orange:power </td>
	</tr>
	<tr class="row3">
		<td class="col0"> Planet </td><td class="col1"> Planet </td><td class="col2"> dir825b1:blue:planet </td><td class="col3"> dir825b1:orange:planet </td>
	</tr>
	<tr class="row4">
		<td class="col0"> Wireless <abbr title="Local Area Network">LAN</abbr> 2.4 <abbr title="Gigahertz">GHz</abbr> </td><td class="col1"> Waves (2.4GHz) </td><td class="col2"> ath9k-phy0::phy0tpt </td><td class="col3"> n/a </td>
	</tr>
	<tr class="row5">
		<td class="col0"> Wireless <abbr title="Local Area Network">LAN</abbr> 5 <abbr title="Gigahertz">GHz</abbr> </td><td class="col1"> Waves (5GHz) </td><td class="col2"> ath9k-phy1::phy0tpt </td><td class="col3"> n/a </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <abbr title="Local Area Network">LAN</abbr> Port 1 </td><td class="col1"> PC (1) </td><td class="col2"> n/a </td><td class="col3"> n/a </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <abbr title="Local Area Network">LAN</abbr> Port 2 </td><td class="col1"> PC (2) </td><td class="col2"> n/a </td><td class="col3"> n/a </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <abbr title="Local Area Network">LAN</abbr> Port 3 </td><td class="col1"> PC (3) </td><td class="col2"> n/a </td><td class="col3"> n/a </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <abbr title="Local Area Network">LAN</abbr> Port 4 </td><td class="col1"> PC (4) </td><td class="col2"> n/a </td><td class="col3"> n/a </td>
	</tr>
	<tr class="row10">
		<td class="col0"> Universal Serial Bus </td><td class="col1"> USB </td><td class="col2"> dir825b1:blue:usb </td><td class="col3"> n/a </td>
	</tr>
	<tr class="row11">
		<td class="col0"> WPS </td><td class="col1"> Two arrows </td><td class="col2"> dir825b1:blue:powersave </td><td class="col3"> n/a </td>
	</tr>
</table></div>

</div>

<h4 id="repair_leds_after_flashing_openwrt">Repair LEDs after flashing OpenWRT</h4>
<div class="level4">

<p>
If you want to see the BLUE POWER ON and the BLUE GLOBE ( planet ) blinking when it receives information, then do the following setup:
</p>

<p>
<a href="../../_detail/toh/d-link/7_repair_leds.png?id=toh%253Ad-link%253Adir-825" class="media" title="toh:d-link:7_repair_leds.png"><img src="../../_media/toh/d-link/7_repair_leds.png" class="media" alt="" /></a>
</p>

<p>
For UCI configuration of the LEDs use this set of commands:
</p>
<pre class="code">uci set system.led_wan_orange=led
uci set system.led_wan_orange.sysfs=d-link:orange:planet
uci set system.led_wan_orange.default=1
uci set system.led_wan_blue=led
uci set system.led_wan_blue.default=1
uci set system.led_wan_blue.sysfs=d-link:blue:planet
uci set system.led_wan_blue.trigger=netdev
uci set system.led_wan_blue.dev=eth1
uci set system.led_wan_blue.mode=link tx rx
uci set system.led_power_orange=led
uci set system.led_power_orange.sysfs=d-link:orange:power
uci set system.led_power_orange.default=0
uci set system.led_power_blue=led
uci set system.led_power_blue.sysfs=d-link:blue:power
uci set system.led_power_blue.default=1
uci commit system</pre>

<p>
After rebooting the device this setup becomes active.
</p>

</div>

<h3 class="sectionedit27" id="buttons">Buttons</h3>
<div class="level3">

<p>
→<a href="../../doc/howto/hardware.button" class="wikilink1" title="doc:howto:hardware.button">hardware.button</a>
</p>

<p>
The D-Link DIR-825 has two buttons:
</p>
<div class="table sectionedit28"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> BUTTON </th><th class="col1"> Event </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> Reset </td><td class="col1"> <a href="http://dev.openwrt.org/browser/trunk/target/linux/ar71xx/files/arch/mips/ar71xx/mach-dir-825-b1.c#L36" class="urlextern" title="http://dev.openwrt.org/browser/trunk/target/linux/ar71xx/files/arch/mips/ar71xx/mach-dir-825-b1.c#L36"  rel="nofollow">reset</a> </td>
	</tr>
	<tr class="row2">
		<td class="col0"> WPS </td><td class="col1"> <a href="http://dev.openwrt.org/browser/trunk/target/linux/ar71xx/files/arch/mips/ar71xx/mach-dir-825-b1.c#L37" class="urlextern" title="http://dev.openwrt.org/browser/trunk/target/linux/ar71xx/files/arch/mips/ar71xx/mach-dir-825-b1.c#L37"  rel="nofollow">powersave</a> </td>
	</tr>
</table></div>

<p>
The WPS (WiFi Protected Setup) button is located at the right side (or the top when standing) and can be easily pressed with a finger. Also the WPS LED is integrated into the Button.  For some unknown reason this control is named powersave in various places.
</p>

<p>
The Reset button is located at the back and cannot be pressed with a finger, you need a small item to push it in.
</p>

</div>

<h2 class="sectionedit29" id="hardware_mods">Hardware Mods</h2>
<div class="level2">

</div>

<h3 class="sectionedit30" id="second_usb_port">Second USB port</h3>
<div class="level3">

<p>
It was reported that in order to enable second USB port it is sufficient to solder in two straight bridges in place of L66 (take a look to the corresponding photo in the &quot;Photos&quot; section). After that you will need to solder in second USB header or - easier way - to solder in short-tailed female USB type A connector (sample photo is also available in the &quot;Photos&quot; section).
</p>

<p>
In the stock firmware, after you have soldered the bridges and USB head, if you connect a USB device (e.g. a USB Flash Drive) to the second USB head, the USB LED will turn blue.
</p>

<p>
Discussion and more information can be found in this <a href="https://forum.openwrt.org/viewtopic.php?id=24399" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=24399"  rel="nofollow">thread</a>.
</p>

</div>

<h3 class="sectionedit31" id="mb_ram_mod">128 MB RAM Mod</h3>
<div class="level3">

<p>
vavasik did this mod and reported his experiences in this <a href="https://forum.openwrt.org/viewtopic.php?id=26416" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=26416"  rel="nofollow">thread</a>.
</p>

<p>
He used two Samsung K4H511638D-UCB3 chips from Samsung DDR SODIMM 512 <abbr title="Megabyte">MB</abbr>. Maybe other chips from other manufacturers can be used, only they has to have 32Mx16 organization. Chips with other organization, such as 64Mx8, are not suitable.
</p>

<p>
Next to the soldering, the bootloader (U-Boot) and the calibration data partition has to be changed, because the D-Link bootloader/calibration data partition does not start with the 128 <abbr title="Megabyte">MB</abbr> RAM. He used the bootloader/calibration data partition from Netgear WNDR3700. It&#039;s done through a full reflash, check the forum for the binary. It turn the D-Link DIR-825 into an Netgear WNDR3700.
</p>

<p>
The Netgear stock firmware does not recognize the 128 <abbr title="Megabyte">MB</abbr> RAM, it only shows/uses 64 <abbr title="Megabyte">MB</abbr> RAM, but it starts.
</p>

<p>
An detailed tutorial from vavasik can be found <a href="https://forum.openwrt.org/viewtopic.php?pid=118886#p118886" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?pid=118886#p118886"  rel="nofollow">here</a>.
</p>

<p>
<strong>Don&#039;t do this if your are inexperienced in soldering, you will for sure destroy the contacts→Trash!</strong>
</p>

<p>
<a href="../../_detail/toh/d-link/dir825-128mb-ram-mod.jpg?id=toh%253Ad-link%253Adir-825" class="media" title="toh:d-link:dir825-128mb-ram-mod.jpg"><img src="../../_media/toh/d-link/dir825-128mb-ram-mod.jpg?w=400&amp;h=257&amp;tok=ce8438" class="media" title="D-Link DIR-825 B2 with 128 MB RAM Mod" alt="D-Link DIR-825 B2 with 128 MB RAM Mod" width="400" height="257" /></a>
</p>

</div>

<h2 class="sectionedit32" id="connection_information">Connection Information</h2>
<div class="level2">

<p>
→<a href="http://wiki.openwrt.org/doc/techref/internal_layout" class="wikilink2" title="doc:techref:internal_layout" rel="nofollow">Internal Layout</a>
</p>

</div>

<h2 class="sectionedit33" id="other_info">Other Info</h2>
<div class="level2">

<p>
Feel free to add here any info we haven&#039;t covered yet! Thank you!
</p>

<p>
I was able to upload the openwrt-ar71xx-generic-dir-825-b1-squashfs-factory.bin in recovery mode with Internet Explorer with compatibility view enabled (menu Tools/Compatibility View). Without it it was loading forever. Other browsers (Chrome, Firefox, Opera) were not working. Tested with Windows and Linux. Also I switched my 1Gbit cart into 100Mbit mode.
</p>

<p>
It may be necessary to run the original firmware and configure the device at least once. I flashed the router right away using the firmware recovery interface which resulted in configuration problems in OpenWrt. All wireless network devices did not have valid MACs instead they used 00:00:00:00:00:00 and refused therefore to work properly. Even trying to read the MAC from the sysfs failed. After flashing the original firmware and configuring the device once using the D-Link Webinterface everything worked as expected after flashing OpenWrt again.
</p>

<p>
Besides flashing in recovery mode from a MacBook Pro using Google Chrome and the default Gigabit plug worked just fine!
</p>

<p>
I had installed the openwrt-ar71xx-generic-dir-825-b1-squashfs-factory.bin using a Ubuntu system with Chrome using the original firmware update page in a DI-825 Rev B1 with FW 2.07NA
</p>
<hr />

</div>

<h2 class="sectionedit34" id="vlan_configuration_on_lan-port_4">VLAN Configuration ( on LAN-Port 4)</h2>
<div class="level2">

</div>

<h3 class="sectionedit35" id="introduction">1) Introduction</h3>
<div class="level3">

</div>

<h4 id="what_is_vlan">What is VLAN?</h4>
<div class="level4">

<p>
Read about <a href="http://en.wikipedia.org/wiki/Virtual_Local_Area_Network" class="interwiki iw_wp" title="http://en.wikipedia.org/wiki/Virtual_Local_Area_Network">VLAN</a>
</p>

</div>

<h4 id="situation_-_6_global_ips_from_the_isp">Situation - 6 global IPs from the ISP</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> Gateway: 210.190.90.33</div>
</li>
<li class="level1"><div class="li"> SN-Mask: 255.255.255.248</div>
</li>
<li class="level1"><div class="li"> ISP IPs: 210.190.90.34 - 210.190.90.38</div>
</li>
<li class="level1"><div class="li"> Router Model: D-Link DIR-825 rev. B1</div>
</li>
<li class="level1"><div class="li"> Firmware Version: OpenWrt Backfire 10.03.1 / LuCI 0.10.0 Release (0.10.0)</div>
</li>
<li class="level1"><div class="li"> Kernel Version: 2.6.32.27</div>
</li>
</ul>

</div>

<h4 id="what_is_the_aim">What is the aim ?</h4>
<div class="level4">

<p>
Separate the <abbr title="Local Area Network">LAN</abbr>-Switch in such a manner, so that you can use the 4th <abbr title="Local Area Network">LAN</abbr>-Port as a global Port for the 6 given IPs from your ISP.
</p>

<p>
<pre class="code"> Internet
 |
 ISP
 |
 D-825 Router with openWRT
 |_______________________________.
 | LAN1 | LAN2 | LAN3 |   LAN4   |
 |                    |    |     
 |  your local LAN    |  Switch Netgear ProSafe 5
 |   192.168.1.1      |    |
 |                    |  global ips from your ISP
 |____________________|_ 210.190.90.34 - 210.190.90.38</pre>

</p>

</div>

<h3 class="sectionedit36" id="setup_vlan">2) Setup VLAN</h3>
<div class="level3">

<p>
o) Go to <strong>Network / Switch</strong> and do the configuration as shown:
</p>

<p>
<strong>Separating the LAN1 + LAN2 + LAN3 from the LAN4</strong>
</p>

<p>
<a href="../../_detail/toh/d-link/vlan.setup.separates.lan1.lan2.lan3.from.lan4.png?id=toh%253Ad-link%253Adir-825" class="media" title="toh:d-link:vlan.setup.separates.lan1.lan2.lan3.from.lan4.png"><img src="../../_media/toh/d-link/vlan.setup.separates.lan1.lan2.lan3.from.lan4.png" class="media" alt="" /></a>
</p>

<p>
Very important is to hit the <strong>SAVE</strong> button ( !!! not the Save &amp; Apply !!!)
</p>

<p>
In case if you wonder why the port 0 (zero) corresponds to the 4th <abbr title="Local Area Network">LAN</abbr>-port, see this: <span class="curid"><a href="dir-825#switchports" class="wikilink1" title="toh:d-link:dir-825">switch.ports</a></span>
</p>

<p>
o) Go to <strong>Network / Interfaces / <abbr title="Local Area Network">LAN</abbr> / Physical Settings</strong> and do the following:
</p>

<p>
 ( you have to change the settings from &quot;eth0&quot; to &quot;eth0.1&quot; )
</p>

<p>
<a href="../../lib/exe/fetch.php?tok=4b2d4c&amp;media=http%253A%252F%252Fwiki.openwrt.org%252F_media%252Ftoh%252Fd-link%252Fphysical.settings.for.the.lan-interface.vlan.png" class="media" title="http://wiki.openwrt.org/_media/toh/d-link/physical.settings.for.the.lan-interface.vlan.png"><img src="../../lib/exe/fetch.php?tok=4b2d4c&amp;media=http%253A%252F%252Fwiki.openwrt.org%252F_media%252Ftoh%252Fd-link%252Fphysical.settings.for.the.lan-interface.vlan.png" class="media" alt="" /></a>
</p>

<p>
Now you should hit the button <strong>&quot;Save &amp; Apply&quot;</strong> !!!
</p>

<p>
( Info: wait a bit and then you will see that your router is not responding any more → this is normal, give him a little time ( 1min max) then unplug the power supply from the router, then wait 10sec and plug it back in! )
</p>

<p>
o) Go to <strong>Network / Interfaces</strong>
</p>

<p>
You will find here only the <abbr title="Local Area Network">LAN</abbr> (green) and WAN (red) interfaces. Now we will have to add the VLAN-Interface ( I called it GLAN, you can call it GAN - it doesn&#039;t matter) - the G because of the global IPs!
</p>

<p>
o) Adding the <strong>GLAN</strong> Interface
</p>

<p>
a) Add new interfaces
</p>

<p>
b) Type in the name for the new interface: <strong>GLAN</strong> ( this is in my case, u can call it whatever u want)
</p>

<p>
c) Protocal of the new interface: Static address
</p>

<p>
d) Create a bridge over multiple interfaces: NO
</p>

<p>
e) Cover the following interface: VLAN Interface: &quot;eth0.2&quot;
</p>

<p>
f) Hit the <strong>Submit</strong> button
</p>

<p>
<strong>GLAN</strong> configuration overview:
</p>

<p>
<a href="../../_detail/toh/d-link/5_interface_glan_configuration.png?id=toh%253Ad-link%253Adir-825" class="media" title="toh:d-link:5_interface_glan_configuration.png"><img src="../../_media/toh/d-link/5_interface_glan_configuration.png" class="media" alt="" /></a>
</p>

<p>
This is what you will see, when you click the <strong>Interfaces</strong>
</p>

<p>
<a href="../../lib/exe/fetch.php?tok=b74858&amp;media=http%253A%252F%252Fwiki.openwrt.org%252F_media%252Ftoh%252Fd-link%252Fnetwork_interfaces_without_vlan-interface.png" class="media" title="http://wiki.openwrt.org/_media/toh/d-link/network_interfaces_without_vlan-interface.png"><img src="../../lib/exe/fetch.php?tok=b74858&amp;media=http%253A%252F%252Fwiki.openwrt.org%252F_media%252Ftoh%252Fd-link%252Fnetwork_interfaces_without_vlan-interface.png" class="media" alt="" /></a>
</p>

<p>
This is what you should see, after you added the GLAN Interface
</p>

<p>
<a href="../../lib/exe/fetch.php?tok=d41b9c&amp;media=http%253A%252F%252Fwiki.openwrt.org%252F_media%252Ftoh%252Fd-link%252F3_network_interfaces_with_glan-interface.png" class="media" title="http://wiki.openwrt.org/_media/toh/d-link/3_network_interfaces_with_glan-interface.png"><img src="../../lib/exe/fetch.php?tok=d41b9c&amp;media=http%253A%252F%252Fwiki.openwrt.org%252F_media%252Ftoh%252Fd-link%252F3_network_interfaces_with_glan-interface.png" class="media" alt="" /></a>
</p>

<p>
To be sure that you have the right settings, check the <strong>/etc/config/network</strong> output:
<pre class="code">root@dir825:~# cat /etc/config/network

config &#039;interface&#039; &#039;loopback&#039;
        option &#039;ifname&#039; &#039;lo&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
        option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;lan&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;192.168.1.1&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
        option &#039;_orig_ifname&#039; &#039;eth0&#039;
        option &#039;_orig_bridge&#039; &#039;true&#039;
        option &#039;type&#039; &#039;bridge&#039;
        option &#039;ifname&#039; &#039;eth0.1&#039;

config &#039;interface&#039; &#039;wan&#039;
        option &#039;ifname&#039; &#039;eth1&#039;
        option &#039;proto&#039; &#039;dhcp&#039;

config &#039;switch&#039;
        option &#039;name&#039; &#039;rtl8366s&#039;
        option &#039;reset&#039; &#039;1&#039;
        option &#039;enable_vlan&#039; &#039;1&#039;
        option &#039;enable_vlan4k&#039; &#039;1&#039;

config &#039;switch_vlan&#039;
        option &#039;device&#039; &#039;rtl8366s&#039;
        option &#039;vlan&#039; &#039;1&#039;
        option &#039;ports&#039; &#039;1 2 3 5t&#039;

config &#039;switch_vlan&#039;
        option &#039;device&#039; &#039;rtl8366s&#039;
        option &#039;vlan&#039; &#039;2&#039;
        option &#039;ports&#039; &#039;0 5t&#039;

config &#039;interface&#039; &#039;GLAN&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ifname&#039; &#039;eth0.2&#039;
        option &#039;ipaddr&#039; &#039;210.190.90.33&#039;
        option &#039;netmask&#039; &#039;255.255.255.248&#039;</pre>

</p>

</div>

<h3 class="sectionedit37" id="firewallcontrol_traffic">3) Firewall: control traffic</h3>
<div class="level3">

<p>
o) Go to <strong>Network / Firewall</strong> and add a new GLAN-Zone:
</p>

<p>
a) name: GLAN
</p>

<p>
b) Input: accept
</p>

<p>
c) Output: accept
</p>

<p>
d) Forward: accept
</p>

<p>
e) Masquerading: YES
</p>

<p>
f) MSS clamping: YES
</p>

<p>
g) Covered networks: GLAN
</p>

<p>
h) Hit the <strong>Save &amp; Apply</strong> button
</p>

<p>
<a href="../../_detail/toh/d-link/5_interface_glan_firewall_zone.png?id=toh%253Ad-link%253Adir-825" class="media" title="toh:d-link:5_interface_glan_firewall_zone.png"><img src="../../_media/toh/d-link/5_interface_glan_firewall_zone.png" class="media" alt="" /></a>
</p>

<p>
o) Then check if <strong>GLAN</strong> is assigned to the correct firwall zone:
</p>

<p>
<a href="../../_detail/toh/d-link/6_glan_firewall_zone.png?id=toh%253Ad-link%253Adir-825" class="media" title="toh:d-link:6_glan_firewall_zone.png"><img src="../../_media/toh/d-link/6_glan_firewall_zone.png" class="media" alt="" /></a>
</p>

<p>
o) Go To <strong>Network / Firewall / Custom Rules</strong> and add the following lines (be aware to make changes for your own IPs | also the names of the variable can be changed)
</p>

<p>
<pre class="code"># This file is interpreted as shell script.
# Put your custom iptables rules here, they will
# be executed with each firewall (re-)start.

#################
### Variables ###
###################################################

# public ip
PUBLIC=&quot;210.190.90.0/29&quot;
# HOSTS
FTP=&quot;210.190.90.34&quot;
DNS1=&quot;210.190.90.35&quot;
DNS2=&quot;210.190.90.36&quot;
MAIL=&quot;210.190.90.37&quot;
BACKUP=&quot;210.190.90.38&quot;

# gets the wan-ip address
WANIP=`nvram get wan_ipaddr`

###################################################
# disable NAT for FTP -&gt; WAN
iptables -t nat -I POSTROUTING -s $PUBLIC -j ACCEPT

###################################################
# allow traffic to routed public net
iptables -I FORWARD -o eth0.2 -j ACCEPT

###################################################
# block public -&gt; lan, allow lan -&gt; public
iptables -I FORWARD -i eth0.2 -o br0 -m state --state NEW -j DROP

###################################################
# block access to the router GUI/telnet/DNS/etc. from PUBLIC net, allow from HOSTS
iptables -I INPUT -i eth0.2 -j DROP
iptables -I INPUT -s $FTP -j ACCEPT
iptables -I INPUT -s $DNS1 -j ACCEPT
iptables -I INPUT -s $DNS2 -j ACCEPT
iptables -I INPUT -s $MAIL -j ACCEPT
iptables -I INPUT -s $BACKUP -j ACCEPT

###################################################
# block access to WAN IP from PUBLIC net
iptables -I INPUT -i eth0.2 -d $WANIP -j DROP</pre>

</p>

<p>
Now hit the <strong>Save &amp; Apply</strong> button
</p>

</div>

<h3 class="sectionedit38" id="setup_machine_connected_to_vlan">4) Setup machine connected to VLAN</h3>
<div class="level3">

<p>
This are the settings of your machine (ex. <abbr title="File Transfer Protocol">FTP</abbr>):
</p>

<p>
<pre class="code">IP: 210.190.90.34
SM: 255.255.255.248
GW: 210.190.90.33
DNS: 210.190.90.33</pre>

</p>

<p>
!!! Be aware to turn ON a firewall, because now the machine is exposed to the public !!!
</p>
<hr />

</div>

<h2 class="sectionedit39" id="a_c_program_to_flash_dir-825">A C Program to flash DIR-825</h2>
<div class="level2">

<p>
The following program allows you to flash the DIR-825 from Linux without need of a VM with Windows with IE6.
</p>

<p>
The DIR-825 requires some rather peculiar TCP settings, and relies on some broken IE6 behaviour, which is why flashing with Firefox on Linux (or Firefox on Windows) doesn&#039;t work.  The ruby script on the next section does *NOT* always work for this reason (perhaps due to different versions of ruby or underlying <abbr title="Operating System">OS</abbr> having different defaults).
</p>

<p>
I therefore have hacked on (it&#039;s not nearly my best work) a basic &#039;C&#039; program that flashes the DIR-825 (and probably DIR-600/601 as well).  It uses the HTTP headers as IE6 and uses the required TCP settings under Linux.
</p>

<p>
To use this program save as dlinkflash.c and do
</p>

<p>
<pre class="code">gcc -o dlinkflash dlinkflash.c</pre>

</p>

<p>
Then copy dlinkflash to some location in your PATH, or do ./dlinkflash &lt;firmware-filenname&gt;
</p>

<p>
<pre class="code c"><span class="coMULTI">/* dlinkflash - Tool flash older d-link routers via emergency web interface
 *
 * You must have 192.168.0.x/24 (where X=2-254) IP address on the
 * interface connected to the d-link and use the emergency flashing interface
 *
 * Copyright 2014 Daniel Dickinson
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. 
 */</span>
&nbsp;
<span class="co2">#include &lt;sys/types.h&gt;</span>
<span class="co2">#include &lt;sys/socket.h&gt;</span>
<span class="co2">#include &lt;unistd.h&gt;</span>
<span class="co2">#include &lt;stdlib.h&gt;</span>
<span class="co2">#include &lt;regex.h&gt;</span>
<span class="co2">#include &lt;stdint.h&gt;</span>
<span class="co2">#include &lt;string.h&gt;</span>
<span class="co2">#include &lt;stdio.h&gt;</span>
<span class="co2">#include &lt;netinet/in.h&gt;</span>
<span class="co2">#include &lt;netinet/tcp.h&gt;</span>
<span class="co2">#include &lt;arpa/inet.h&gt;</span>
<span class="co2">#include &lt;errno.h&gt;</span>
&nbsp;
<span class="kw4">void</span> build_post_bin<span class="br0">&#40;</span><span class="kw4">uint8_t</span> <span class="sy0">**</span>post<span class="sy0">,</span> <span class="kw4">size_t</span> <span class="sy0">*</span>post_len<span class="sy0">,</span> <span class="kw4">uint8_t</span> <span class="sy0">*</span>newdata<span class="sy0">,</span> <span class="kw4">size_t</span> datalen<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw4">uint8_t</span> <span class="sy0">*</span>newpost <span class="sy0">=</span> NULL<span class="sy0">;</span>
&nbsp;
    newpost <span class="sy0">=</span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/malloc.html"><span class="kw3">malloc</span></a><span class="br0">&#40;</span><span class="br0">&#40;</span><span class="sy0">*</span>post_len <span class="sy0">+</span> datalen<span class="br0">&#41;</span> <span class="sy0">*</span> <span class="kw4">sizeof</span><span class="br0">&#40;</span><span class="kw4">uint8_t</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">*</span>post<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<a href="http://www.opengroup.org/onlinepubs/009695399/functions/memcpy.html"><span class="kw3">memcpy</span></a><span class="br0">&#40;</span>newpost<span class="sy0">,</span> <span class="sy0">*</span>post<span class="sy0">,</span> <span class="sy0">*</span>post_len<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
        <span class="sy0">*</span>post_len <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/memcpy.html"><span class="kw3">memcpy</span></a><span class="br0">&#40;</span>newpost <span class="sy0">+</span> <span class="sy0">*</span>post_len<span class="sy0">,</span> newdata<span class="sy0">,</span> datalen<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="sy0">*</span>post_len <span class="sy0">+=</span> datalen<span class="sy0">;</span>    
    <span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">*</span>post<span class="br0">&#41;</span>
	<a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span><span class="sy0">*</span>post<span class="br0">&#41;</span><span class="sy0">;</span>    
    <span class="sy0">*</span>post <span class="sy0">=</span> newpost<span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">void</span> build_post<span class="br0">&#40;</span><span class="kw4">uint8_t</span> <span class="sy0">**</span>post<span class="sy0">,</span> <span class="kw4">size_t</span> <span class="sy0">*</span>post_len<span class="sy0">,</span> <span class="kw4">char</span> <span class="sy0">*</span>newchar<span class="sy0">,</span> <span class="kw4">size_t</span> <span class="sy0">*</span>content_len<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw4">uint8_t</span> <span class="sy0">*</span>newpost <span class="sy0">=</span> NULL<span class="sy0">;</span>
    <span class="kw4">size_t</span> nlen<span class="sy0">;</span>
    build_post_bin<span class="br0">&#40;</span>post<span class="sy0">,</span> post_len<span class="sy0">,</span> newchar<span class="sy0">,</span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/strlen.html"><span class="kw3">strlen</span></a><span class="br0">&#40;</span>newchar<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>content_len<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="sy0">*</span>content_len <span class="sy0">+=</span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/strlen.html"><span class="kw3">strlen</span></a><span class="br0">&#40;</span>newchar<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">void</span> usage<span class="br0">&#40;</span><span class="kw4">char</span> <span class="sy0">*</span>exename<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Usage: %s &lt;filename&gt; [-d]<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> exename<span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;   Interface attached to d-link must have IP addres 192.168.0.x/24 where x != 1<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">&#40;</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">int</span> open_socket<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw4">int</span> sock <span class="sy0">=</span> socket<span class="br0">&#40;</span>AF_INET<span class="sy0">,</span> SOCK_STREAM<span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw4">unsigned</span> <span class="kw4">int</span> tcpflush <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
    <span class="kw4">unsigned</span> <span class="kw4">int</span> recvbufsz <span class="sy0">=</span> <span class="nu0">512</span><span class="sy0">;</span>
    <span class="kw4">unsigned</span> <span class="kw4">int</span> smallwindow <span class="sy0">=</span> <span class="nu0">512</span><span class="sy0">;</span>
    <span class="kw4">unsigned</span> <span class="kw4">int</span> mss <span class="sy0">=</span> <span class="nu0">1024</span><span class="sy0">;</span>
&nbsp;
    setsockopt<span class="br0">&#40;</span>sock<span class="sy0">,</span> SOL_SOCKET<span class="sy0">,</span> SO_RCVBUF<span class="sy0">,</span> <span class="sy0">&amp;</span>recvbufsz<span class="sy0">,</span> <span class="kw4">sizeof</span><span class="br0">&#40;</span>recvbufsz<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    setsockopt<span class="br0">&#40;</span>sock<span class="sy0">,</span> SOL_SOCKET<span class="sy0">,</span> SO_SNDBUF<span class="sy0">,</span> <span class="sy0">&amp;</span>recvbufsz<span class="sy0">,</span> <span class="kw4">sizeof</span><span class="br0">&#40;</span>recvbufsz<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    setsockopt<span class="br0">&#40;</span>sock<span class="sy0">,</span> IPPROTO_IP<span class="sy0">,</span> TCP_NODELAY<span class="sy0">,</span> <span class="sy0">&amp;</span>tcpflush<span class="sy0">,</span> <span class="kw4">sizeof</span><span class="br0">&#40;</span>tcpflush<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    setsockopt<span class="br0">&#40;</span>sock<span class="sy0">,</span> IPPROTO_IP<span class="sy0">,</span> TCP_MAXSEG<span class="sy0">,</span> <span class="sy0">&amp;</span>mss<span class="sy0">,</span> <span class="kw4">sizeof</span><span class="br0">&#40;</span>mss<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    setsockopt<span class="br0">&#40;</span>sock<span class="sy0">,</span> IPPROTO_IP<span class="sy0">,</span> TCP_WINDOW_CLAMP<span class="sy0">,</span> <span class="sy0">&amp;</span>smallwindow<span class="sy0">,</span> <span class="kw4">sizeof</span><span class="br0">&#40;</span>smallwindow<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="kw4">struct</span> sockaddr_in ipaddr<span class="sy0">;</span>
    in_addr_t hostip <span class="sy0">=</span> inet_addr<span class="br0">&#40;</span><span class="st0">&quot;192.168.0.1&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    ipaddr.<span class="me1">sin_family</span> <span class="sy0">=</span> AF_INET<span class="sy0">;</span>
    ipaddr.<span class="me1">sin_port</span> <span class="sy0">=</span> htons<span class="br0">&#40;</span><span class="nu0">80</span><span class="br0">&#41;</span><span class="sy0">;</span>
    ipaddr.<span class="me1">sin_addr</span>.<span class="me1">s_addr</span> <span class="sy0">=</span> hostip<span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>connect<span class="br0">&#40;</span>sock<span class="sy0">,</span> <span class="br0">&#40;</span><span class="kw4">struct</span> sockaddr <span class="sy0">*</span><span class="br0">&#41;</span><span class="sy0">&amp;</span>ipaddr<span class="sy0">,</span> <span class="kw4">sizeof</span><span class="br0">&#40;</span><span class="kw4">struct</span> sockaddr<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">return</span> <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <span class="kw1">return</span> sock<span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">void</span> send_get<span class="br0">&#40;</span><span class="kw4">int</span> <span class="sy0">*</span>sock<span class="sy0">,</span> <span class="kw4">uint8_t</span> <span class="sy0">*</span>get<span class="sy0">,</span> <span class="kw4">size_t</span> getlen<span class="sy0">,</span> <span class="kw4">uint8_t</span> <span class="sy0">*</span>post<span class="sy0">,</span> <span class="kw4">int</span> debug<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw4">size_t</span> socksent <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    <span class="kw4">size_t</span> curpos <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    <span class="sy0">*</span>sock <span class="sy0">=</span> open_socket<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">*</span>sock <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/perror.html"><span class="kw3">perror</span></a><span class="br0">&#40;</span><span class="st0">&quot;send_get&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>get<span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span>post<span class="br0">&#41;</span>
            <a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>post<span class="br0">&#41;</span><span class="sy0">;</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">&#40;</span><span class="nu0">7</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <span class="kw1">while</span> <span class="br0">&#40;</span>curpos <span class="sy0">&lt;</span> getlen<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span><span class="br0">&#40;</span>getlen <span class="sy0">-</span> curpos<span class="br0">&#41;</span> <span class="sy0">&gt;=</span> <span class="nu0">512</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	    socksent <span class="sy0">=</span> send<span class="br0">&#40;</span><span class="sy0">*</span>sock<span class="sy0">,</span> get <span class="sy0">+</span> curpos<span class="sy0">,</span> <span class="nu0">512</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="kw1">if</span> <span class="br0">&#40;</span>debug<span class="br0">&#41;</span>
                <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span class="kw3">fprintf</span></a><span class="br0">&#40;</span>stderr<span class="sy0">,</span> <span class="st0">&quot;Sent %d bytes<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> socksent<span class="br0">&#41;</span><span class="sy0">;</span>
	    <span class="kw1">if</span> <span class="br0">&#40;</span>socksent <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/perror.html"><span class="kw3">perror</span></a><span class="br0">&#40;</span><span class="st0">&quot;send_get&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		close<span class="br0">&#40;</span><span class="sy0">*</span>sock<span class="br0">&#41;</span><span class="sy0">;</span>
		<a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>get<span class="br0">&#41;</span><span class="sy0">;</span>
                <span class="kw1">if</span> <span class="br0">&#40;</span>post<span class="br0">&#41;</span>
		    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>post<span class="br0">&#41;</span><span class="sy0">;</span>
		<a href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">&#40;</span><span class="nu0">7</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span>
	<span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
	    socksent <span class="sy0">=</span> send<span class="br0">&#40;</span><span class="sy0">*</span>sock<span class="sy0">,</span> get <span class="sy0">+</span> curpos<span class="sy0">,</span> getlen <span class="sy0">-</span> curpos<span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="kw1">if</span> <span class="br0">&#40;</span>debug<span class="br0">&#41;</span>
                <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span class="kw3">fprintf</span></a><span class="br0">&#40;</span>stderr<span class="sy0">,</span> <span class="st0">&quot;Sent %d bytes<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> socksent<span class="br0">&#41;</span><span class="sy0">;</span>
	    <span class="kw1">if</span> <span class="br0">&#40;</span>socksent <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/perror.html"><span class="kw3">perror</span></a><span class="br0">&#40;</span><span class="st0">&quot;send_get&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		close<span class="br0">&#40;</span><span class="sy0">*</span>sock<span class="br0">&#41;</span><span class="sy0">;</span>
		<a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>get<span class="br0">&#41;</span><span class="sy0">;</span>
                <span class="kw1">if</span> <span class="br0">&#40;</span>post<span class="br0">&#41;</span>
		    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>post<span class="br0">&#41;</span><span class="sy0">;</span>
		<a href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">&#40;</span><span class="nu0">7</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>
        curpos <span class="sy0">+=</span> socksent<span class="sy0">;</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;<span class="es1">\r</span>%d/%d Bytes written: GET %g%% complete                          &quot;</span><span class="sy0">,</span> curpos<span class="sy0">,</span> getlen<span class="sy0">,</span> <span class="br0">&#40;</span><span class="br0">&#40;</span><span class="kw4">float</span><span class="br0">&#41;</span>curpos <span class="sy0">/</span> <span class="br0">&#40;</span><span class="kw4">float</span><span class="br0">&#41;</span>getlen<span class="br0">&#41;</span> <span class="sy0">*</span> <span class="br0">&#40;</span><span class="kw4">float</span><span class="br0">&#41;</span><span class="nu0">100</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<a href="http://www.opengroup.org/onlinepubs/009695399/functions/fflush.html"><span class="kw3">fflush</span></a><span class="br0">&#40;</span>stdout<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;<span class="es1">\n</span>Finished sending GET. Waiting for response.<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">int</span> argc<span class="sy0">,</span> <span class="kw4">char</span> <span class="sy0">*</span>argv<span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw4">uint8_t</span> <span class="sy0">*</span>firmware <span class="sy0">=</span> NULL<span class="sy0">;</span>   
    <span class="kw4">uint8_t</span> <span class="sy0">*</span>post <span class="sy0">=</span> NULL<span class="sy0">;</span>
    <span class="kw4">size_t</span> postlen <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    <span class="kw4">uint8_t</span> <span class="sy0">*</span>get <span class="sy0">=</span> NULL<span class="sy0">;</span>
    <span class="kw4">size_t</span> getlen <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    <span class="kw4">uint8_t</span> <span class="sy0">*</span>content <span class="sy0">=</span> NULL<span class="sy0">;</span>
    <span class="kw4">size_t</span> contentlen <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    <span class="kw4">size_t</span> nonnllen <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    <span class="kw4">size_t</span> firmwarelen <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    <span class="kw4">char</span> contentlenstr<span class="br0">&#91;</span><span class="nu0">1024</span><span class="br0">&#93;</span><span class="sy0">;</span>
    <span class="kw4">size_t</span> curpos <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    contentlenstr<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    <span class="kw4">int</span> debug <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
&nbsp;
    <span class="kw1">if</span> <span class="br0">&#40;</span>argc <span class="sy0">&lt;</span> <span class="nu0">2</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	usage<span class="br0">&#40;</span>argv<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
   <span class="kw1">if</span> <span class="br0">&#40;</span>argc <span class="sy0">==</span> <span class="nu0">3</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span><a href="http://www.opengroup.org/onlinepubs/009695399/functions/strncmp.html"><span class="kw3">strncmp</span></a><span class="br0">&#40;</span>argv<span class="br0">&#91;</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="sy0">,</span> <span class="st0">&quot;-d&quot;</span><span class="sy0">,</span> <span class="nu0">2</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	    debug <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
        <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
	    usage<span class="br0">&#40;</span>argv<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">&#40;</span>argc <span class="sy0">&gt;</span> <span class="nu0">2</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	usage<span class="br0">&#40;</span>argv<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Load firmware file %s<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> argv<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="kw4">int</span> firmwarefd <span class="sy0">=</span> open<span class="br0">&#40;</span>argv<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>firmwarefd <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<a href="http://www.opengroup.org/onlinepubs/009695399/functions/perror.html"><span class="kw3">perror</span></a><span class="br0">&#40;</span>argv<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<a href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">&#40;</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="kw4">size_t</span> len <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    <span class="kw4">uint8_t</span> buf<span class="br0">&#91;</span><span class="nu0">1024</span><span class="br0">&#93;</span><span class="sy0">;</span>
    <span class="kw4">uint8_t</span> <span class="sy0">*</span>newfw <span class="sy0">=</span> NULL<span class="sy0">;</span>
    <span class="kw4">int</span> sock<span class="sy0">;</span>
&nbsp;
    <span class="kw1">do</span> <span class="br0">&#123;</span>
        len <span class="sy0">=</span> read<span class="br0">&#40;</span>firmwarefd<span class="sy0">,</span> <span class="sy0">&amp;</span>buf<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy0">,</span> <span class="nu0">1024</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span>len <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<a href="http://www.opengroup.org/onlinepubs/009695399/functions/perror.html"><span class="kw3">perror</span></a><span class="br0">&#40;</span>argv<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	close<span class="br0">&#40;</span>firmwarefd<span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span>firmware<span class="br0">&#41;</span>
	    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>firmware<span class="br0">&#41;</span><span class="sy0">;</span>
            <a href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">&#40;</span><span class="nu0">2</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span>len <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	    newfw <span class="sy0">=</span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/malloc.html"><span class="kw3">malloc</span></a><span class="br0">&#40;</span><span class="br0">&#40;</span>firmwarelen <span class="sy0">+</span> len<span class="br0">&#41;</span> <span class="sy0">*</span> <span class="kw4">sizeof</span><span class="br0">&#40;</span><span class="kw4">uint8_t</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	    <span class="kw1">if</span> <span class="br0">&#40;</span>firmware<span class="br0">&#41;</span>
		<a href="http://www.opengroup.org/onlinepubs/009695399/functions/memcpy.html"><span class="kw3">memcpy</span></a><span class="br0">&#40;</span>newfw<span class="sy0">,</span> firmware<span class="sy0">,</span> firmwarelen<span class="br0">&#41;</span><span class="sy0">;</span>
	    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/memcpy.html"><span class="kw3">memcpy</span></a><span class="br0">&#40;</span>newfw <span class="sy0">+</span> firmwarelen<span class="sy0">,</span> <span class="sy0">&amp;</span>buf<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy0">,</span> len<span class="br0">&#41;</span><span class="sy0">;</span>
	    firmwarelen <span class="sy0">+=</span> len<span class="sy0">;</span>
	    <span class="kw1">if</span> <span class="br0">&#40;</span>firmware<span class="br0">&#41;</span>
		<a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>firmware<span class="br0">&#41;</span><span class="sy0">;</span>
	    firmware <span class="sy0">=</span> newfw<span class="sy0">;</span>
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span> <span class="kw1">while</span> <span class="br0">&#40;</span>len <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span>
    close<span class="br0">&#40;</span>firmwarefd<span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Firmware %u bytes long<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> firmwarelen<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>content<span class="sy0">,</span> <span class="sy0">&amp;</span>contentlen<span class="sy0">,</span> <span class="st0">&quot;---------------------------7de1fe13304<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>    
    nonnllen <span class="sy0">+=</span> <span class="nu0">2</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>content<span class="sy0">,</span> <span class="sy0">&amp;</span>contentlen<span class="sy0">,</span> <span class="st0">&quot;Content-Disposition: form-data; name=<span class="es1">\&quot;</span>files<span class="es1">\&quot;</span>; filename=<span class="es1">\&quot;</span>C:<span class="es1">\\</span>My Documents<span class="es1">\\</span>firmware.bin<span class="es1">\&quot;</span><span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> <span class="sy0">&amp;</span>nonnllen<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>content<span class="sy0">,</span> <span class="sy0">&amp;</span>contentlen<span class="sy0">,</span> <span class="st0">&quot;Content-Type: application/octet-stream<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> <span class="sy0">&amp;</span>nonnllen<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>content<span class="sy0">,</span> <span class="sy0">&amp;</span>contentlen<span class="sy0">,</span> <span class="st0">&quot;<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> <span class="sy0">&amp;</span>nonnllen<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post_bin<span class="br0">&#40;</span><span class="sy0">&amp;</span>content<span class="sy0">,</span> <span class="sy0">&amp;</span>contentlen<span class="sy0">,</span> firmware<span class="sy0">,</span> firmwarelen<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>content<span class="sy0">,</span> <span class="sy0">&amp;</span>contentlen<span class="sy0">,</span> <span class="st0">&quot;<span class="es1">\r</span><span class="es1">\n</span>---------------------------7de1fe13304--<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    nonnllen <span class="sy0">+=</span> <span class="nu0">4</span><span class="sy0">;</span>
&nbsp;
    <span class="coMULTI">/* IE6 off-by-one content-length error? */</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/sprintf.html"><span class="kw3">sprintf</span></a><span class="br0">&#40;</span>contentlenstr<span class="sy0">,</span> <span class="st0">&quot;%d<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> nonnllen <span class="sy0">+</span> firmwarelen <span class="sy0">+</span> <span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>get<span class="sy0">,</span> <span class="sy0">&amp;</span>getlen<span class="sy0">,</span> <span class="st0">&quot;GET / HTTP/1.1<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>get<span class="sy0">,</span> <span class="sy0">&amp;</span>getlen<span class="sy0">,</span> <span class="st0">&quot;Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>get<span class="sy0">,</span> <span class="sy0">&amp;</span>getlen<span class="sy0">,</span> <span class="st0">&quot;Accept-Language: en-ca<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>get<span class="sy0">,</span> <span class="sy0">&amp;</span>getlen<span class="sy0">,</span> <span class="st0">&quot;Accept-Encoding: gzip, deflate<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>get<span class="sy0">,</span> <span class="sy0">&amp;</span>getlen<span class="sy0">,</span> <span class="st0">&quot;User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows 98; .NET CLR 1.1.4322)<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>get<span class="sy0">,</span> <span class="sy0">&amp;</span>getlen<span class="sy0">,</span> <span class="st0">&quot;Host: 192.168.0.1<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>get<span class="sy0">,</span> <span class="sy0">&amp;</span>getlen<span class="sy0">,</span> <span class="st0">&quot;Connection: Keep-Alive<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>get<span class="sy0">,</span> <span class="sy0">&amp;</span>getlen<span class="sy0">,</span> <span class="st0">&quot;<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>post<span class="sy0">,</span> <span class="sy0">&amp;</span>postlen<span class="sy0">,</span> <span class="st0">&quot;POST /cgi/index HTTP/1.1<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>post<span class="sy0">,</span> <span class="sy0">&amp;</span>postlen<span class="sy0">,</span> <span class="st0">&quot;Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>post<span class="sy0">,</span> <span class="sy0">&amp;</span>postlen<span class="sy0">,</span> <span class="st0">&quot;Referer: http://192.168.0.1<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>post<span class="sy0">,</span> <span class="sy0">&amp;</span>postlen<span class="sy0">,</span> <span class="st0">&quot;Accept-Language: en-ca<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>post<span class="sy0">,</span> <span class="sy0">&amp;</span>postlen<span class="sy0">,</span> <span class="st0">&quot;Content-Type: multipart/form-data; boundary=---------------------------7de1fe13304<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>post<span class="sy0">,</span> <span class="sy0">&amp;</span>postlen<span class="sy0">,</span> <span class="st0">&quot;Accept-Encoding: gzip, deflate<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>post<span class="sy0">,</span> <span class="sy0">&amp;</span>postlen<span class="sy0">,</span> <span class="st0">&quot;User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows 98; .NET CLR 1.1.4322)<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>post<span class="sy0">,</span> <span class="sy0">&amp;</span>postlen<span class="sy0">,</span> <span class="st0">&quot;Host: 192.168.0.1<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>post<span class="sy0">,</span> <span class="sy0">&amp;</span>postlen<span class="sy0">,</span> <span class="st0">&quot;Content-Length: &quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>post<span class="sy0">,</span> <span class="sy0">&amp;</span>postlen<span class="sy0">,</span> contentlenstr<span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>post<span class="sy0">,</span> <span class="sy0">&amp;</span>postlen<span class="sy0">,</span> <span class="st0">&quot;Connection: Keep-Alive<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>post<span class="sy0">,</span> <span class="sy0">&amp;</span>postlen<span class="sy0">,</span> <span class="st0">&quot;Cache-Control: no-cache<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post<span class="br0">&#40;</span><span class="sy0">&amp;</span>post<span class="sy0">,</span> <span class="sy0">&amp;</span>postlen<span class="sy0">,</span> <span class="st0">&quot;<span class="es1">\r</span><span class="es1">\n</span>&quot;</span><span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    build_post_bin<span class="br0">&#40;</span><span class="sy0">&amp;</span>post<span class="sy0">,</span> <span class="sy0">&amp;</span>postlen<span class="sy0">,</span> content<span class="sy0">,</span> contentlen<span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>content<span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>firmware<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Initiating GET so that router is in state to receive POST....&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fflush.html"><span class="kw3">fflush</span></a><span class="br0">&#40;</span>stdout<span class="br0">&#41;</span><span class="sy0">;</span>
    send_get<span class="br0">&#40;</span><span class="sy0">&amp;</span>sock<span class="sy0">,</span> get<span class="sy0">,</span> getlen<span class="sy0">,</span> post<span class="sy0">,</span> debug<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw4">int</span> gotlen <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    <span class="kw4">char</span> recvbuf<span class="br0">&#91;</span><span class="nu0">1024</span><span class="br0">&#93;</span><span class="sy0">;</span>
    <span class="kw4">int</span> recvlen <span class="sy0">=</span> recv<span class="br0">&#40;</span>sock<span class="sy0">,</span> <span class="sy0">&amp;</span>recvbuf<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy0">,</span> <span class="nu0">512</span><span class="sy0">,</span> MSG_WAITALL<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw4">int</span> newrecvlen<span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>debug<span class="br0">&#41;</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span class="kw3">fprintf</span></a><span class="br0">&#40;</span>stderr<span class="sy0">,</span> <span class="st0">&quot;Got %d bytes<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> recvlen<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>debug<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span class="kw3">fprintf</span></a><span class="br0">&#40;</span>stderr<span class="sy0">,</span> <span class="st0">&quot;%s&quot;</span><span class="sy0">,</span> <span class="sy0">&amp;</span>recvbuf<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <span class="kw1">do</span> <span class="br0">&#123;</span>
       <span class="kw1">if</span> <span class="br0">&#40;</span>recvlen <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
           <a href="http://www.opengroup.org/onlinepubs/009695399/functions/perror.html"><span class="kw3">perror</span></a><span class="br0">&#40;</span>argv<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	   close<span class="br0">&#40;</span>sock<span class="br0">&#41;</span><span class="sy0">;</span>
    	   <a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>get<span class="br0">&#41;</span><span class="sy0">;</span>
	   <a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>post<span class="br0">&#41;</span><span class="sy0">;</span>
	   <a href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">&#40;</span><span class="nu0">8</span><span class="br0">&#41;</span><span class="sy0">;</span>
       <span class="br0">&#125;</span> 
       <span class="kw1">if</span> <span class="br0">&#40;</span>recvlen <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
          recvlen <span class="sy0">=</span> recv<span class="br0">&#40;</span>sock<span class="sy0">,</span> <span class="sy0">&amp;</span>recvbuf<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy0">,</span> <span class="nu0">512</span><span class="sy0">,</span> MSG_WAITALL<span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="kw1">if</span> <span class="br0">&#40;</span>debug<span class="br0">&#41;</span> <span class="br0">&#123;</span>
 	      <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span class="kw3">fprintf</span></a><span class="br0">&#40;</span>stderr<span class="sy0">,</span> <span class="st0">&quot;Got %d bytes data<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> recvlen<span class="br0">&#41;</span><span class="sy0">;</span>
              <span class="kw1">if</span> <span class="br0">&#40;</span>recvlen <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> 
                  <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span class="kw3">fprintf</span></a><span class="br0">&#40;</span>stderr<span class="sy0">,</span> <span class="st0">&quot;%s&quot;</span><span class="sy0">,</span> <span class="sy0">&amp;</span>recvbuf<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="br0">&#125;</span>
       <span class="br0">&#125;</span>
    <span class="br0">&#125;</span> <span class="kw1">while</span> <span class="br0">&#40;</span>recvlen <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Got page from which upload is done.<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    shutdown<span class="br0">&#40;</span>sock<span class="sy0">,</span> SHUT_RDWR<span class="br0">&#41;</span><span class="sy0">;</span>
    close<span class="br0">&#40;</span>sock<span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Initiating transfer....&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fflush.html"><span class="kw3">fflush</span></a><span class="br0">&#40;</span>stdout<span class="br0">&#41;</span><span class="sy0">;</span>
    sock <span class="sy0">=</span> open_socket<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>sock <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/perror.html"><span class="kw3">perror</span></a><span class="br0">&#40;</span>argv<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>get<span class="br0">&#41;</span><span class="sy0">;</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>post<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <span class="kw4">size_t</span> socksent <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    curpos <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    <span class="kw1">while</span> <span class="br0">&#40;</span>curpos <span class="sy0">&lt;</span> postlen<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span><span class="br0">&#40;</span>postlen <span class="sy0">-</span> curpos<span class="br0">&#41;</span> <span class="sy0">&gt;=</span> <span class="nu0">512</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	    socksent <span class="sy0">=</span> send<span class="br0">&#40;</span>sock<span class="sy0">,</span> post <span class="sy0">+</span> curpos<span class="sy0">,</span> <span class="nu0">512</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="kw1">if</span> <span class="br0">&#40;</span>debug<span class="br0">&#41;</span>
                <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span class="kw3">fprintf</span></a><span class="br0">&#40;</span>stderr<span class="sy0">,</span> <span class="st0">&quot;Sent %d bytes<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> socksent<span class="br0">&#41;</span><span class="sy0">;</span>
	    <span class="kw1">if</span> <span class="br0">&#40;</span>socksent <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/perror.html"><span class="kw3">perror</span></a><span class="br0">&#40;</span>argv<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		close<span class="br0">&#40;</span>sock<span class="br0">&#41;</span><span class="sy0">;</span>
		<a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>post<span class="br0">&#41;</span><span class="sy0">;</span>
		<a href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">&#40;</span><span class="nu0">5</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span>
	<span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
	    socksent <span class="sy0">=</span> send<span class="br0">&#40;</span>sock<span class="sy0">,</span> post <span class="sy0">+</span> curpos<span class="sy0">,</span> postlen <span class="sy0">-</span> curpos<span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="kw1">if</span> <span class="br0">&#40;</span>debug<span class="br0">&#41;</span>
                <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span class="kw3">fprintf</span></a><span class="br0">&#40;</span>stderr<span class="sy0">,</span> <span class="st0">&quot;Sent %d bytes<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> socksent<span class="br0">&#41;</span><span class="sy0">;</span>
	    <span class="kw1">if</span> <span class="br0">&#40;</span>socksent <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/perror.html"><span class="kw3">perror</span></a><span class="br0">&#40;</span>argv<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    		<a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>get<span class="br0">&#41;</span><span class="sy0">;</span>
		close<span class="br0">&#40;</span>sock<span class="br0">&#41;</span><span class="sy0">;</span>
		<a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>post<span class="br0">&#41;</span><span class="sy0">;</span>
		<a href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">&#40;</span><span class="nu0">5</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>
        curpos <span class="sy0">+=</span> socksent<span class="sy0">;</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;<span class="es1">\r</span>%d/%d Bytes written: Upload %g%% complete        &quot;</span><span class="sy0">,</span> curpos<span class="sy0">,</span> postlen<span class="sy0">,</span> <span class="br0">&#40;</span><span class="br0">&#40;</span><span class="kw4">float</span><span class="br0">&#41;</span>curpos <span class="sy0">/</span> <span class="br0">&#40;</span><span class="kw4">float</span><span class="br0">&#41;</span>postlen<span class="br0">&#41;</span> <span class="sy0">*</span> <span class="br0">&#40;</span><span class="kw4">float</span><span class="br0">&#41;</span><span class="nu0">100</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<a href="http://www.opengroup.org/onlinepubs/009695399/functions/fflush.html"><span class="kw3">fflush</span></a><span class="br0">&#40;</span>stdout<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;<span class="es1">\n</span>Finished sending post. Waiting for response.<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>post<span class="br0">&#41;</span><span class="sy0">;</span>
    regex_t pattern<span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>regcomp<span class="br0">&#40;</span><span class="sy0">&amp;</span>pattern<span class="sy0">,</span> <span class="st0">&quot;count_down&quot;</span><span class="sy0">,</span> REG_NOSUB<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Error compiling expression to detect success or failure<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>get<span class="br0">&#41;</span><span class="sy0">;</span>
	close<span class="br0">&#40;</span>sock<span class="br0">&#41;</span><span class="sy0">;</span>
	<a href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">&#40;</span><span class="nu0">7</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    recvbuf<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    recvlen <span class="sy0">=</span> recv<span class="br0">&#40;</span>sock<span class="sy0">,</span> <span class="sy0">&amp;</span>recvbuf<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy0">,</span> <span class="nu0">512</span><span class="sy0">,</span> MSG_WAITALL<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>debug<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span class="kw3">fprintf</span></a><span class="br0">&#40;</span>stderr<span class="sy0">,</span> <span class="st0">&quot;Got %d bytes<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> recvlen<span class="br0">&#41;</span><span class="sy0">;</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span class="kw3">fprintf</span></a><span class="br0">&#40;</span>stderr<span class="sy0">,</span> <span class="st0">&quot;%s&quot;</span><span class="sy0">,</span> <span class="sy0">&amp;</span>recvbuf<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <span class="kw4">int</span> firstpacket <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
    <span class="kw1">do</span> <span class="br0">&#123;</span>
       <span class="kw1">if</span> <span class="br0">&#40;</span>recvlen <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
           <a href="http://www.opengroup.org/onlinepubs/009695399/functions/perror.html"><span class="kw3">perror</span></a><span class="br0">&#40;</span>argv<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    	   <a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>get<span class="br0">&#41;</span><span class="sy0">;</span>
	   close<span class="br0">&#40;</span>sock<span class="br0">&#41;</span><span class="sy0">;</span>
	   <a href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span class="kw3">exit</span></a><span class="br0">&#40;</span><span class="nu0">6</span><span class="br0">&#41;</span><span class="sy0">;</span>
       <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">&#40;</span>recvlen <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
           <span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span>regexec<span class="br0">&#40;</span><span class="sy0">&amp;</span>pattern<span class="sy0">,</span> <span class="sy0">&amp;</span>recvbuf<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> NULL<span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
              <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Firmware successfully sent.  Please wait for device to reboot.<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
              <span class="kw2">break</span><span class="sy0">;</span>
              <span class="kw1">if</span> <span class="br0">&#40;</span>firstpacket<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	          <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Error sending firmware to device.  Response is:<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
              <span class="br0">&#125;</span>
	      <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;%s&quot;</span><span class="sy0">,</span> <span class="sy0">&amp;</span>recvbuf<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="br0">&#125;</span>
          recvlen <span class="sy0">=</span> recv<span class="br0">&#40;</span>sock<span class="sy0">,</span> <span class="sy0">&amp;</span>recvbuf<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy0">,</span> <span class="nu0">512</span><span class="sy0">,</span> MSG_WAITALL<span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="kw1">if</span> <span class="br0">&#40;</span>debug<span class="br0">&#41;</span> <span class="br0">&#123;</span>
 	      <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span class="kw3">fprintf</span></a><span class="br0">&#40;</span>stderr<span class="sy0">,</span> <span class="st0">&quot;Got %d data<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> newrecvlen<span class="br0">&#41;</span><span class="sy0">;</span>
              <span class="kw1">if</span> <span class="br0">&#40;</span>recvlen <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span>
                 <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span class="kw3">fprintf</span></a><span class="br0">&#40;</span>stderr<span class="sy0">,</span> <span class="st0">&quot;%s&quot;</span><span class="sy0">,</span> <span class="sy0">&amp;</span>recvbuf<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="br0">&#125;</span>
       <span class="br0">&#125;</span>
       firstpacket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
    <span class="br0">&#125;</span> <span class="kw1">while</span> <span class="br0">&#40;</span>recvlen <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span>
    regfree<span class="br0">&#40;</span><span class="sy0">&amp;</span>pattern<span class="br0">&#41;</span><span class="sy0">;</span>
    shutdown<span class="br0">&#40;</span>sock<span class="sy0">,</span> SHUT_RDWR<span class="br0">&#41;</span><span class="sy0">;</span>
    close<span class="br0">&#40;</span>sock<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>    
<span class="br0">&#125;</span></pre>

</p>

</div>

<h2 class="sectionedit40" id="a_simple_script_to_flash_dir-825">A simple script to flash DIR-825</h2>
<div class="level2">

<p>
*NB*: The ruby script on the next section does *NOT* always work for the reasons mentioned above (perhaps due to different versions of ruby or underlying <abbr title="Operating System">OS</abbr> having different defaults).
</p>

<p>
We have recently developed a script and performed some correction based on your work you can find it here
</p>

<p>
You need to have ruby installed.
</p>

<p>
Script recovered from the WayBackMachine: <a href="https://web.archive.org/web/20120418003158/http://openwisp.caspur.it/wiki/owf/FlashingDlinkDIR825#notextile-Automatic-flashing-script-notextile" class="urlextern" title="https://web.archive.org/web/20120418003158/http://openwisp.caspur.it/wiki/owf/FlashingDlinkDIR825#notextile-Automatic-flashing-script-notextile"  rel="nofollow">https://web.archive.org/web/20120418003158/http://openwisp.caspur.it/wiki/owf/FlashingDlinkDIR825#notextile-Automatic-flashing-script-notextile</a>
</p>

<p>
<strong>With this script it&#039;s not necessary to force your NIC to work @ 10/100 Mb/s and it&#039;s not necessary using IE7</strong>
</p>

<p>
<pre class="code ruby"><span class="co1">#!/usr/bin/ruby</span>
<span class="co1"># Copyright (C) 2011 CASPUR (wifi@caspur.it)</span>
<span class="co1">#</span>
<span class="co1"># This program is free software: you can redistribute it and/or modify</span>
<span class="co1"># it under the terms of the GNU General Public License as published by</span>
<span class="co1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="co1"># (at your option) any later version.</span>
<span class="co1">#</span>
<span class="co1"># This program is distributed in the hope that it will be useful,</span>
<span class="co1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="co1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="co1"># GNU General Public License for more details.</span>
<span class="co1">#</span>
<span class="co1"># You should have received a copy of the GNU General Public License</span>
<span class="co1"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
&nbsp;
<span class="co1"># This script will help you flashing D-LINK DIR-825 devices 'cause  they can be flashed only with IE7</span>
<span class="co1"># Your ETH Address must be 192.168.0.100/24</span>
&nbsp;
<span class="kw3">require</span> <span class="st0">'socket'</span>
&nbsp;
HOST = <span class="st0">&quot;192.168.0.1&quot;</span> 
PATH = <span class="st0">&quot;/cgi/index&quot;</span> 
&nbsp;
<span class="kw1">if</span> ARGV.<span class="me1">count</span> == <span class="nu0">0</span>
  <span class="kw3">puts</span> <span class="st0">&quot;Usage #{$0} &lt;filename&gt;&quot;</span> 
  <span class="kw3">exit</span> <span class="nu0">1</span>
<span class="kw1">else</span>
  filename = ARGV<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span>
  <span class="kw3">puts</span> <span class="st0">&quot;[#{Time.now}] Using firmware file '#{filename}'&quot;</span> 
<span class="kw1">end</span>
&nbsp;
predata = <span class="sy0">&lt;&lt;-</span>eopd
<span class="sy0">-----------------------------</span>7db12928202b8
Content<span class="sy0">-</span>Disposition: form<span class="sy0">-</span>data; name=<span class="st0">&quot;files&quot;</span>; filename=<span class="st0">&quot;#{filename}&quot;</span> 
Content<span class="sy0">-</span>Type: application<span class="sy0">/</span>octet<span class="sy0">-</span>stream
&nbsp;
eopd
&nbsp;
firmware = <span class="kw4">File</span>.<span class="kw3">open</span><span class="br0">&#40;</span>filename, <span class="st0">&quot;rb&quot;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="sy0">|</span>io<span class="sy0">|</span> io.<span class="me1">read</span> <span class="br0">&#125;</span>
&nbsp;
postdata=<span class="st0">&quot;<span class="es0">\x</span>0d<span class="es0">\x</span>0a-----------------------------7db12928202b8--<span class="es0">\x</span>0d<span class="es0">\x</span>0a&quot;</span> 
&nbsp;
<span class="co1"># Each line must end with cr/lf characters, and we have to know how many </span>
<span class="co1"># data the script will send to the dir-825 this is why we concatenate it before</span>
<span class="co1"># creating the header</span>
&nbsp;
buffer = predata.<span class="kw3">gsub</span><span class="br0">&#40;</span><span class="sy0">/</span>\n<span class="sy0">/</span>,<span class="st0">&quot;<span class="es0">\x</span>0d<span class="es0">\x</span>0a&quot;</span><span class="br0">&#41;</span> <span class="sy0">+</span> firmware <span class="sy0">+</span> postdata
&nbsp;
header = <span class="sy0">&lt;&lt;-</span>eoh
POST <span class="co1">#{PATH} HTTP/1.1</span>
Accept: image<span class="sy0">/</span>jpeg, application<span class="sy0">/</span>x<span class="sy0">-</span>ms<span class="sy0">-</span>application, image<span class="sy0">/</span>gif, application<span class="sy0">/</span>xaml<span class="sy0">+</span>xml, image<span class="sy0">/</span>pjpeg, application<span class="sy0">/</span>x<span class="sy0">-</span>ms<span class="sy0">-</span>xbap, <span class="sy0">*/*</span>
Referer: http:<span class="sy0">//</span><span class="co1">#{HOST}/</span>
Accept<span class="sy0">-</span>Language: it<span class="sy0">-</span>IT
User<span class="sy0">-</span>Agent: Mozilla<span class="sy0">/</span><span class="nu0">4.0</span> <span class="br0">&#40;</span>compatible; MSIE <span class="nu0">7.0</span>; Windows NT <span class="nu0">6.1</span>; SLCC2; .<span class="me1">NET</span> CLR 2.0.50727; .<span class="me1">NET</span> CLR 3.5.30729; .<span class="me1">NET</span> CLR 3.0.30729; Media Center PC <span class="nu0">6.0</span><span class="br0">&#41;</span>
Content<span class="sy0">-</span>Type: multipart<span class="sy0">/</span>form<span class="sy0">-</span>data; boundary=<span class="sy0">---------------------------</span>7db12928202b8
Accept<span class="sy0">-</span>Encoding: gzip, deflate
Host: <span class="co1">#{HOST}</span>
Content<span class="sy0">-</span>Length: <span class="co1">#{buffer.length}</span>
Connection: Keep<span class="sy0">-</span>Alive
Cache<span class="sy0">-</span>Control: no<span class="sy0">-</span>cache
&nbsp;
eoh
&nbsp;
<span class="kw1">begin</span>
  <span class="kw3">puts</span> <span class="st0">&quot;[#{Time.now}] Firmware file laded (#{firmware.length} bytes)&quot;</span> 
  http = TCPSocket.<span class="me1">new</span><span class="br0">&#40;</span>HOST, <span class="st0">'www'</span><span class="br0">&#41;</span>
&nbsp;
  <span class="kw3">puts</span> <span class="st0">&quot;[#{Time.now}] Sending firmware to the device...  &quot;</span> 
&nbsp;
  http.<span class="kw3">print</span> header.<span class="kw3">gsub</span><span class="br0">&#40;</span><span class="sy0">/</span>\n<span class="sy0">/</span>,<span class="st0">&quot;<span class="es0">\x</span>0d<span class="es0">\x</span>0a&quot;</span><span class="br0">&#41;</span> <span class="sy0">+</span> buffer
  resp = http.<span class="me1">recv</span><span class="br0">&#40;</span><span class="nu0">1012</span><span class="br0">&#41;</span>
&nbsp;
  <span class="co1"># Let's check if it's all ok</span>
  <span class="kw1">if</span> resp.<span class="me1">match</span> <span class="sy0">/</span>Don<span class="st0">'t turn the device off before the Upgrade jobs done/
     puts &quot;<span class="es0">\n</span>[#{Time.now}] Finished. Please wait for the device to reboot.&quot; 
  else
     puts &quot;<span class="es0">\n</span>[#{Time.now}] Problem sending firmware to the device. Response from device follows.&quot; 
     puts resp
   end
&nbsp;
  http.close
  rescue Exception =&gt; e
  puts &quot;[#{Time.now}] Problem flashing device. Error: '</span><span class="co1">#{e}'&quot; </span>
<span class="kw1">end</span>
&nbsp;
<span class="kw3">exit</span> <span class="nu0">0</span></pre>

</p>

</div>

<h2 class="sectionedit41" id="custom_openwrt_image_with_luci_integrated">Custom OpenWrt image with LuCi integrated</h2>
<div class="level2">

<p>
<a href="http://www.superwrt.eu/en/firmware/d-link-dir-825/" class="urlextern" title="http://www.superwrt.eu/en/firmware/d-link-dir-825/"  rel="nofollow">http://www.superwrt.eu/en/firmware/d-link-dir-825/</a>
</p>

</div>

<h2 class="sectionedit42" id="fat_images">Fat images</h2>
<div class="level2">

<p>
Since Attitude Adjustment beta 2, some images are suffixed with &quot;-fat&quot; to indicate they will be able to use more flash that the factory firmware uses by default. It does this by moving the wireless interface calibration data at the end of the flash. This is a dangerous operation and should only be performed if you know how to back this flash partition (/dev/mtd5).
To upgrade, you&#039;ll need to copy the whole image in /tmp and use sysupgrade -i the caldata question. Downgrading to a non-fat image will get the caldata back in place so it can be used by the factory firmware, after upgrading to a fat image, you must downgrade before getting back to a factory image.
</p>

<p>
<code>Before:
/dev/mtdblock4          576.0K    308.0K    268.0K  53% /overlay
After:
/dev/mtdblock4            2.1M    328.0K      1.8M  15% /overlay
</code>
</p>

</div>

<h2 class="sectionedit43" id="tags">Tags</h2>
<div class="level2">
<hr />
<div class="tags"><span>
	<a href="../../tag/gigabitethernet?do=showtag&amp;tag=GigabitEthernet" class="wikilink1" title="tag:gigabitethernet" rel="tag">GigabitEthernet</a>,
	<a href="../../tag/5port?do=showtag&amp;tag=5Port" class="wikilink1" title="tag:5port" rel="tag">5Port</a>,
	<a href="../../tag/2nic?do=showtag&amp;tag=2NIC" class="wikilink1" title="tag:2nic" rel="tag">2NIC</a>,
	<a href="../../tag/usb?do=showtag&amp;tag=USB" class="wikilink1" title="tag:usb" rel="tag">USB</a>,
	<a href="../../tag/1usb?do=showtag&amp;tag=1USB" class="wikilink1" title="tag:1usb" rel="tag">1USB</a>,
	<a href="../../tag/jtag?do=showtag&amp;tag=JTAG" class="wikilink1" title="tag:jtag" rel="tag">JTAG</a>,
	<a href="../../tag/802.11abgn_simultan?do=showtag&amp;tag=802.11abgn_simultan" class="wikilink1" title="tag:802.11abgn_simultan" rel="tag">802.11abgn simultan</a>,
	<a href="../../tag/detachableantenna" class="wikilink1" title="tag:detachableantenna" rel="tag">DetachableAntenna</a>,
	<a href="../../tag/2ant?do=showtag&amp;tag=2Ant" class="wikilink1" title="tag:2ant" rel="tag">2Ant</a>,
	<a href="../../tag/2wnic?do=showtag&amp;tag=2WNIC" class="wikilink1" title="tag:2wnic" rel="tag">2WNIC</a>,
	<a href="../../tag/ath9k?do=showtag&amp;tag=ath9k" class="wikilink1" title="tag:ath9k" rel="tag">ath9k</a>,
	<a href="../../tag/64ram?do=showtag&amp;tag=64RAM" class="wikilink1" title="tag:64ram" rel="tag">64RAM</a>,
	<a href="../../tag/8flash?do=showtag&amp;tag=8Flash" class="wikilink1" title="tag:8flash" rel="tag">8Flash</a>,
	<a href="../../tag/mips?do=showtag&amp;tag=MIPS" class="wikilink1" title="tag:mips" rel="tag">MIPS</a>,
	<a href="../../tag/mips32?do=showtag&amp;tag=MIPS32" class="wikilink1" title="tag:mips32" rel="tag">MIPS32</a>,
	<a href="../../tag/24kc?do=showtag&amp;tag=24Kc" class="wikilink1" title="tag:24kc" rel="tag">24Kc</a>
</span></div>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>toh/d-link/dir-825.txt</bdi> · Last modified: 2015/05/06 12:21 by <bdi>theoradicus</bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="dir-825?do=edit"  class="action source" accesskey="v" rel="nofollow" title="Show pagesource [V]"><span>Show pagesource</span></a></li><li><a href="dir-825?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="dir-825?do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="dir-825#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license" class="urlextern">CC Attribution-Noncommercial-Share Alike 3.0 Unported</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license"><img src="../../lib/images/license/button/cc-by-nc-sa.png" alt="CC Attribution-Noncommercial-Share Alike 3.0 Unported" /></a>        <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/openwrt/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://www.php.net" title="Powered by PHP" ><img
            src="../../lib/tpl/openwrt/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/openwrt/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../../lib/tpl/openwrt/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/openwrt/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="../../lib/exe/indexer.php?id=toh%253Ad-link%253Adir-825&amp;1432266221" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</body>
</html>
