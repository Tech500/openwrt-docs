<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>Common Procedures for Mikrotek RouterBoard Products [OpenWrt Wiki]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="toh,mikrotik,common"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="OpenWrt Wiki"/>
<link rel="start" href="../../index.html"/>
<link rel="contents" href="http://wiki.openwrt.org/toh/mikrotik/common?do=index" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Recent changes" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="../../feed.php?mode=list&amp;ns=toh:mikrotik"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="http://wiki.openwrt.org/_export/xhtml/toh/mikrotik/common"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="http://wiki.openwrt.org/_export/raw/toh/mikrotik/common"/>
<link rel="canonical" href="common"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php?t=openwrt&amp;tseed=6f44f363dc87908d905dc56ff3acbfc4"/>
<script type="text/javascript">/*<![CDATA[*/var NS='toh:mikrotik';var JSINFO = {"id":"toh:mikrotik:common","namespace":"toh:mikrotik"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php?tseed=6f44f363dc87908d905dc56ff3acbfc4"></script>
<script type="text/javascript" charset="utf-8">/*<![CDATA[*/jQuery(function(){
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1432284038 166.182.3.100';
			document.forms[i].appendChild(myElement);
		}
	}
});
/*!]]>*/</script>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../../lib/tpl/openwrt/images/favicon.ico" />
<link rel="apple-touch-icon" href="../../lib/tpl/openwrt/images/apple-touch-icon.png" />
    </head>

<body>
    <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_openwrt     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="common#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="../../start"  accesskey="h" title="[H]"><img src="../../lib/tpl/openwrt/images/logo.png" width="386" height="98" alt="" /> <span>OpenWrt Wiki</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="http://wiki.openwrt.org/toh/mikrotik/common?do=register"  class="action register" rel="nofollow" title="Register">Register</a></li><li><a href="http://wiki.openwrt.org/toh/mikrotik/common?do=login&amp;sectok=382740b13d95f946eed36caa57076b4a"  class="action login" rel="nofollow" title="Login">Login</a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="../../start" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="../../doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="toh:mikrotik:common" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Show pagesource</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Login</option><option value="register">Register</option></optgroup></select><input type="submit" value="&gt;" /></div></form>            </div>
            <ul>
                <li><a href="http://wiki.openwrt.org/toh/mikrotik/common?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a></li><li><a href="http://wiki.openwrt.org/toh/mikrotik/common?do=media&amp;ns=toh%3Amikrotik"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a></li><li><a href="http://wiki.openwrt.org/toh/mikrotik/common?do=index"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                            <div class="youarehere"><span class="bchead">You are here: </span><span class="home"><bdi><a href="../../start" class="wikilink1" title="start">OpenWrt Wiki</a></bdi></span> » <bdi><a href="../start" class="wikilink1" title="toh:start">Table of Hardware</a></bdi> » <bdi><a href="start" class="wikilink1" title="toh:mikrotik:start">Mikrotik</a></bdi> » <bdi><span class="curid"><a href="common" class="wikilink1" title="toh:mikrotik:common">Common Procedures for Mikrotek RouterBoard Products</a></span></bdi></div>
                                    <div class="plugin_multilingual">
        <ul>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/cz/toh/mikrotik/common" class="media" title="cz:toh:mikrotik:common"><img src="../../lib/exe/fetch.php?cache=&amp;tok=aff589&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fcz.gif" class="media" title="Čeština (Czech)" alt="Čeština (Czech)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/de/toh/mikrotik/common" class="media" title="de:toh:mikrotik:common"><img src="../../lib/exe/fetch.php?cache=&amp;tok=e24010&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fde.gif" class="media" title="Deutsch (German)" alt="Deutsch (German)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <span class="curid"><a href="common" class="media" title="toh:mikrotik:common"><img src="../../lib/exe/fetch.php?cache=&amp;tok=2a37ae&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fgb.gif" class="media" title="English" alt="English" /></a></span>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/es/toh/mikrotik/common" class="media" title="es:toh:mikrotik:common"><img src="../../lib/exe/fetch.php?cache=&amp;tok=46c004&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fmx.gif" class="media" title="Español (Spanish, Mexico)" alt="Español (Spanish, Mexico)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/fr/toh/mikrotik/common" class="media" title="fr:toh:mikrotik:common"><img src="../../lib/exe/fetch.php?cache=&amp;tok=a5beba&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ffr.gif" class="media" title="Français (French)" alt="Français (French)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/hu/toh/mikrotik/common" class="media" title="hu:toh:mikrotik:common"><img src="../../lib/exe/fetch.php?cache=&amp;tok=6b5470&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fhu.gif" class="media" title="Magyar (Hungarian)" alt="Magyar (Hungarian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/jp/toh/mikrotik/common" class="media" title="jp:toh:mikrotik:common"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f999fc&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fjp.gif" class="media" title="日本語 (Japanese)" alt="日本語 (Japanese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pl/toh/mikrotik/common" class="media" title="pl:toh:mikrotik:common"><img src="../../lib/exe/fetch.php?cache=&amp;tok=c805c0&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fpl.gif" class="media" title="Poliski (Polish)" alt="Poliski (Polish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pt-br/toh/mikrotik/common" class="media" title="pt-br:toh:mikrotik:common"><img src="../../lib/exe/fetch.php?cache=&amp;tok=13127d&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fbr.gif" class="media" title="Português brasileiro (Portuguese, Brasil)" alt="Português brasileiro (Portuguese, Brasil)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/ru/toh/mikrotik/common" class="media" title="ru:toh:mikrotik:common"><img src="../../lib/exe/fetch.php?cache=&amp;tok=66ab5e&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fru.gif" class="media" title="Русский (Russsian)" alt="Русский (Russsian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/tr/toh/mikrotik/common" class="media" title="tr:toh:mikrotik:common"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f4beed&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ftr.gif" class="media" title="Tϋrkçe (Turkish)" alt="Tϋrkçe (Turkish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-cn/toh/mikrotik/common" class="media" title="zh-cn:toh:mikrotik:common"><img src="../../lib/exe/fetch.php?cache=&amp;tok=93625a&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-cn.gif" class="media" title="官話/官话 (Chinese)" alt="官話/官话 (Chinese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-tw/toh/mikrotik/common" class="media" title="zh-tw:toh:mikrotik:common"><img src="../../lib/exe/fetch.php?cache=&amp;tok=b56198&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-tw.gif" class="media" title="臺灣華語 (Taiwanese)" alt="臺灣華語 (Taiwanese)" /></a>
              </div>
            </div>
          </li>
        </ul>
      </div>
        </div>
    
    
    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">

                <div class="pageId"><span>toh:mikrotik:common</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="common#common_procedures_for_mikrotek_routerboard_products">Common Procedures for Mikrotek RouterBoard Products</a></div></li>
<li class="level1"><div class="li"><a href="common#overview_of_openwrt_installation">Overview of OpenWrt installation</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="common#selecting_an_openwrt_version">Selecting an OpenWrt version</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="common#downloading_openwrt_image">Downloading OpenWRT image</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="common#boot_openwrt_via_dhcptftp">Boot OpenWrt via DHCP/TFTP</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="common#generic_dhcptftp_server_setup">Generic DHCP/TFTP server setup</a></div></li>
<li class="level2"><div class="li"><a href="common#setup_dnsmasq_dhcptftp_server">Setup dnsmasq DHCP/TFTP server</a></div></li>
<li class="level2"><div class="li"><a href="common#tftp_boot_routerboard">TFTP boot routerboard</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="common#from_routeros">From RouterOS</a></div></li>
<li class="level3"><div class="li"><a href="common#from_com_port">From COM port</a></div></li>
<li class="level3"><div class="li"><a href="common#from_openwrt">From OpenWrt</a></div></li>
<li class="level3"><div class="li"><a href="common#via_reset_button">Via Reset button</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="common#flash_openwrt">Flash OpenWRT</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="common#automated_via_wget2nand">Automated via wget2nand</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="common#directly_from_openwrtorg">Directly from openwrt.org</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="common#manually">Manually</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="common#initial_setup">Initial setup</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="common#leds">Leds</a></div></li>
<li class="level2"><div class="li"><a href="common#understandingconfiguring_ports">Understanding/configuring ports</a></div></li>
<li class="level2"><div class="li"><a href="common#serial_console">Serial console</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="common#additional_procedures">Additional procedures</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="common#compiling_openwrt">Compiling OpenWRT</a></div></li>
<li class="level2"><div class="li"><a href="common#saving_mikrotik_routerboard_software_key">Saving MikroTik RouterBoard software key</a></div></li>
<li class="level2"><div class="li"><a href="common#saving_mikrotik_routeros">Saving MikroTik RouterOS</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="common#notes">Notes</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="common#patchworks">Patchworks</a></div></li>
<li class="level2"><div class="li"><a href="common#rumors">Rumors</a></div></li>
<li class="level2"><div class="li"><a href="common#links">Links</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h2 class="sectionedit1" id="common_procedures_for_mikrotek_routerboard_products">Common Procedures for Mikrotek RouterBoard Products</h2>
<div class="level2">

<p>
This page describes common procedures across MikroTik RouterBoard routers. If you edit / add information about a specific model, please consider linking to this page to avoid repeating common instructions.
</p>

</div>

<h2 class="sectionedit2" id="overview_of_openwrt_installation">Overview of OpenWrt installation</h2>
<div class="level2">

<p>
RouterBoards can boot OpenWrt .elf images with initramfs via TFTP. This is first used to validate that the desired version of OpenWrt works and then to install OpenWrt onto NAND Flash from the shell of the running initramfs OpenWrt.
After OpenWrt is installed to Flash, depending on model, some platform configuration may be needed. This is explained in the model specific wiki pages.
</p>

<p>
To upgrade OpenWrt, it is currently necessary to boot into OpenWrt initramfs again because it is not yet possible to overwrite the running Linux Kernel on NAND Flash of the Routerboards (04/2015).
</p>

</div>

<h3 class="sectionedit3" id="selecting_an_openwrt_version">Selecting an OpenWrt version</h3>
<div class="level3">

<p>
The first supported version of OpenWrt for a particular model should be listed on the OpenWrt table of hardware: <a href="../start" class="urlextern" title="http://wiki.openwrt.org/toh/start"  rel="nofollow">http://wiki.openwrt.org/toh/start</a>
</p>

<p>
If the OpenWrt table of hardware says &#039;trunk&#039;, the model specific page should explain if &#039;trunk&#039; already contains the necessary patches for your model or if you need to compile and patch OpenWrt yourself. compilation / patching is explained further down in this document. 
</p>

<p>
First test booting OpenWrt from TFTP with the latest version you see documented as working on the wiki. If that works, try again with the latest release you are comfortable with: Latest release or trunk. 
</p>

</div>

<h4 id="downloading_openwrt_image">Downloading OpenWRT image</h4>
<div class="level4">

<p>
Images for the latest OpenWrt image can be downloaded from <a href="https://downloads.openwrt.org/" class="urlextern" title="https://downloads.openwrt.org/"  rel="nofollow">https://downloads.openwrt.org/</a>. As of 05/2015, Barrier Breaker is the latest release:
</p>
<pre class="code">wget -c https://downloads.openwrt.org/latest/ar71xx/mikrotik/openwrt-ar71xx-mikrotik-vmlinux-initramfs.elf
wget -c https://downloads.openwrt.org/latest/ar71xx/mikrotik/openwrt-ar71xx-mikrotik-vmlinux-lzma.elf
wget -c https://downloads.openwrt.org/latest/ar71xx/mikrotik/openwrt-ar71xx-mikrotik-DefaultNoWifi-rootfs.tar.gz
ln -s openwrt-ar71xx-mikrotik-DefaultNoWifi-rootfs.tar.gz openwrt-ar71xx-mikrotik-rootfs.tar.gz</pre>

<p>
To download nightly build trunk:
</p>
<pre class="code">wget -c https://downloads.openwrt.org/snapshots/trunk/ar71xx/mikrotik/openwrt-ar71xx-mikrotik-vmlinux-initramfs.elf
wget -c https://downloads.openwrt.org/snapshots/trunk/ar71xx/mikrotik/openwrt-ar71xx-mikrotik-vmlinux-lzma.elf
wget -c https://downloads.openwrt.org/snapshots/trunk/ar71xx/mikrotik/openwrt-ar71xx-mikrotik-DefaultNoWifi-rootfs.tar.gz
ln -s openwrt-ar71xx-mikrotik-DefaultNoWifi-rootfs.tar.gz openwrt-ar71xx-mikrotik-rootfs.tar.gz</pre>

</div>

<h2 class="sectionedit4" id="boot_openwrt_via_dhcptftp">Boot OpenWrt via DHCP/TFTP</h2>
<div class="level2">

<p>
Routerboards have a bootloader that can boot and run a .elf file of OpenWrt with initramfs, aka: a single file with the whole OpenWrt package: kernel plus filesystem. A routerboard has at least three flash partitions: booloader, kernel and root, so this bootloader is preserved even after OpenWrt is installed onto NAND flash later and OpenWrt on flash is booted from the in-flash routerboard booloader.
</p>

</div>

<h3 class="sectionedit5" id="generic_dhcptftp_server_setup">Generic DHCP/TFTP server setup</h3>
<div class="level3">

<p>
Copy openwrt-ar71xx-mikrotik-vmlinux-initramfs.elf to your TFTP server location. Set up your DHCP server to point to your TFTP server as the next-server and to that file as the bootfile.
</p>

</div>

<h3 class="sectionedit6" id="setup_dnsmasq_dhcptftp_server">Setup dnsmasq DHCP/TFTP server</h3>
<div class="level3">

<p>
Copy openwrt-ar71xx-mikrotik-vmlinux-initramfs.elf to /tftp/
Create script: nano /tftp/loader.sh
</p>
<pre class="code">#/bin/bash
ifconfig eth0 192.168.1.10 up
dnsmasq -i eth0 --dhcp-range=192.168.1.100,192.168.1.200 \
--dhcp-boot=openwrt-ar71xx-mikrotik-vmlinux-initramfs.elf \
--enable-tftp --tftp-root=/home/user/mikrotik/trunk/bin/ar71xx/ -d -u test -p0 -K --log-dhcp --bootp-dynamic</pre>

<p>
Run script loader.sh
</p>

</div>

<h3 class="sectionedit7" id="tftp_boot_routerboard">TFTP boot routerboard</h3>
<div class="level3">

<p>
Connect the WAN port of your routerboard (usually ETH1) to a network set up to reach the  DHCP/TFTP server that you have set up in before.
</p>

</div>

<h4 id="from_routeros">From RouterOS</h4>
<div class="level4">

<p>
If you have not yet installed OpenWrt onto Flash, you can reboot the routerboard via TFTP from the RouterOS web configuration interface.
</p>

<p>
Connect a PC to a <abbr title="Local Area Network">LAN</abbr> port (port 2…) or WAN. Log into the web interface of RouterOS and set router to boot from ethernet once with DHCP:
</p>
<ol>
<li class="level1"><div class="li"> System → Routerboard → Settings → Boot device: Try ethernet once then NAND</div>
</li>
<li class="level1"><div class="li"> System → Routerboard → Settings → Boot protocol: DHCP</div>
</li>
</ol>

<p>
Reboot routerboard. This will boot OpenWrt from TFTP.
</p>

</div>

<h4 id="from_com_port">From COM port</h4>
<div class="level4">

<p>
If your model has a serial console (COM port), it can be used to boot the routerboard via TFTP. Note: Some routerboards may not have the cabling for the COM port, but the COM port may exist on the motherboard and just needs to be soldered to a cable, but on those models the bootloader may not have the menu option to change the boot device.
</p>

<p>
Connect COM port to a system (terminal server, PC). Set speed to 115200 there. If RouterOS or OpenWrt are running you should have an interactive shell. Reboot the routerboard. Observe “Press any key within 2 seconds to enter setup”. Press a key. Then use the menu to make the routerboard boot from TFTP once. Also make sure DHCP is set as the boostrap protocol.
</p>

<p>
More information at: <a href="http://wiki.mikrotik.com/wiki/Manual:Netinstall#OPTIONAL:_Configuring_RouterBOARD_with_COM_port" class="urlextern" title="http://wiki.mikrotik.com/wiki/Manual:Netinstall#OPTIONAL:_Configuring_RouterBOARD_with_COM_port"  rel="nofollow">http://wiki.mikrotik.com/wiki/Manual:Netinstall#OPTIONAL:_Configuring_RouterBOARD_with_COM_port</a>
</p>

</div>

<h4 id="from_openwrt">From OpenWrt</h4>
<div class="level4">

<p>
The OpenWrt rbcfg utility permits to configure parameters of the routerboard bootloader. Note that not all routerboards may support this utility.
</p>
<pre class="code">opkg update
opkg install rbcfg

rbcfg set boot_device ethnand
rbcfg apply</pre>

</div>

<h4 id="via_reset_button">Via Reset button</h4>
<div class="level4">
<ol>
<li class="level1"><div class="li"> Unplug RB951ui power jack </div>
</li>
<li class="level1"><div class="li"> Hold reset button (on some models this is just a hole with a hidden pushbutton switch).</div>
</li>
<li class="level1"><div class="li"> Plug power jack</div>
</li>
<li class="level1"><div class="li"> Observe activity LED. </div>
</li>
<li class="level1"><div class="li"> It first goes on continuously. Then it flashes. Then it goes on continuously. Then it goes off continuously. This will take 15..20 seconds. Then a beep sounds (5 seconds later).</div>
</li>
<li class="level1"><div class="li"> Release reset button.</div>
</li>
</ol>

</div>

<h2 class="sectionedit8" id="flash_openwrt">Flash OpenWRT</h2>
<div class="level2">

<p>
Once your routerboard is running OpenWrt initramfs, flash OpenWrt to the NAND flash of the routerboard.
</p>

<p>
Copy openwrt-ar71xx-mikrotik-vmlinux-lzma.elf and openwrt-ar71xx-mikrotik-rootfs.tar.gz to a HTTP/HTTPs server reachable from the routerboard (WAN or <abbr title="Local Area Network">LAN</abbr> ports). Connect to the routerboard via telnet to 192.168.1.1 - or if available via serial console.
</p>

</div>

<h3 class="sectionedit9" id="automated_via_wget2nand">Automated via wget2nand</h3>
<div class="level3">

<p>
Assuming you copied the files to <a href="http://myhttpserver.org/path/openwrt-ar71xx-mikrotik-vmlinux-lzma.elf" class="urlextern" title="http://myhttpserver.org/path/openwrt-ar71xx-mikrotik-vmlinux-lzma.elf"  rel="nofollow">http://myhttpserver.org/path/openwrt-ar71xx-mikrotik-vmlinux-lzma.elf</a>:
</p>
<pre class="code">wget2nand http://myhttpserver.org/path</pre>

</div>

<h4 id="directly_from_openwrtorg">Directly from openwrt.org</h4>
<div class="level4">

<p>
If you want to download the files directly from <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/mikrotik" class="urlextern" title="http://downloads.openwrt.org/snapshots/trunk/ar71xx/mikrotik"  rel="nofollow">http://downloads.openwrt.org/snapshots/trunk/ar71xx/mikrotik</a> instead you have to change url_rootfs in wget2nand:
</p>
<pre class="code">vi /sbin/wget2nand</pre>
<pre class="code">url_rootfs=$url/openwrt-ar71xx-mikrotik-DefaultNoWifi-rootfs.tar.gz</pre>

<p>
Start download and install:
</p>
<pre class="code">wget2nand http://downloads.openwrt.org/snapshots/trunk/ar71xx/mikrotik</pre>

<p>
This will erase kernel and file system partitions on the routerboard and install the vmlinux kernel on the kernel partition and the rootfs onto the filesystem partition.
</p>

<p>
Reboot.
</p>

</div>

<h3 class="sectionedit10" id="manually">Manually</h3>
<div class="level3">

<p>
If wget2nand encounters problems, perform its steps manually from shell.
</p>
<pre class="code">cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00040000 00020000 &quot;booter&quot;
mtd1: 003c0000 00020000 &quot;kernel&quot;
mtd2: 07c00000 00020000 &quot;rootfs&quot;</pre>

<p>
The following instructions assume that as shown above, kernel is /dev/mtd1 and rootfs /dev/mtd2. If these numbers are different on your model, appropriately change the following commands.
</p>
<pre class="code">mtd erase /dev/mtd1
mtd erase /dev/mtd2
mkdir /mnt/kernel
mkdir /mnt/rootfs
mount /dev/mtdblock1 /mnt/kernel
mount /dev/mtdblock2 /mnt/rootfs</pre>

<p>
Copy kernel &amp; rootfs to routerboard:
</p>
<pre class="code">scp bin/ar71xx/openwrt-ar71xx-mikrotik-vmlinux-lzma.elf root@192.168.1.1:/tmp
scp bin/ar71xx/openwrt-ar71xx-mikrotik-DefaultNoWifi-rootfs.tar.gz root@192.168.1.1:/tmp</pre>

<p>
Flash kernel &amp; rootfs
</p>
<pre class="code">mv /tmp/openwrt-ar71xx-nand-vmlinux-lzma.elf /mnt/kernel/kernel
chmod +x /mnt/kernel/kernel
umount /mnt/kernel
cd /mnt/rootfs
tar -xvzf /tmp/openwrt-ar71xx-mikrotik-DefaultNoWifi-rootfs.tar.gz
cd /
umount /mnt/rootfs
sync</pre>

<p>
Reboot
</p>

</div>

<h2 class="sectionedit11" id="initial_setup">Initial setup</h2>
<div class="level2">

</div>

<h3 class="sectionedit12" id="leds">Leds</h3>
<div class="level3">

<p>
Check if the LEDs light up according to their desired functions (eg: under RouterOS). LED configuration is found in /etc/config/system. Depending on model, OpenWrt may have initialized the LEDs correctly. If not, the the model specific wiki page should explain how to configure LEDs in /etc/config/system.
</p>

</div>

<h3 class="sectionedit13" id="understandingconfiguring_ports">Understanding/configuring ports</h3>
<div class="level3">

<p>
By default, OpenWrt tries to set up wired/wireless interfaces so that there is one routed WAN interface which is typically the first wired ethernet port and the remaining wired ethernet port and wireless interfaces are bridged into a <abbr title="Local Area Network">LAN</abbr>. This setup is partially done under the hood and partially it shows up in /etc/config/network and can be seen via linux CLI commands, for example &#039;ifconfig -a&#039;:
</p>

<p>
br-lan this is the linux software bridge interface representing the &#039;lan&#039;. It should by default have IP address 192.168.1.1. It is created by the &#039;config interface lan&#039; section in /etc/config/network. The &#039;option ifname&#039; lists one or more wired interfaces that are included in the bridge. The wireless interface(s) seem to be added to the bridge under the hood. Use &#039;brctl show&#039; to list all interfaces bound to br-lan.
</p>

<p>
eth0, eth1,… are ethernet interfaces. They may each be attached directly to an ethernet port or to a switch. Use &#039;swconfig show&#039; to see which ethernet is connected to a switch. 
</p>

<p>
ethN.M is a VLAN on a switched ethernet. 
</p>

</div>

<h3 class="sectionedit14" id="serial_console">Serial console</h3>
<div class="level3">

<p>
If you solder the UART pins on the board, you can enable the serial console, adding this line to /etc/inittab:
</p>
<pre class="code">ttyS0::askfirst:/bin/ash --login</pre>

</div>

<h2 class="sectionedit15" id="additional_procedures">Additional procedures</h2>
<div class="level2">

</div>

<h3 class="sectionedit16" id="compiling_openwrt">Compiling OpenWRT</h3>
<div class="level3">

<p>
If your model is not yet supported by trunk, you need to download compile and patch OpenWrt sources. Always check if the model specific wiki instructions could already be obsolete and the necessary patches have already been integrated before embarking into compilation.
</p>

<p>
Full instructions are at <a href="../../doc/howto/buildroot.exigence" class="urlextern" title="http://wiki.openwrt.org/doc/howto/buildroot.exigence"  rel="nofollow">http://wiki.openwrt.org/doc/howto/buildroot.exigence</a> The following is a mostly a cheat sheet specifically for routerboards.
</p>

<p>
OpenWrt sources are available via two release management systems, svn and git. If the model specific instructions specified one, use that, otherwise use git (faster).
</p>
<pre class="code"># Find/make some directory:
mkdir mikrotik
cd mikrotik

# Get Barrier Breaker (14.07)
git clone git://git.openwrt.org/14.07/openwrt.git
# Alternatively, get trunk (latest build)
git clone git://git.openwrt.org/openwrt.git

# git created openwrt directory. All further compile commands
# have to be entered from that directory
cd openwrt

# Patch the kernel as needed
wget ... -O patchfile
patch -u -p0 &lt; patchfile

# Set up compilation to build AR71XX images for routerboards as well as initramfs
echo CONFIG_TARGET_ar71xx=y &gt; .config
echo CONFIG_TARGET_ar71xx_mikrotik=y &gt;&gt; .config
echo CONFIG_TARGET_ROOTFS_INITRAMFS=y &gt;&gt; .config
echo CONFIG_TARGET_INITRAMFS_COMPRESSION_NONE=y &gt;&gt; .config
# make defconfig creates the rest of the config file. 
make defconfig
# -j parallel compilation may cause problems, but usually it does not.
# choose the number according to the number of your CPU cores
make -j 6</pre>

<p>
Instead of creating .config manually (most easy), you can use the curses CLI  (after patching)
</p>
<pre class="code">make kernel_menuconfig
-&gt; Target = AR7XXX
-&gt; Subtarget = Mikrotik device with NAND flash
-&gt; Target Images = ramdisk&#039;&#039;
-&gt; save, exit
# Normally you do not need this, but if there are specific kernel options required:
make kernel_menuconfig
# compile normally
make -j 6</pre>

<p>
It can be advantageous to explicitly use the kernel configuration used to build the images on openwrt.org:
</p>
<ul>
<li class="level1"><div class="li"> When comparing behavior between a stock kernel and your patched, self-compiled kernel, you minimize the chance that there are other unexpected changes between the two images beside your patch.</div>
</li>
<li class="level1"><div class="li"> Compiling with exactly the same config as the stock kernel allows you to change the stock kernel over to your self compiled kernel without changing the rest of the OpenWrt installation. To do that you need to install just the kernel and the /lib/modules directory from your compiled rootfs.</div>
</li>
</ul>

<p>
Example with 14.07:
</p>
<pre class="code">git clone git://git.openwrt.org/14.07/openwrt.git
cd openwrt
# Optional, this is the commit from which stock kernels where built for 14.07.
# there should be a better label for this in 14.07, but there is none.
git reset --hard 14cb884013ff7034c7bdd19ba704b252095039ad
# Use exactly the config as stock image:
wget https://downloads.openwrt.org/barrier_breaker/14.07/ar71xx/mikrotik/config.ar71xx_mikrotik
mv config.ar71xx_mikrotik .config
# Patch as needed now
..
# Compile
make -j 6</pre>

<p>
After compilation, the images are in bin/ar71xx. Copy them to your tftp and http server location (including renaming) accordingly to tftp-boot/install them as explained before.
</p>

<p>
Warning: once you run &quot;make&quot;, it will copy files from the &#039;target&#039; directory over to &#039;build_dir&#039; directory including downloading additional software/patches. If you modify/patch files in &#039;target&#039; after a &#039;make&#039;, those changes will not propagate into &#039;build_dir&#039;. To experiment with different patches, you either need to modify files in build_dir directly, or run &#039;make clean&#039; before every make run.
</p>

</div>

<h3 class="sectionedit17" id="saving_mikrotik_routerboard_software_key">Saving MikroTik RouterBoard software key</h3>
<div class="level3">

<p>
If you want to be able to re-flash RouterOS after having flashed OpenWrt, save your RouterOS key.
</p>

<p>
If you have access to the MikroTik&#039;s Winbox software, you can export the license file from System→Licence→Export Key. See <a href="http://wiki.openwrt.org/wiki.mikrotik.com/wiki/manual/license" class="wikilink2" title="wiki.mikrotik.com:wiki:manual:license" rel="nofollow">License</a>.
</p>

<p>
Otherwise, boot RouterOS and export the key to a file:
<pre class="code">/system license output</pre>

</p>

<p>
Then list the files on your device to see which file the .key file was saved:
<pre class="code">/file print</pre>

</p>

<p>
On a fresh install, the key file should be #1 (or #0 on a RB433UAH); to open the editor with file #1, type:
<pre class="code">/file edit 1 value-name=contents</pre>

Then copy-paste the text in a file on your computer. The differences between the obtained key file and a key exported with Winbox are that the <em>SoftwareID</em> line is not present in the latter, and there are no empty lines, so you should probably delete all the empty lines in your file prior to import it for a new installation; the <em>SoftwareID</em> line should not bother the installer (untested).
</p>

</div>

<h3 class="sectionedit18" id="saving_mikrotik_routeros">Saving MikroTik RouterOS</h3>
<div class="level3">

<p>
From TFTP booted OpenWrt:
</p>
<pre class="code">cat /proc/mtd
# the following expects that kernel is mtd1 and rootfs is mtd2
mkdir /mnt kernel /mnt/rootfs
mount -o ro /dev/mtdblock1 /mnt/kernel
mount -o ro /dev/mtdblock2 /mnt/rootfs
cd /mnt/kernel
tar czf /tmp/mikrotik-kernel.tar.gz .
cd /mnt/rootfs
tar czf /tmp/mikrotik-rootfs.tar.gz .
cd /tmp
scp mikrotik* username@your-server:tmp</pre>

</div>

<h2 class="sectionedit19" id="notes">Notes</h2>
<div class="level2">

</div>

<h3 class="sectionedit20" id="patchworks">Patchworks</h3>
<div class="level3">

<p>
Router model specific pages may refer to <a href="http://patchwork.openwrt.org/patch/4773/raw/" class="urlextern" title="http://patchwork.openwrt.org/patch/4773/raw/"  rel="nofollow">http://patchwork.openwrt.org/patch/4773/raw/</a> URLs. That patchwork server was decommissioned in 2014. See <a href="https://dev.openwrt.org/ticket/17785" class="urlextern" title="https://dev.openwrt.org/ticket/17785"  rel="nofollow">https://dev.openwrt.org/ticket/17785</a> and <a href="https://lists.openwrt.org/pipermail/openwrt-devel/2014-December/029786.html" class="urlextern" title="https://lists.openwrt.org/pipermail/openwrt-devel/2014-December/029786.html"  rel="nofollow">https://lists.openwrt.org/pipermail/openwrt-devel/2014-December/029786.html</a>.
</p>

<p>
The new patch server is <a href="https://patchwork.ozlabs.org" class="urlextern" title="https://patchwork.ozlabs.org"  rel="nofollow">https://patchwork.ozlabs.org</a>. Patch numbers for the old server seemingly can not be translated to the new patchwork server so they are not accessible anymore. In general, all patches from the old patchserver should have already been integrated into trunk.
</p>

</div>

<h3 class="sectionedit21" id="rumors">Rumors</h3>
<div class="level3">

<p>
Some wiki pages claim that parallel compilation with -j N mail fail OpenWrt build. This seems not to be a problem for &gt;= 14.07 and AR71XX builds as for RouterBoards, parallel compile seems to work fine.
</p>

<p>
Some wiki pages claim that you need to put paths into the openwrt build tree into your .bashrc so that compilation works correctly. This does not seem to be the case anymore. No problems encountered.
</p>

</div>

<h3 class="sectionedit22" id="links">Links</h3>
<div class="level3">

<p>
<a href="https://patchwork.ozlabs.org/patch/419857/" class="urlextern" title="https://patchwork.ozlabs.org/patch/419857/"  rel="nofollow"> Routerboard 951G Switch Fix</a>
</p>

<p>
<a href="https://lists.openwrt.org/pipermail/openwrt-devel/2014-December/029949.html" class="urlextern" title="https://lists.openwrt.org/pipermail/openwrt-devel/2014-December/029949.html"  rel="nofollow"> Routerboard 2011 Switch Fix thread</a>
</p>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>toh/mikrotik/common.txt</bdi> · Last modified: 2015/05/01 17:39 by <bdi>audiomobster</bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="http://wiki.openwrt.org/toh/mikrotik/common?do=edit"  class="action source" accesskey="v" rel="nofollow" title="Show pagesource [V]"><span>Show pagesource</span></a></li><li><a href="http://wiki.openwrt.org/toh/mikrotik/common?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="http://wiki.openwrt.org/toh/mikrotik/common?do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="common#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license" class="urlextern">CC Attribution-Noncommercial-Share Alike 3.0 Unported</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license"><img src="../../lib/images/license/button/cc-by-nc-sa.png" alt="CC Attribution-Noncommercial-Share Alike 3.0 Unported" /></a>        <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/openwrt/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://www.php.net" title="Powered by PHP" ><img
            src="../../lib/tpl/openwrt/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/openwrt/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../../lib/tpl/openwrt/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/openwrt/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="http://wiki.openwrt.org/lib/exe/indexer.php?id=toh%3Amikrotik%3Acommon&amp;1432284038" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</body>
</html>
