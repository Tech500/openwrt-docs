<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>Mikrotik RouterBoard RB951Ui-2HnD [OpenWrt Wiki]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="toh,mikrotik,rb951ui"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="OpenWrt Wiki"/>
<link rel="start" href="../../index.html"/>
<link rel="contents" href="http://wiki.openwrt.org/toh/mikrotik/rb951ui?do=index" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Recent changes" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="../../feed.php?mode=list&amp;ns=toh:mikrotik"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="http://wiki.openwrt.org/_export/xhtml/toh/mikrotik/rb951ui"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="http://wiki.openwrt.org/_export/raw/toh/mikrotik/rb951ui"/>
<link rel="canonical" href="rb951ui"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php?t=openwrt&amp;tseed=6f44f363dc87908d905dc56ff3acbfc4"/>
<script type="text/javascript">/*<![CDATA[*/var NS='toh:mikrotik';var JSINFO = {"id":"toh:mikrotik:rb951ui","namespace":"toh:mikrotik"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php?tseed=6f44f363dc87908d905dc56ff3acbfc4"></script>
<script type="text/javascript" charset="utf-8">/*<![CDATA[*/jQuery(function(){
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1432284046 166.182.3.100';
			document.forms[i].appendChild(myElement);
		}
	}
});
/*!]]>*/</script>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../../lib/tpl/openwrt/images/favicon.ico" />
<link rel="apple-touch-icon" href="../../lib/tpl/openwrt/images/apple-touch-icon.png" />
    </head>

<body>
    <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_openwrt     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="rb951ui#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="../../start"  accesskey="h" title="[H]"><img src="../../lib/tpl/openwrt/images/logo.png" width="386" height="98" alt="" /> <span>OpenWrt Wiki</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="http://wiki.openwrt.org/toh/mikrotik/rb951ui?do=register"  class="action register" rel="nofollow" title="Register">Register</a></li><li><a href="http://wiki.openwrt.org/toh/mikrotik/rb951ui?do=login&amp;sectok=382740b13d95f946eed36caa57076b4a"  class="action login" rel="nofollow" title="Login">Login</a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="../../start" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="../../doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="toh:mikrotik:rb951ui" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Show pagesource</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Login</option><option value="register">Register</option></optgroup></select><input type="submit" value="&gt;" /></div></form>            </div>
            <ul>
                <li><a href="http://wiki.openwrt.org/toh/mikrotik/rb951ui?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a></li><li><a href="http://wiki.openwrt.org/toh/mikrotik/rb951ui?do=media&amp;ns=toh%3Amikrotik"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a></li><li><a href="http://wiki.openwrt.org/toh/mikrotik/rb951ui?do=index"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                            <div class="youarehere"><span class="bchead">You are here: </span><span class="home"><bdi><a href="../../start" class="wikilink1" title="start">OpenWrt Wiki</a></bdi></span> » <bdi><a href="../start" class="wikilink1" title="toh:start">Table of Hardware</a></bdi> » <bdi><a href="start" class="wikilink1" title="toh:mikrotik:start">Mikrotik</a></bdi> » <bdi><span class="curid"><a href="rb951ui" class="wikilink1" title="toh:mikrotik:rb951ui">Mikrotik RouterBoard RB951Ui-2HnD</a></span></bdi></div>
                                    <div class="plugin_multilingual">
        <ul>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/cz/toh/mikrotik/rb951ui" class="media" title="cz:toh:mikrotik:rb951ui"><img src="../../lib/exe/fetch.php?cache=&amp;tok=aff589&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fcz.gif" class="media" title="Čeština (Czech)" alt="Čeština (Czech)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/de/toh/mikrotik/rb951ui" class="media" title="de:toh:mikrotik:rb951ui"><img src="../../lib/exe/fetch.php?cache=&amp;tok=e24010&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fde.gif" class="media" title="Deutsch (German)" alt="Deutsch (German)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <span class="curid"><a href="rb951ui" class="media" title="toh:mikrotik:rb951ui"><img src="../../lib/exe/fetch.php?cache=&amp;tok=2a37ae&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fgb.gif" class="media" title="English" alt="English" /></a></span>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/es/toh/mikrotik/rb951ui" class="media" title="es:toh:mikrotik:rb951ui"><img src="../../lib/exe/fetch.php?cache=&amp;tok=46c004&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fmx.gif" class="media" title="Español (Spanish, Mexico)" alt="Español (Spanish, Mexico)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/fr/toh/mikrotik/rb951ui" class="media" title="fr:toh:mikrotik:rb951ui"><img src="../../lib/exe/fetch.php?cache=&amp;tok=a5beba&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ffr.gif" class="media" title="Français (French)" alt="Français (French)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/hu/toh/mikrotik/rb951ui" class="media" title="hu:toh:mikrotik:rb951ui"><img src="../../lib/exe/fetch.php?cache=&amp;tok=6b5470&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fhu.gif" class="media" title="Magyar (Hungarian)" alt="Magyar (Hungarian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/jp/toh/mikrotik/rb951ui" class="media" title="jp:toh:mikrotik:rb951ui"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f999fc&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fjp.gif" class="media" title="日本語 (Japanese)" alt="日本語 (Japanese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pl/toh/mikrotik/rb951ui" class="media" title="pl:toh:mikrotik:rb951ui"><img src="../../lib/exe/fetch.php?cache=&amp;tok=c805c0&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fpl.gif" class="media" title="Poliski (Polish)" alt="Poliski (Polish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pt-br/toh/mikrotik/rb951ui" class="media" title="pt-br:toh:mikrotik:rb951ui"><img src="../../lib/exe/fetch.php?cache=&amp;tok=13127d&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fbr.gif" class="media" title="Português brasileiro (Portuguese, Brasil)" alt="Português brasileiro (Portuguese, Brasil)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <a href="http://wiki.openwrt.org/ru/toh/mikrotik/rb951ui" class="media" title="ru:toh:mikrotik:rb951ui"><img src="../../lib/exe/fetch.php?cache=&amp;tok=66ab5e&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fru.gif" class="media" title="Русский (Russsian)" alt="Русский (Russsian)" /></a>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/tr/toh/mikrotik/rb951ui" class="media" title="tr:toh:mikrotik:rb951ui"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f4beed&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ftr.gif" class="media" title="Tϋrkçe (Turkish)" alt="Tϋrkçe (Turkish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-cn/toh/mikrotik/rb951ui" class="media" title="zh-cn:toh:mikrotik:rb951ui"><img src="../../lib/exe/fetch.php?cache=&amp;tok=93625a&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-cn.gif" class="media" title="官話/官话 (Chinese)" alt="官話/官话 (Chinese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-tw/toh/mikrotik/rb951ui" class="media" title="zh-tw:toh:mikrotik:rb951ui"><img src="../../lib/exe/fetch.php?cache=&amp;tok=b56198&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-tw.gif" class="media" title="臺灣華語 (Taiwanese)" alt="臺灣華語 (Taiwanese)" /></a>
              </div>
            </div>
          </li>
        </ul>
      </div>
        </div>
    
    
    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">

                <div class="pageId"><span>toh:mikrotik:rb951ui</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level2"><div class="li"><a href="rb951ui#mikrotik_routerboard_rb951ui-2hnd">Mikrotik RouterBoard RB951Ui-2HnD</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="rb951ui#hardware">Hardware</a></div></li>
<li class="level3"><div class="li"><a href="rb951ui#download_openwrt_image">Download OpenWRT image</a></div></li>
<li class="level3"><div class="li"><a href="rb951ui#netboot_rg951ui_to_openwrt_in_ram">Netboot RG951ui to OpenWrt in RAM</a></div></li>
<li class="level3"><div class="li"><a href="rb951ui#flash_openwrt_to_mikrotik_via_wget2nand">Flash OpenWRT to Mikrotik via wget2nand</a></div></li>
<li class="level3"><div class="li"><a href="rb951ui#initial_setup">Initial setup</a></div></li>
<li class="level3"><div class="li"><a href="rb951ui#flash_openwrt_to_mikrotik_manually">Flash OpenWRT to Mikrotik manually</a></div></li>
<li class="level3"><div class="li"><a href="rb951ui#compile_openwrt_yourself">Compile OpenWRT yourself</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h3 class="sectionedit1" id="mikrotik_routerboard_rb951ui-2hnd">Mikrotik RouterBoard RB951Ui-2HnD</h3>
<div class="level3">

</div>

<h4 id="hardware">Hardware</h4>
<div class="level4">
<div class="table sectionedit2"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> CPU </th><th class="col1"> CPU Speed </th><th class="col2"> RAM (<abbr title="Megabyte">MB</abbr>) </th><th class="col3"> NAND (<abbr title="Megabyte">MB</abbr>) </th><th class="col4"> Serial Flash </th><th class="col5"> Ethernet Switch </th><th class="col6"> PoE port </th><th class="col7"> Wireless </th><th class="col8"> USB </th><th class="col9"> UART </th><th class="col10"> JTAG </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> AR9334 </td><td class="col1"> 600 <abbr title="Megahertz">MHz</abbr> </td><td class="col2"> 128 (2x W9751G6KB-25) </td><td class="col3"> 128 (1x TC58DVG02D5TA00-ND) </td><td class="col4"> MX25L512E </td><td class="col5"> AR7240 (10M/100M) </td><td class="col6"> 1-in 5-out (500mA) </td><td class="col7"> AR9344-DC3A </td><td class="col8"> 1x 2.0 </td><td class="col9"> 1x onboard </td><td class="col10"> 1x onboard </td>
	</tr>
</table></div>

</div>

<h4 id="download_openwrt_image">Download OpenWRT image</h4>
<div class="level4">

<p>
The 951Ui-2HnD is supported starting with OpenWRT 14.07.
</p>
<pre class="code">wget -c https://downloads.openwrt.org/latest/ar71xx/mikrotik/openwrt-ar71xx-mikrotik-vmlinux-initramfs.elf
wget -c https://downloads.openwrt.org/latest/ar71xx/mikrotik/openwrt-ar71xx-mikrotik-vmlinux-lzma.elf
wget -c https://downloads.openwrt.org/latest/ar71xx/mikrotik/openwrt-ar71xx-mikrotik-DefaultNoWifi-rootfs.tar.gz
ln -s openwrt-ar71xx-mikrotik-DefaultNoWifi-rootfs.tar.gz openwrt-ar71xx-mikrotik-rootfs.tar.gz</pre>

<p>
Installing OpenWRT is a two-stage process. First netboot the router via DHCP/TFTP to OpenWRT initramfs running in RAM. From that OpenWRT download/install OpenWRT kernel and filesystem onto NAND Flash. That second stage overwrites the MikroTik <abbr title="Operating System">OS</abbr> (RouterOS) in NAND Flash, but it does not touch the MikroTik Bootloader.
</p>

</div>

<h4 id="netboot_rg951ui_to_openwrt_in_ram">Netboot RG951ui to OpenWrt in RAM</h4>
<div class="level4">

<p>
Connect port 1 (WAN port) to a network with a DHCP/TFTP server. Connect a PC to port 2..5 or WLAN. Log into RouterOS and set router to boot from ethernet once with DHCP:
</p>
<ol>
<li class="level1"><div class="li"> System → Routerboard → Settings → Boot device: Try ethernet once then NAND</div>
</li>
<li class="level1"><div class="li"> System → Routerboard → Settings → Boot protocol: DHCP</div>
</li>
</ol>

<p>
Copy openwrt-ar71xx-mikrotik-vmlinux-initramfs.elf to your TFTP server location. Set up your DHCP server to point to your TFTP server as the next-server and to that file as the bootfile (see below how to use dnsmasq as DHCP+TFTP as an example). 
Reboot RG951ui. If it netboots into OpenWRT you will see P5 lighting red. Otherwise, manually netboot RB951ui:
</p>
<ol>
<li class="level1"><div class="li"> Unplug RB951ui power jack </div>
</li>
<li class="level1"><div class="li"> Hold reset button</div>
</li>
<li class="level1"><div class="li"> Plug power jack</div>
</li>
<li class="level1"><div class="li"> Observe ACT LED. </div>
</li>
<li class="level1"><div class="li"> It first goes on continuously. Then it flashes. Then it goes on continuously. Then it goes off continuously. This will take 15..20 seconds. Then a beep sounds (5 seconds later).</div>
</li>
<li class="level1"><div class="li"> Release reset button.</div>
</li>
</ol>

<p>
When successfull, P5 LED should light red.
If netbooting fails, reset RG951ui to factory condition and try again: Same as netbooting, but release reset button when ACT flashed, then wait a minute or so until double-beep, then RouterOS is up and running.
</p>

<p>
<em> How to use dnsmasq as DHCP + TFTP server </em>
</p>

<p>
Copy openwrt-ar71xx-mikrotik-vmlinux-initramfs.elf to /tftp/
Create script: nano /tftp/loader.sh
</p>
<pre class="code">#/bin/bash
ifconfig eth0 192.168.1.10 up
dnsmasq -i eth0 --dhcp-range=192.168.1.100,192.168.1.200 \
--dhcp-boot=openwrt-ar71xx-mikrotik-vmlinux-initramfs.elf \
--enable-tftp --tftp-root=/home/user/mikrotik/trunk/bin/ar71xx/ -d -u test -p0 -K --log-dhcp --bootp-dynamic</pre>

<p>
Run script loader.sh
Reboot RB951ui as described above
</p>

</div>

<h4 id="flash_openwrt_to_mikrotik_via_wget2nand">Flash OpenWRT to Mikrotik via wget2nand</h4>
<div class="level4">

<p>
Copy openwrt-ar71xx-mikrotik-vmlinux-lzma.elf and openwrt-ar71xx-mikrotik-rootfs.tar.gz to a HTTP/HTTPs server reachable from the RB951ui (Port 1/Wan or Port2..5). Connect to the router via telnet to 192.168.1.1 (or Uart if you soldered a serial console). Example: <a href="http://myhttpserver.org/path/openwrt-ar71xx-mikrotik-vmlinux-lzma.elf" class="urlextern" title="http://myhttpserver.org/path/openwrt-ar71xx-mikrotik-vmlinux-lzma.elf"  rel="nofollow">http://myhttpserver.org/path/openwrt-ar71xx-mikrotik-vmlinux-lzma.elf</a>
</p>
<pre class="code">root@OpenWrt:/# wget2nand http://myhttpserver.org/path</pre>

<p>
Reboot.
</p>

</div>

<h4 id="initial_setup">Initial setup</h4>
<div class="level4">

</div>

<h5 id="leds">Leds</h5>
<div class="level5">

<p>
Add these lines to /etc/config/system
</p>
<pre class="code">config led &#039;act&#039;
      option trigger &#039;netdev&#039;
      option mode &#039;link tx rx&#039;
      option sysfs &#039;rb:green:act&#039;
      option name &#039;ACT&#039;
      option dev &#039;eth1&#039;
      option brightness &#039;0&#039;
      option default &#039;0&#039;
config led &#039;p1&#039;
      option trigger &#039;netdev&#039;
      option name &#039;Port_1&#039;
      option sysfs &#039;rb:green:port1&#039;
      option dev &#039;eth0&#039;
      option mode &#039;link tx rx&#039;
      option default &#039;0&#039;
config led &#039;p2&#039;
      option trigger &#039;switch0&#039;
      option name &#039;Port_2&#039;
      option sysfs &#039;rb:green:port2&#039;
      option port_mask &#039;0x10&#039;
      option default &#039;0&#039;
config led &#039;p3&#039;
      option name &#039;Port_3&#039;
      option sysfs &#039;rb:green:port3&#039;
      option trigger &#039;switch0&#039;
      option port_mask &#039;0x8&#039;
      option default &#039;0&#039;
config led &#039;p4&#039;
      option name &#039;Port_4&#039;
      option trigger &#039;switch0&#039;
      option sysfs &#039;rb:green:port4&#039;
      option port_mask &#039;0x4&#039;
      option default &#039;0&#039;
config led &#039;p5&#039;
      option name &#039;Port_5&#039;
      option sysfs &#039;rb:green:port5&#039;
      option trigger &#039;switch0&#039;
      option port_mask &#039;0x2&#039;
      option default &#039;0&#039;
config led &#039;wlan&#039;
      option sysfs &#039;rb:green:wlan&#039;
      option name &#039;WLAN&#039;
      option trigger &#039;phy0tpt&#039;
      option default &#039;0&#039;</pre>

<p>
There is a red led on port 5, which seems to be some indication of PoE (or lack of, not sure). By default it&#039;s always on. You can turn it off with the following command. You can put it in /etc/rc.local
</p>
<pre class="code">echo 0 &gt; /sys/devices/virtual/gpio/gpio2/value</pre>

<p>
In /etc/config/network, add these lines to enable the built-in ethernet switch between borts 2..5.
</p>
<pre class="code">config switch &#039;eth1&#039;
      option enable &#039;1&#039;
      </pre>

<p>
You are done. The following sections explain optional / alternative steps.
</p>

</div>

<h5 id="serial_console">Serial console</h5>
<div class="level5">

<p>
If you solder the UART pins on the board, you can enable the serial console, adding this line to /etc/inittab:
</p>
<pre class="code">ttyS0::askfirst:/bin/ash --login</pre>

</div>

<h5 id="example_vlan_configuration_for_switch_ports">Example VLAN configuration for switch ports</h5>
<div class="level5">

<p>
In /etc/config/network, add these lines to enable the switch, and create 2 vlan interfaces (eth1.11 and eth1.12). The first for ports 5 and 4, and the later for ports 3 and 2. Port 1 on the router is eth0.
</p>
<pre class="code">config switch &#039;eth1&#039;
      option enable &#039;1&#039;
      option enable_vlan &#039;1&#039;
config switch_vlan
      option device &#039;eth1&#039;
      option vlan &#039;11&#039;
      option vid &#039;11&#039;
      option ports &#039;0t 1 2&#039;
config switch_vlan
      option device &#039;eth1&#039;
      option vlan &#039;12&#039;
      option vid &#039;12&#039;
      option ports &#039;0t 3 4&#039;
      </pre>

</div>

<h4 id="flash_openwrt_to_mikrotik_manually">Flash OpenWRT to Mikrotik manually</h4>
<div class="level4">

<p>
If wget2nand encounters problems, perform its steps manually from shell:
</p>
<pre class="code">root@OpenWrt:/# passwd
root@OpenWrt:/# mtd erase /dev/mtd1
root@OpenWrt:/# mtd erase /dev/mtd2
root@OpenWrt:/# mkdir /mnt/kernel
root@OpenWrt:/# mkdir /mnt/rootfs
root@OpenWrt:/# mount /dev/mtdblock1 /mnt/kernel
root@OpenWrt:/# mount /dev/mtdblock2 /mnt/rootfs</pre>

<p>
<code> Copy kernel &amp; rootfs to RB951Ui </code>
</p>
<pre class="code">$ scp bin/ar71xx/openwrt-ar71xx-mikrotik-vmlinux-lzma.elf root@192.168.1.1:/tmp
$ scp bin/ar71xx/openwrt-ar71xx-mikrotik-DefaultNoWifi-rootfs.tar.gz root@192.168.1.1:/tmp</pre>

<p>
<code> Flash kernel &amp; rootfs </code>
</p>
<pre class="code">root@OpenWrt:/# mv /tmp/openwrt-ar71xx-nand-vmlinux-lzma.elf /mnt/kernel/kernel
root@OpenWrt:/# chmod +x /mnt/kernel/kernel
root@OpenWrt:/# umount /mnt/kernel
root@OpenWrt:/# cd /mnt/rootfs
root@OpenWrt:/# tar -xvzf /tmp/openwrt-ar71xx-mikrotik-DefaultNoWifi-rootfs.tar.gz
root@OpenWrt:/# cd /
root@OpenWrt:/# umount /mnt/rootfs
root@OpenWrt:/# sync</pre>

<p>
Reboot
</p>

</div>

<h4 id="compile_openwrt_yourself">Compile OpenWRT yourself</h4>
<div class="level4">

<p>
This section was written before the rb951ui was supported by released OpenWRT images. You only need this section if you plan to not use those supported images.
</p>
<pre class="code">$ mkdir /home/user/mikrotik/
$ cd /home/user/mikrotik/
$ svn co -r 39392 svn://svn.openwrt.org/openwrt/trunk/
$ cd /home/user/mikrotik/trunk
$ wget -c http://patchwork.openwrt.org/patch/4773/raw/ -O OpenWrt-Devel-ar71xx-Add-support-for-MikroTik-RB951Ui-2HnD.patch
$ patch -u -p0 &lt; OpenWrt-Devel-ar71xx-Add-support-for-MikroTik-RB951Ui-2HnD.patch</pre>

<p>
<em> Configure image for booting from RAM </em>
</p>
<pre class="code">$ make menuconfig
$ make kernel_menuconfig</pre>

<p>
<code> Target = AR7XXX
 Subtarget = Mikrotik device with NAND flash
 Target Images = ramdisk</code>
</p>
<pre class="code">$ make V=s</pre>

<p>
<em> Configure image for booting from NAND </em>
</p>
<pre class="code">$ make menuconfig</pre>

<p>
<code> Target = AR7XXX
 Subtarget = Mikrotik device with NAND flash
 Target Images = tar.gz</code>
</p>
<pre class="code">$ make V=s</pre>

<p>
After compiling your image, go back to the section for Booting to OepnWrt in RAM.
If your image predates 14.07, you may also need to install the WiFi driver (Install kmod-ath9k).
</p>

<p>
<code>About:
<a href="http://routerboard.com/RB951Ui-2HnD" class="urlextern" title="http://routerboard.com/RB951Ui-2HnD"  rel="nofollow">http://routerboard.com/RB951Ui-2HnD</a>
Helpfull info:
<a href="http://www.lan23.ru/forum/showthread.php?t=10780" class="urlextern" title="http://www.lan23.ru/forum/showthread.php?t=10780"  rel="nofollow">http://www.lan23.ru/forum/showthread.php?t=10780</a> (HowTo on Russian)
<a href="http://patchwork.openwrt.org/patch/3976/" class="urlextern" title="http://patchwork.openwrt.org/patch/3976/"  rel="nofollow">http://patchwork.openwrt.org/patch/3976/</a>
<a href="http://www.ericconrad.com/2012/05/installing-openwrt-on-routerboard-750gl.html" class="urlextern" title="http://www.ericconrad.com/2012/05/installing-openwrt-on-routerboard-750gl.html"  rel="nofollow">http://www.ericconrad.com/2012/05/installing-openwrt-on-routerboard-750gl.html</a>
<a href="http://ayufan.eu/projects/openwrt-rb951g/" class="urlextern" title="http://ayufan.eu/projects/openwrt-rb951g/"  rel="nofollow">http://ayufan.eu/projects/openwrt-rb951g/</a>
<a href="http://openwrt.ayufan.eu/rb951g/" class="urlextern" title="http://openwrt.ayufan.eu/rb951g/"  rel="nofollow">http://openwrt.ayufan.eu/rb951g/</a>
</code>
</p>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>toh/mikrotik/rb951ui.txt</bdi> · Last modified: 2015/04/20 04:32 by <bdi>toerless</bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="http://wiki.openwrt.org/toh/mikrotik/rb951ui?do=edit"  class="action source" accesskey="v" rel="nofollow" title="Show pagesource [V]"><span>Show pagesource</span></a></li><li><a href="http://wiki.openwrt.org/toh/mikrotik/rb951ui?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="http://wiki.openwrt.org/toh/mikrotik/rb951ui?do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="rb951ui#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license" class="urlextern">CC Attribution-Noncommercial-Share Alike 3.0 Unported</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license"><img src="../../lib/images/license/button/cc-by-nc-sa.png" alt="CC Attribution-Noncommercial-Share Alike 3.0 Unported" /></a>        <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/openwrt/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://www.php.net" title="Powered by PHP" ><img
            src="../../lib/tpl/openwrt/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/openwrt/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../../lib/tpl/openwrt/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/openwrt/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="http://wiki.openwrt.org/lib/exe/indexer.php?id=toh%3Amikrotik%3Arb951ui&amp;1432284046" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</body>
</html>
