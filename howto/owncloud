<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>ownCloud on OpenWrt [OpenWrt Wiki]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="doc,howto,owncloud"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="OpenWrt Wiki"/>
<link rel="start" href="../../index.html"/>
<link rel="contents" href="owncloud?do=index" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Recent changes" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="../../feed.php?mode=list&amp;ns=doc:howto"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/doc/howto/owncloud"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../../_export/raw/doc/howto/owncloud"/>
<link rel="canonical" href="owncloud"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php?t=openwrt&amp;tseed=6f44f363dc87908d905dc56ff3acbfc4"/>
<script type="text/javascript">/*<![CDATA[*/var NS='doc:howto';var JSINFO = {"id":"doc:howto:owncloud","namespace":"doc:howto"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php?tseed=6f44f363dc87908d905dc56ff3acbfc4"></script>
<script type="text/javascript" charset="utf-8">/*<![CDATA[*/jQuery(function(){
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1432267152 166.182.3.14';
			document.forms[i].appendChild(myElement);
		}
	}
});
/*!]]>*/</script>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../../lib/tpl/openwrt/images/favicon.ico" />
<link rel="apple-touch-icon" href="../../lib/tpl/openwrt/images/apple-touch-icon.png" />
    </head>

<body>
    <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_openwrt     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="owncloud#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="../../start"  accesskey="h" title="[H]"><img src="../../lib/tpl/openwrt/images/logo.png" width="386" height="98" alt="" /> <span>OpenWrt Wiki</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="owncloud?do=register"  class="action register" rel="nofollow" title="Register">Register</a></li><li><a href="owncloud?do=login&amp;sectok=382740b13d95f946eed36caa57076b4a"  class="action login" rel="nofollow" title="Login">Login</a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="../../start" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="../../doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="doc:howto:owncloud" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Show pagesource</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Login</option><option value="register">Register</option></optgroup></select><input type="submit" value="&gt;" /></div></form>            </div>
            <ul>
                <li><a href="owncloud?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a></li><li><a href="owncloud?do=media&amp;ns=doc%253Ahowto"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a></li><li><a href="owncloud?do=index"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                            <div class="youarehere"><span class="bchead">You are here: </span><span class="home"><bdi><a href="../../start" class="wikilink1" title="start">OpenWrt Wiki</a></bdi></span> » <bdi><a href="../start" class="wikilink1" title="doc:start">Documentation</a></bdi> » <bdi><a href="start" class="wikilink1" title="doc:howto:start">HOWTOs</a></bdi> » <bdi><span class="curid"><a href="owncloud" class="wikilink1" title="doc:howto:owncloud">ownCloud on OpenWrt</a></span></bdi></div>
                                    <div class="plugin_multilingual">
        <ul>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/cz/doc/howto/owncloud" class="media" title="cz:doc:howto:owncloud"><img src="../../lib/exe/fetch.php?cache=&amp;tok=aff589&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fcz.gif" class="media" title="Čeština (Czech)" alt="Čeština (Czech)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/de/doc/howto/owncloud" class="media" title="de:doc:howto:owncloud"><img src="../../lib/exe/fetch.php?cache=&amp;tok=e24010&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fde.gif" class="media" title="Deutsch (German)" alt="Deutsch (German)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <span class="curid"><a href="owncloud" class="media" title="doc:howto:owncloud"><img src="../../lib/exe/fetch.php?cache=&amp;tok=2a37ae&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fgb.gif" class="media" title="English" alt="English" /></a></span>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/es/doc/howto/owncloud" class="media" title="es:doc:howto:owncloud"><img src="../../lib/exe/fetch.php?cache=&amp;tok=46c004&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fmx.gif" class="media" title="Español (Spanish, Mexico)" alt="Español (Spanish, Mexico)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/fr/doc/howto/owncloud" class="media" title="fr:doc:howto:owncloud"><img src="../../lib/exe/fetch.php?cache=&amp;tok=a5beba&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ffr.gif" class="media" title="Français (French)" alt="Français (French)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/hu/doc/howto/owncloud" class="media" title="hu:doc:howto:owncloud"><img src="../../lib/exe/fetch.php?cache=&amp;tok=6b5470&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fhu.gif" class="media" title="Magyar (Hungarian)" alt="Magyar (Hungarian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/jp/doc/howto/owncloud" class="media" title="jp:doc:howto:owncloud"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f999fc&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fjp.gif" class="media" title="日本語 (Japanese)" alt="日本語 (Japanese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pl/doc/howto/owncloud" class="media" title="pl:doc:howto:owncloud"><img src="../../lib/exe/fetch.php?cache=&amp;tok=c805c0&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fpl.gif" class="media" title="Poliski (Polish)" alt="Poliski (Polish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pt-br/doc/howto/owncloud" class="media" title="pt-br:doc:howto:owncloud"><img src="../../lib/exe/fetch.php?cache=&amp;tok=13127d&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fbr.gif" class="media" title="Português brasileiro (Portuguese, Brasil)" alt="Português brasileiro (Portuguese, Brasil)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/ru/doc/howto/owncloud" class="media" title="ru:doc:howto:owncloud"><img src="../../lib/exe/fetch.php?cache=&amp;tok=66ab5e&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fru.gif" class="media" title="Русский (Russsian)" alt="Русский (Russsian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/tr/doc/howto/owncloud" class="media" title="tr:doc:howto:owncloud"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f4beed&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ftr.gif" class="media" title="Tϋrkçe (Turkish)" alt="Tϋrkçe (Turkish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-cn/doc/howto/owncloud" class="media" title="zh-cn:doc:howto:owncloud"><img src="../../lib/exe/fetch.php?cache=&amp;tok=93625a&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-cn.gif" class="media" title="官話/官话 (Chinese)" alt="官話/官话 (Chinese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-tw/doc/howto/owncloud" class="media" title="zh-tw:doc:howto:owncloud"><img src="../../lib/exe/fetch.php?cache=&amp;tok=b56198&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-tw.gif" class="media" title="臺灣華語 (Taiwanese)" alt="臺灣華語 (Taiwanese)" /></a>
              </div>
            </div>
          </li>
        </ul>
      </div>
        </div>
    
    
    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">

                <div class="pageId"><span>doc:howto:owncloud</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="owncloud#get_openwrt">Get OpenWrt</a></div></li>
<li class="level1"><div class="li"><a href="owncloud#get_usb-support">Get USB-support</a></div></li>
<li class="level1"><div class="li"><a href="owncloud#if_8mb_flashget_extroot">If &lt;= 8MB flash: Get extroot</a></div></li>
<li class="level1"><div class="li"><a href="owncloud#install_configure_webserver">Install &amp; configure webserver</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="owncloud#use_luci_with_httpd_default_web_server_for_luci">use luci with httpd (default web server for luci)</a></div></li>
<li class="level2"><div class="li"><a href="owncloud#disable_httpd_and_use_luci_on_lighttpd">disable httpd and use luci on lighttpd</a></div></li>
<li class="level2"><div class="li"><a href="owncloud#configure_lighttpd_for_owncloud">Configure lighttpd for OwnCloud</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="owncloud#install_configure_php">Install &amp; configure PHP</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="owncloud#activate_php_in_lighttpdconf">activate PHP in lighttpd.conf</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="owncloud#get_ssl_optional">Get SSL (optional)</a></div></li>
<li class="level1"><div class="li"><a href="owncloud#unleash_owncloud">unleash OwnCloud</a></div></li>
<li class="level1"><div class="li"><a href="owncloud#the_easiest_way_to_install_owncloud">The easiest way to install owncloud</a></div></li>
<li class="level1"><div class="li"><a href="owncloud#owncloud_on_alternative_destination">Owncloud on alternative destination</a></div></li>
<li class="level1"><div class="li"><a href="owncloud#known_bugs">Known bugs</a></div></li>
<li class="level1"><div class="li"><a href="owncloud#written_by">Written by</a></div></li>
<li class="level1"><div class="li"><a href="owncloud#resources">Resources</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="owncloud_on_openwrt">ownCloud on OpenWrt</h1>
<div class="level1">

<p>
Hint: I&#039;ve installed OwnCloud on an TP-Link <a href="../../toh/tp-link/tl-wr2543nd" class="wikilink1" title="toh:tp-link:tl-wr2543nd">TL-WR2543ND</a>, using lighttpd and sorry, it&#039;s dead slow! <img src="../../lib/images/smileys/icon_sad.gif" class="icon" alt=":-(" />
</p>

<p>
 — <em>unknown</em>
</p>

<p>
I&#039;ve also installed it on a more powerful TP_Link <a href="../../toh/tp-link/tl-wdr3500" class="wikilink1" title="toh:tp-link:tl-wdr3500">TL-WDR3500</a> but it&#039;s still very slow, 4-5 secs per page…
</p>

<p>
 — <em>motherjoker 2014/06/05 15:41</em>
</p>

</div>

<h2 class="sectionedit2" id="get_openwrt">Get OpenWrt</h2>
<div class="level2">

<p>
Use Attitude Adjustment or current trunk-version of OpenWrt[0], because one necessary package (php5-mod-zip) isn&#039;t available in version 10.3.1. The web resources of OpenWrt will help you figuring out what firmware you will need for your device and how to flash it.
</p>
<div class="table sectionedit3"><table class="inline">
	<tr class="row0">
		<td class="col0"> <img src="../../_media/meta/icons/tango/48px-outdated.svg.png" class="media" alt="" /> </td><td class="col1 leftalign"> OpenWrt is not built with locale support by default, which is needed for ownCloud. Therefore this HOWTO only works if you compile your own OpenWRT firmware image and include full language support in the kernel. For more information see <a href="https://forum.openwrt.org/viewtopic.php?id=45251" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=45251"  rel="nofollow">https://forum.openwrt.org/viewtopic.php?id=45251</a>.  </td>
	</tr>
</table></div>

</div>

<h2 class="sectionedit4" id="get_usb-support">Get USB-support</h2>
<div class="level2">

<p>
ownCloud is around 30 <abbr title="Megabyte">MB</abbr> and you will like to store your data somewhere. So best both is done on some external storage because small routers don&#039;t have that much.
Have a look in the OpenWrt-Wiki at usb.essentials [1] and usb.storage[2], and figure out what USB-mode your device is using (ohci or uhci) and know what filesystem is on your storage (here: ext4).
</p>

<p>
You have to run an update of the package-lists before you can install any software
</p>
<pre class="code">opkg update</pre>

<p>
Install USB-support (this is for USB 2.0, see usb.essentials for USB 1.1 support)
</p>
<pre class="code">opkg install kmod-usb2
insmod ehci-hcd</pre>

<p>
If you see messages like &quot;unresolved symbol usb_calc_bus_time&quot; try loading usbcore and then try ehci-hcd again:
</p>
<pre class="code">insmod usbcore
insmod ehci-hcd</pre>

<p>
Install USB-storage support
</p>
<pre class="code">opkg install kmod-usb-storage kmod-usb-storage-extras block-mount kmod-fs-ext4 kmod-scsi-generic</pre>

<p>
Create a mount-point like this
</p>
<pre class="code">mkdir /mnt/sda1</pre>

<p>
Figure out which device is your USB-stick/drive and mount it. It helps to list /dev with the USB-device and without - in this case its /dev/sda1.
</p>
<pre class="code">mount -t ext4 /dev/sda1 /mnt/sda1 -o rw,sync</pre>

<p>
Get fstab to auto-mount the usb-stick on startup, otherwise your webserver won&#039;t come up and you have to start it after mounting manually. ( <img src="../../lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> Insert how-to here)
Even if auto-mounting on startup works, it probably ends too late when the webserver tries to start. To make sure the webserver is up after booting, insert this line into /etc/rc.local before &quot;exit 0&quot;:
</p>
<pre class="code">/etc/init.d/lighttpd start</pre>

</div>

<h2 class="sectionedit5" id="if_8mb_flashget_extroot">If &lt;= 8MB flash: Get extroot</h2>
<div class="level2">

<p>
If your device has only 8 <abbr title="Megabyte">MB</abbr> of flash-memory (or even less), it is too small to get all the dependencies on it. You&#039;ll need to put the operating-system on the USB-device as well. Have a look at <a href="extroot" class="wikilink1" title="doc:howto:extroot">extroot</a> and follow the instructions for trunk. The flavour &quot;New external overlay variant (pivot overlay)&quot; worked for me on a TP-Link WR1043ND quite well. Remember to use both steps while &quot;Duplicate Data&quot;: pivot overlay and pivot root.
</p>

</div>

<h2 class="sectionedit6" id="install_configure_webserver">Install &amp; configure webserver</h2>
<div class="level2">

</div>

<h3 class="sectionedit7" id="use_luci_with_httpd_default_web_server_for_luci">use luci with httpd (default web server for luci)</h3>
<div class="level3">

<p>
May you have already the OpenWrt web-interface (luci) on your router, may you want to get the OpenWrt web-interface initially.
</p>

<p>
If you like OpenWrt-webinterface luci, install it
</p>
<pre class="code">opkg install uhttpd luci</pre>

<p>
You&#039;re able to start uhttpd twice: Add a new uhttpd section in the /etc/config/uhttpd file. And don&#039;t forget to serve luci on another port.
</p>
<div class="table sectionedit8"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>
config uhttpd owncloud
    list listen_http  0.0.0.0:80
    list listen_http  0.0.0.0:443

    option home /www/owncloud

    list interpreter  &quot;.php=/usr/bin/php-cgi&quot;

    option index_page  index.php, index.html, index.htm, default.html, default.htm

…

config uhttpd config
    list listen_https  192.168.1.1:81
    list listen_https  0.0.0.0:444

    option home  /www
</code></td>
	</tr>
</table></div>

<p>
after a restart of uhhtp
</p>
<pre class="code">/etc/init.d/uhttpd restart</pre>

<p>
you should be able to reach luci under e.g. <a href="http://192.168.1.1:81" class="urlextern" title="http://192.168.1.1:81"  rel="nofollow">http://192.168.1.1:81</a>
</p>

</div>

<h3 class="sectionedit9" id="disable_httpd_and_use_luci_on_lighttpd">disable httpd and use luci on lighttpd</h3>
<div class="level3">

<p>
Somewhere I got the hint to use lighttpd for running ownCloud. I tried out uhttpd simultaneously - the interface looked quite broken.
</p>

<p>
If you don&#039;t want to run two web servers simultaneously:
</p>

<p>
Disable uhttpd even after reboot
</p>
<pre class="code">/etc/init.d/uhttpd disable
/etc/init.d/uhttpd stop</pre>

<p>
Remember, at this point you can&#039;t use luci. So install lighttpd:
</p>
<pre class="code">opkg install lighttpd lighttpd-mod-cgi lighttpd-mod-fastcgi lighttpd-mod-access</pre>

<p>
<em>If the httpd server is located on the SquashFS, it is not recomend to remove the files</em> from the space, due to wasting space by doing this (learn more about SquashFS!). Otherwise you&#039;re able to remove httpd by typing
</p>
<pre class="code">opkg --force-depends remove uhttpd</pre>

<p>
Now configure lighttpd, to be able to use luci again.
</p>

<p>
Edit the config-file /etc/lighttpd/lighttpd.conf
</p>

<p>
Uncomment the mod_cgi:
</p>
<pre class="code">server.modules = (
        &quot;mod_cgi&quot;
)</pre>

<p>
see errors on syslog:
</p>
<pre class="code">server.error-log-use-syslog = &quot;enable&quot;</pre>

<p>
assign luci to lua
</p>
<pre class="code">cgi.assign = ( &quot;luci&quot; =&gt; &quot;/usr/bin/lua&quot; )</pre>

<p>
At this point it&#039;s possible to start the server…
</p>
<pre class="code">/etc/init.d/lighttpd start
/etc/init.d/lighttpd enable</pre>

<p>
 …and access luci again. Use e.g. <a href="http://192.168.1.1:81" class="urlextern" title="http://192.168.1.1:81"  rel="nofollow">http://192.168.1.1:81</a>
</p>

</div>

<h3 class="sectionedit10" id="configure_lighttpd_for_owncloud">Configure lighttpd for OwnCloud</h3>
<div class="level3">
<pre class="code">server.modules = (
	&quot;mod_access&quot;,
	&quot;mod_cgi&quot;
)</pre>

<p>
cause, we&#039;ll move the Luci-Server to the Port 81; we need the port 80 for the OwnCloud-Server:
</p>
<pre class="code">server.port = 80</pre>

<p>
Set www-root for OwnCloud (We will add a new server for Luci later.): 
</p>
<pre class="code">server.document-root = &quot;/www/owncloud&quot;</pre>

<p>
Add these lines to secure the access to the data according to ownCloud WebServer-notes[3], beware that in this example the ownCloud-folder is our www-root
</p>
<pre class="code">$HTTP[&quot;url&quot;] =~ &quot;^/data/&quot; {
	url.access-deny = (&quot;&quot;)
}  </pre>
<pre class="code">$HTTP[&quot;url&quot;] =~ &quot;^($|/)&quot; {
	dir-listing.activate = &quot;disable&quot;
}</pre>

<p>
And append a new server for luci:
</p>
<pre class="code">$SERVER[&quot;socket&quot;] == &quot;:81&quot; {
	server.document-root = &quot;/www&quot;
	cgi.assign = (&quot;luci&quot; =&gt; &quot;/usr/bin/lua&quot;)
}</pre>

<p>
Due to this, remember to remove the line we have added before:
</p>
<pre class="code">#cgi.assign = ( &quot;luci&quot; =&gt; &quot;/usr/bin/lua&quot; )</pre>

<p>
Restart the webserver with
</p>
<pre class="code">/etc/init.d/lighttpd restart</pre>

<p>
And make sure it&#039;s enabled for next boots:
</p>
<pre class="code">/etc/init.d/lighttpd enabled</pre>

<p>
Now point your browser to <a href="http://yourhost/index.php" class="urlextern" title="http://yourhost/index.php"  rel="nofollow">http://yourhost/index.php</a> and see if this manual missed something. If so, please contact the author (see details below) or get an account for this wiki and fix the how-to yourself :)
</p>

</div>

<h2 class="sectionedit11" id="install_configure_php">Install &amp; configure PHP</h2>
<div class="level2">

<p>
Get the dirty part: php and sqlite. I am not sure if really all of these packages are necessary, but it seems so:
</p>
<pre class="code">opkg install php5 php5-cgi php5-fastcgi php5-mod-json php5-mod-session php5-mod-zip libsqlite3 zoneinfo-core php5-mod-pdo php5-mod-pdo-sqlite php5-mod-ctype php5-mod-mbstring php5-mod-gd sqlite3-cli php5-mod-sqlite3 php5-mod-curl curl php5-mod-xml php5-mod-simplexml php5-mod-hash php5-mod-dom php5-mod-iconv</pre>

<p>
Those packages are also suggested:
</p>
<pre class="code">opkg install php5-mod-mcrypt php5-mod-openssl php5-mod-fileinfo php5-mod-exif</pre>

<p>
Configure /etc/php.ini to our needs and change the doc_root to our www-root:
</p>
<pre class="code">;open_basedir=</pre>
<pre class="code">error_log = syslog</pre>
<pre class="code">doc_root =
cgi.fix_pathinfo=1</pre>
<pre class="code">memory_limit = 32M</pre>

<p>
Check that the extensions are enabled:
</p>

<p>
/etc/php5/&lt;extension&gt;.ini should contains extension=&lt;extension&gt;.ini
</p>

<p>
Play around with memory_limit, I reduced the value form 8MB to 4MB … but maybe 50MB might be better with 64MB RAM.
</p>

<p>
run php
</p>
<pre class="code">/etc/init.d/php5-fastcgi enable
/etc/init.d/php5-fastcgi start</pre>

</div>

<h3 class="sectionedit12" id="activate_php_in_lighttpdconf">activate PHP in lighttpd.conf</h3>
<div class="level3">

<p>
Uncomment to enable the fastcgi module
</p>
<pre class="code">server.modules = (
	&quot;mod_access&quot;,
	&quot;mod_fastcgi&quot;,
	&quot;mod_cgi&quot;
)</pre>

<p>
Add &quot;index.php&quot; to the list of index-file.names:
</p>
<pre class="code">index-file.names = ( &quot;index.php&quot;, &quot;index.html&quot;, &quot;default.html&quot;, &quot;index.htm&quot;, &quot;default.htm&quot; )</pre>
<pre class="code">static-file.exclude-extensions = (&quot;.php, &quot;.pl&quot;, &quot;.fcgi&quot;)</pre>

<p>
Include php by using fast-cgi (gample against max-procs for performance):
</p>
<pre class="code">fastcgi.server = (
	&quot;.php&quot; =&gt; ((
		&quot;bin-path&quot; =&gt; &quot;/usr/bin/php-fcgi&quot;,
		&quot;socket&quot; =&gt; &quot;/tmp/php.socket&quot;,
		&quot;max-procs&quot; =&gt; 1
	))
)</pre>

<p>
Only if you are using normal cgi mode for PHP, you&#039;ll need the following line
</p>
<pre class="code">cgi.assign = (&quot;.php&quot; =&gt; &quot;/usr/bin/php-cgi&quot;)</pre>

<p>
Restart the webserver with
</p>
<pre class="code">/etc/init.d/lighttpd restart</pre>

<p>
Now point your browser to <a href="http://yourhost/index.php" class="urlextern" title="http://yourhost/index.php"  rel="nofollow">http://yourhost/index.php</a> (first create a helpful content to this file) and see if this manual missed something. If so, please contact the author (see details below) or get an account for this wiki and fix the how-to yourself.
</p>

</div>

<h2 class="sectionedit13" id="get_ssl_optional">Get SSL (optional)</h2>
<div class="level2">

<p>
Probably you want to run lighttpd with SSL/https to get your traffic crypted. These instructions are taken from [4]. For generating a key you need to install libopenssl and the openssl-utils
</p>
<pre class="code">opkg install libopenssl openssl-utils</pre>

<p>
(or openssl-util without the &#039;s?)
</p>

<p>
Now you can create a folder for your key like this
</p>
<pre class="code">mkdir /etc/lighttpd/ssl/YOURDOMAIN -p</pre>

<p>
Within that you can create your key with the following command. You will be asked to provide some information for the certificate.
</p>
<pre class="code">openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes</pre>

<p>
Make the file only accessable to root
</p>
<pre class="code">chmod 0600 /etc/lighttpd/ssl/YOURDOMAIN
chmod 0600 /etc/lighttpd/ssl/YOURDOMAIN/server.pem</pre>

<p>
Now we can uncomment the lines for SSL in lighttp.conf and modify the path to the server.pem:
</p>
<pre class="code">ssl.engine = &quot;enable&quot;                             
ssl.pemfile = &quot;/etc/lighttpd/ssl/YOURDOMAIN/server.pem&quot;</pre>

<p>
Restart the webserver afterwards - don&#039;t wonder if it isn&#039;t anymore reachable via http:
</p>
<pre class="code">/etc/init.d/lighttpd restart</pre>

</div>

<h2 class="sectionedit14" id="unleash_owncloud">unleash OwnCloud</h2>
<div class="level2">

<p>
Download and unpack the newest revision:
</p>
<div class="table sectionedit15"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code>cd /tmp
wget <a href="http://mirrors.owncloud.org/release/ownclound-X.X.X.tar.bz2" class="urlextern" title="http://mirrors.owncloud.org/release/ownclound-X.X.X.tar.bz2"  rel="nofollow">http://mirrors.owncloud.org/release/ownclound-X.X.X.tar.bz2</a>
opkg update
opkg install tar
cd /www
tar -xjf /tmp/owncloud-X.X.X.tar.bz2
</code> </td>
	</tr>
</table></div>

<p>
Now you should cleanup:
</p>
<div class="table sectionedit16"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code>rm /tmp/owncloud-X.X.X.tar.bz2
opkg remove –autoremove tar
</code> </td>
	</tr>
</table></div>

<p>
You have to configure the rights of the /www/owncloud in addition.
</p>
<div class="table sectionedit17"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code>chown -R root:root /www/owncloud
chmod 770 -R /mnt/sda1/owncloud/data
</code> </td>
	</tr>
</table></div>
<div class="table sectionedit18"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code>cd /mnt/sda1
mkdir owncloud
cd owncloud
mkdir data
chown -R root:root /mnt/sda1/owncloud
chmod 770 -R /mnt/sda1/owncloud
</code> </td>
	</tr>
</table></div>

<p>
Open your Website <a href="http://192.168.1.1/" class="urlextern" title="http://192.168.1.1/"  rel="nofollow">http://192.168.1.1/</a> and configure your first steps, then wait for a loooonnnnngggg time and you&#039;ll see the result.
</p>

</div>

<h2 class="sectionedit19" id="the_easiest_way_to_install_owncloud">The easiest way to install owncloud</h2>
<div class="level2">

<p>
Format your USB drive as ext3 or ext4 and plug it into your Openwrt router
</p>

<p>
download the script from gizfun.com, run it and you are good to go
</p>

<p>
<code>wget <a href="http://www.gizfun.com/dl/web_for_openwrt.sh" class="urlextern" title="http://www.gizfun.com/dl/web_for_openwrt.sh"  rel="nofollow">http://www.gizfun.com/dl/web_for_openwrt.sh</a></code> #This link does not available now.
</p>

<p>
<code>sh web_for_openwrt.sh</code>
</p>

<p>
The script will download, install and configure all necessary web server components automatically. All software will be installed onto the external USB storage.
</p>

</div>

<h2 class="sectionedit20" id="owncloud_on_alternative_destination">Owncloud on alternative destination</h2>
<div class="level2">

<p>
If you don&#039;t want to set up a extroot, you can install owncloud on a different location (<a href="../techref/opkg#mount.point" class="urlextern" title="http://wiki.openwrt.org/doc/techref/opkg#mount.point"  rel="nofollow">http://wiki.openwrt.org/doc/techref/opkg#mount.point</a>)
</p>

<p>
Install php on another location, then
</p>
<div class="table sectionedit21"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code>ln -s /opt/etc/php.ini /etc/php.ini
ln -s /opt/etc/php5 /etc/php5
</code> </td>
	</tr>
</table></div>

<p>
If you still get errors related timezones and calls to undefined functions:
</p>
<div class="table sectionedit22"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code>opkg -dest usb install zoneinfo-core zoneinfo-[your region]
ln -s /opt/usr/lib/php /usr/lib/php
ln -s /opt/usr/share/zoneinfo/ /usr/share/zoneinfo/
</code> </td>
	</tr>
</table></div>

<p>
TODO
</p>

</div>

<h2 class="sectionedit23" id="known_bugs">Known bugs</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Even if php5-mod-xml (and php5-mod-simplexml, -xmlreader and -xmlwriter) are installed, ownCloud lists php-xml as a missing dependency. Anyone an idea?</div>
</li>
<li class="level1"><div class="li"> It can be fixed by selecting php5-mod-xml when you make php5. If you don&#039;t, libxml will not be loaded, even if phh5-mod-xml is installed later. </div>
</li>
</ul>

</div>

<h2 class="sectionedit24" id="written_by">Written by</h2>
<div class="level2">

<p>
Page was initiated by wetterfrosch
</p>
<ul>
<li class="level1"><div class="li"> Mail: wetter_ät_netzpolitik.org</div>
</li>
<li class="level1"><div class="li"> Jabber: wetterfrosch_ät_jabber.berlin.ccc.de</div>
</li>
<li class="level1"><div class="li"> Diaspora: wetter_ät_diaspora.subsignal.org</div>
</li>
<li class="level1"><div class="li"> Twitter: @wetterfrosch</div>
</li>
</ul>

<p>
but a lot of modifications are done by others…
</p>

</div>

<h2 class="sectionedit25" id="resources">Resources</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> [0] <a href="http://downloads.openwrt.org/snapshots/trunk/" class="urlextern" title="http://downloads.openwrt.org/snapshots/trunk/"  rel="nofollow">http://downloads.openwrt.org/snapshots/trunk/</a></div>
</li>
<li class="level1"><div class="li"> [1] <a href="usb.essentials" class="urlextern" title="http://wiki.openwrt.org/doc/howto/usb.essentials"  rel="nofollow">http://wiki.openwrt.org/doc/howto/usb.essentials</a></div>
</li>
<li class="level1"><div class="li"> [2] <a href="usb.storage" class="urlextern" title="http://wiki.openwrt.org/doc/howto/usb.storage"  rel="nofollow">http://wiki.openwrt.org/doc/howto/usb.storage</a></div>
</li>
<li class="level1"><div class="li"> [3] <a href="http://owncloud.org/support/webserver-notes/" class="urlextern" title="http://owncloud.org/support/webserver-notes/"  rel="nofollow">http://owncloud.org/support/webserver-notes/</a> </div>
</li>
<li class="level1"><div class="li"> [4] <a href="http://www.cyberciti.biz/tips/howto-lighttpd-create-self-signed-ssl-certificates.html" class="urlextern" title="http://www.cyberciti.biz/tips/howto-lighttpd-create-self-signed-ssl-certificates.html"  rel="nofollow">http://www.cyberciti.biz/tips/howto-lighttpd-create-self-signed-ssl-certificates.html</a></div>
</li>
<li class="level1"><div class="li"> [5] <a href="http://www.gizfun.com/content/install-owncloud-your-openwrt-router-3-steps" class="urlextern" title="http://www.gizfun.com/content/install-owncloud-your-openwrt-router-3-steps"  rel="nofollow">http://www.gizfun.com/content/install-owncloud-your-openwrt-router-3-steps</a></div>
</li>
</ul>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>doc/howto/owncloud.txt</bdi> · Last modified: 2015/02/13 02:06 by <bdi>xl</bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="owncloud?do=edit"  class="action source" accesskey="v" rel="nofollow" title="Show pagesource [V]"><span>Show pagesource</span></a></li><li><a href="owncloud?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="owncloud?do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="owncloud#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license" class="urlextern">CC Attribution-Noncommercial-Share Alike 3.0 Unported</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license"><img src="../../lib/images/license/button/cc-by-nc-sa.png" alt="CC Attribution-Noncommercial-Share Alike 3.0 Unported" /></a>        <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/openwrt/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://www.php.net" title="Powered by PHP" ><img
            src="../../lib/tpl/openwrt/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/openwrt/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../../lib/tpl/openwrt/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/openwrt/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="../../lib/exe/indexer.php?id=doc%253Ahowto%253Aowncloud&amp;1432267152" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</body>
</html>
