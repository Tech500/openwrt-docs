<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>OpenWrt Debricking Guide [OpenWrt Wiki]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="doc,howto,generic.debrick"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="OpenWrt Wiki"/>
<link rel="start" href="../../index.html"/>
<link rel="contents" href="generic.debrick?do=index" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Recent changes" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="../../feed.php?mode=list&amp;ns=doc:howto"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/doc/howto/generic.debrick"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../../_export/raw/doc/howto/generic.debrick"/>
<link rel="canonical" href="generic.debrick"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php?t=openwrt&amp;tseed=6f44f363dc87908d905dc56ff3acbfc4"/>
<script type="text/javascript">/*<![CDATA[*/var NS='doc:howto';var JSINFO = {"id":"doc:howto:generic.debrick","namespace":"doc:howto"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php?tseed=6f44f363dc87908d905dc56ff3acbfc4"></script>
<script type="text/javascript" charset="utf-8">/*<![CDATA[*/jQuery(function(){
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1432265437 166.182.3.25';
			document.forms[i].appendChild(myElement);
		}
	}
});
/*!]]>*/</script>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../../lib/tpl/openwrt/images/favicon.ico" />
<link rel="apple-touch-icon" href="../../lib/tpl/openwrt/images/apple-touch-icon.png" />
    </head>

<body>
    <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_openwrt     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="generic.debrick#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="../../start"  accesskey="h" title="[H]"><img src="../../lib/tpl/openwrt/images/logo.png" width="386" height="98" alt="" /> <span>OpenWrt Wiki</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="generic.debrick?do=register"  class="action register" rel="nofollow" title="Register">Register</a></li><li><a href="generic.debrick?do=login&amp;sectok=382740b13d95f946eed36caa57076b4a"  class="action login" rel="nofollow" title="Login">Login</a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="../../start" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="../../doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="doc:howto:generic.debrick" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Show pagesource</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Login</option><option value="register">Register</option></optgroup></select><input type="submit" value="&gt;" /></div></form>            </div>
            <ul>
                <li><a href="generic.debrick?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a></li><li><a href="generic.debrick?do=media&amp;ns=doc%253Ahowto"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a></li><li><a href="generic.debrick?do=index"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                            <div class="youarehere"><span class="bchead">You are here: </span><span class="home"><bdi><a href="../../start" class="wikilink1" title="start">OpenWrt Wiki</a></bdi></span> » <bdi><a href="../start" class="wikilink1" title="doc:start">Documentation</a></bdi> » <bdi><a href="start" class="wikilink1" title="doc:howto:start">HOWTOs</a></bdi> » <bdi><span class="curid"><a href="generic.debrick" class="wikilink1" title="doc:howto:generic.debrick">OpenWrt Debricking Guide</a></span></bdi></div>
                                    <div class="plugin_multilingual">
        <ul>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/cz/doc/howto/generic.debrick" class="media" title="cz:doc:howto:generic.debrick"><img src="../../lib/exe/fetch.php?cache=&amp;tok=aff589&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fcz.gif" class="media" title="Čeština (Czech)" alt="Čeština (Czech)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <a href="../../de/doc/howto/generic.debrick" class="media" title="de:doc:howto:generic.debrick"><img src="../../lib/exe/fetch.php?cache=&amp;tok=e24010&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fde.gif" class="media" title="Deutsch (German)" alt="Deutsch (German)" /></a>
            </div>
          </li>
          <li>
            <div class="li">
              <span class="curid"><a href="generic.debrick" class="media" title="doc:howto:generic.debrick"><img src="../../lib/exe/fetch.php?cache=&amp;tok=2a37ae&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fgb.gif" class="media" title="English" alt="English" /></a></span>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/es/doc/howto/generic.debrick" class="media" title="es:doc:howto:generic.debrick"><img src="../../lib/exe/fetch.php?cache=&amp;tok=46c004&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fmx.gif" class="media" title="Español (Spanish, Mexico)" alt="Español (Spanish, Mexico)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <a href="../../fr/doc/howto/generic.debrick" class="media" title="fr:doc:howto:generic.debrick"><img src="../../lib/exe/fetch.php?cache=&amp;tok=a5beba&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ffr.gif" class="media" title="Français (French)" alt="Français (French)" /></a>
            </div>
          </li>
          <li>
            <div class="li">
              <a href="../../hu/doc/howto/generic.debrick" class="media" title="hu:doc:howto:generic.debrick"><img src="../../lib/exe/fetch.php?cache=&amp;tok=6b5470&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fhu.gif" class="media" title="Magyar (Hungarian)" alt="Magyar (Hungarian)" /></a>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/jp/doc/howto/generic.debrick" class="media" title="jp:doc:howto:generic.debrick"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f999fc&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fjp.gif" class="media" title="日本語 (Japanese)" alt="日本語 (Japanese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pl/doc/howto/generic.debrick" class="media" title="pl:doc:howto:generic.debrick"><img src="../../lib/exe/fetch.php?cache=&amp;tok=c805c0&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fpl.gif" class="media" title="Poliski (Polish)" alt="Poliski (Polish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pt-br/doc/howto/generic.debrick" class="media" title="pt-br:doc:howto:generic.debrick"><img src="../../lib/exe/fetch.php?cache=&amp;tok=13127d&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fbr.gif" class="media" title="Português brasileiro (Portuguese, Brasil)" alt="Português brasileiro (Portuguese, Brasil)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/ru/doc/howto/generic.debrick" class="media" title="ru:doc:howto:generic.debrick"><img src="../../lib/exe/fetch.php?cache=&amp;tok=66ab5e&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fru.gif" class="media" title="Русский (Russsian)" alt="Русский (Russsian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/tr/doc/howto/generic.debrick" class="media" title="tr:doc:howto:generic.debrick"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f4beed&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ftr.gif" class="media" title="Tϋrkçe (Turkish)" alt="Tϋrkçe (Turkish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <a href="../../zh-cn/doc/howto/generic.debrick" class="media" title="zh-cn:doc:howto:generic.debrick"><img src="../../lib/exe/fetch.php?cache=&amp;tok=93625a&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-cn.gif" class="media" title="官話/官话 (Chinese)" alt="官話/官话 (Chinese)" /></a>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-tw/doc/howto/generic.debrick" class="media" title="zh-tw:doc:howto:generic.debrick"><img src="../../lib/exe/fetch.php?cache=&amp;tok=b56198&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-tw.gif" class="media" title="臺灣華語 (Taiwanese)" alt="臺灣華語 (Taiwanese)" /></a>
              </div>
            </div>
          </li>
        </ul>
      </div>
        </div>
    
    
    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">

                <div class="pageId"><span>doc:howto:generic.debrick</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level2"><div class="li"><a href="generic.debrick#as_for_the_proper_ways_to_recover_a_bricked_router">As for the proper ways to recover a &quot;bricked&quot; router</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="generic.debrick#boot_wait">boot_wait</a></div></li>
<li class="level3"><div class="li"><a href="generic.debrick#jtag">JTAG</a></div></li>
<li class="level3"><div class="li"><a href="generic.debrick#serial">Serial</a></div></li>
<li class="level3"><div class="li"><a href="generic.debrick#arduino">Arduino</a></div></li>
<li class="level3"><div class="li"><a href="generic.debrick#wifi">WIFI</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="generic.debrick#leds">LEDs</a></div></li>
<li class="level1"><div class="li"><a href="generic.debrick#stupid_things_people_do">Stupid things people do</a></div></li>
<li class="level1"><div class="li"><a href="generic.debrick#by_vavasik">by Vavasik</a></div></li>
<li class="level1"><div class="li"><a href="generic.debrick#write_flash_chip_by_usb">Write flash chip by USB</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="openwrt_debricking_guide">OpenWrt Debricking Guide</h1>
<div class="level1">

<p>
When people say a router is <em>bricked</em>, this very generally means, that it does not function properly any longer and the reasons can be various. First of all, you should calm down, relax and read <a href="../techref/flash.layout" class="wikilink1" title="doc:techref:flash.layout">flash.layout</a>, <a href="../techref/filesystems#implementationinopenwrt" class="wikilink1" title="doc:techref:filesystems">file systems in OpenWrt</a> and <a href="../techref/bootloader.1#additional_functions" class="wikilink1" title="doc:techref:bootloader">bootloader CLI</a>. Now depending on what exactly is broken, you have several possibilities:
</p>
<ol>
<li class="level1"><div class="li"> if only something on the <strong><a href="../techref/filesystems#jffs2" class="wikilink1" title="doc:techref:filesystems">JFFS2</a></strong> partition is broken, you are still able to → <strong><a href="generic.failsafe" class="wikilink1" title="doc:howto:generic.failsafe">boot into OpenWrt failsafe mode</a></strong></div>
</li>
<li class="level1"><div class="li"> if the <strong><a href="../techref/filesystems#squashfs" class="wikilink1" title="doc:techref:filesystems">SquashFS</a></strong> partition or the <strong>Kernel</strong> is broken, you cannot boot into failsafe mode any longer. But you still have a functioning bootloader and so you should follow the same procedures as when you first → <strong><a href="installing#viabootloaderandethernetport" class="wikilink1" title="doc:howto:generic.flashing">installed OpenWrt via bootloader</a></strong>.</div>
</li>
<li class="level1"><div class="li"> if the <strong><a href="../techref/bootloader.1" class="wikilink1" title="doc:techref:bootloader">bootloader</a> is broken</strong>, there are only two options left:</div>
<ol>
<li class="level2"><div class="li"> access your hardware through the → <strong><a href="../hardware/port.jtag" class="wikilink1" title="doc:hardware:port.jtag">JTAG Port</a></strong>, this <em>should</em> allow you to write to the flash. Restore the bootloader.</div>
</li>
<li class="level2"><div class="li"> or desolder the flash chip, connect it to some device, that does give you write access to it and restore the bootloader. You did perform a <a href="generic.backup" class="wikilink1" title="doc:howto:generic.backup">generic.backup</a>, right?</div>
</li>
</ol>
</li>
</ol>

<p>
If you need to solder, you can find some help here:
</p>
<ul>
<li class="level1"><div class="li"> → <strong><a href="../hardware/soldering" class="wikilink1" title="doc:hardware:soldering">soldering</a></strong>, <a href="../../OpenWrtDocs/Customizing/Hardware/Serial_Console" class="wikilink1" title="doc:hardware:port.serial">Serial Port</a>, <a href="../hardware/port.jtag" class="wikilink1" title="doc:hardware:port.jtag">JTAG Port</a></div>
</li>
</ul>
<hr />
<ul>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/viewtopic.php?id=35462" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=35462"  rel="nofollow">https://forum.openwrt.org/viewtopic.php?id=35462</a></div>
</li>
</ul>

</div>

<h3 class="sectionedit2" id="as_for_the_proper_ways_to_recover_a_bricked_router">As for the proper ways to recover a &quot;bricked&quot; router</h3>
<div class="level3">

</div>

<h4 id="boot_wait">boot_wait</h4>
<div class="level4">

<p>
The single best thing you can do is have boot_wait set, meaning that all you have to do is TFTP a new firmware. At one time the reflashing instructions included a an exploit for the Linksys firmware that set the boot_wait variable; as time progressed and Linksys eventually fixed the bug (after several failed attempts) we found that people were flashing to other firmwares for the sole purpose of setting boot_wait so they could reflash to OpenWrt. We figured this was somewhat pointless and altered the instructions to indicate that you could safely reflash to OpenWrt without setting boot_wait.
</p>

</div>

<h4 id="jtag">JTAG</h4>
<div class="level4">

<p>
It&#039;s one of those amazingly useful things that allows you to recover from pretty much anything that doesn&#039;t involve a hardware failure. While the JTAG can technically be used to watch every instruction and register as the system boots, the recovery software only uses it for DMA access to the flash chip, making it somewhat a blind recovery mechanism.
</p>

<p>
The biggest mistake people seem to make with JTAG is the &quot;wipe everything and reload CFE&quot; approach; they either can&#039;t find the correct CFE version after wiping the device, or they reflash with a CFE which is incompatible with their device. You should always try to use the CFE version that came with the device rather than attempting to replace it with some random CFE you found on the internet.
</p>

<p>
Second mistake - embedded within CFE is a set of NVRAM defaults to be used if the NVRAM partition is missing. This means that in most cases you can just wipe everything but CFE and it&#039;ll happily boot, recreate NVRAM and start waiting for a firmware via TFTP. In some cases however, the defaults embedded defaults (in the CFE shipped with the device) don&#039;t match the actual hardware and CFE will fail to boot. This is why we have the warnings not to wipe NVRAM. To recover from this situation you need either the original NVRAM contents, or a version of CFE with the correct defaults.
</p>

</div>

<h4 id="serial">Serial</h4>
<div class="level4">

<p>
Serial consoles are great, there&#039;s just one problem - the routers run on 3.3v and a normal PC serial port puts out +/-12v, easily frying a router. This means that a level shifter such as a max233 is required (free samples can be obtained from Texas Instruments or Maxim), and adding the ICs and caps required is beyond the ability of most users – luckily there&#039;s a shortcut. Most cellphones are either USB or 3.3v serial, so the data cable for a 3.3v cellphone can be used to make an easy and professional looking serial console connection (e.g the DKU-5 Cable for Nokia handsets). You only need to identify and connect 4 wires (vcc, rx, tx, gnd) – and if your cable uses a pl2303 you can skip the vcc connection.
</p>

<p>
Serial console allows you to interact with the CFE command line, watch the kernel boot and console access to linux. This is probably the only way you&#039;ll every get any meaningful feedback about the device boot up.
</p>

</div>

<h5 id="serial_modes">Serial modes</h5>
<div class="level5">

<p>
Some <a href="../../OpenWrtDocs/Customizing/Hardware/Serial_Console#serialmodes" class="wikilink1" title="doc:hardware:port.serial"> serial modes</a> allow you to upload a binary directly to ram or to the flash memory from the serial connection, allowing you to repair a broken bootloader
</p>

</div>

<h4 id="arduino">Arduino</h4>
<div class="level4">

<p>
If you have an Arduino board you can upload a sketch that will send the debrick commands via serial. An example that works for the TP-WR703N is available here: <a href="https://forum.openwrt.org/viewtopic.php?pid=191463" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?pid=191463"  rel="nofollow">https://forum.openwrt.org/viewtopic.php?pid=191463</a>. Note that the commands for your router could be different!
</p>

</div>

<h4 id="wifi">WIFI</h4>
<div class="level4">

<p>
If by chance the lan bridge is not working after flashing and the router is inaccessible, it might be worth a shot to use the serial instructions to add a serial port and configure Wifi. If ssh connection via Wifi is working a newer/bugfixed/stable image can be copied via scp and then installed via sysupgrade command.
</p>

</div>

<h2 class="sectionedit3" id="leds">LEDs</h2>
<div class="level2">

<p>
Most people assume the LEDs on the front are deterministic, and that by telling you which LEDs are lit you can instantly tell if the hardware is working or where it crashed in bootup. This unfortunately isn&#039;t the slightest bit true.
</p>
<ol>
<li class="level1"><div class="li"> Power LED. The biggest mistake people make here is &quot;my power led is blinking, what does that mean?&quot;. There&#039;s an assumption that if the LED is blinking there must be software turning the LED on and off, and that it must mean something. The blinking is actually done in hardware; software only as the ability to set the LED &quot;on&quot; or &quot;blink&quot; – it defaults to blink on power up and isn&#039;t set to on until after the firmware boots. If the led is on then you know the firmware booted; blinking really doesn&#039;t tell you much.</div>
</li>
<li class="level1"><div class="li"> Switch LEDs. The second common mistake is &quot;the switch still works&quot;. Of course the switch still works, it&#039;s a separate piece of hardware and the LEDs are wired directly to it. The only useful bit of information you can get is &quot;all the switch LEDs are lit&quot;. When the switch chip is reset, all of the ports will light up (even if no devices are connected) for about a second; this happens at power up and again as the firmware boots and reprograms the switch. If they stay lit, you&#039;re either a moron for not noticing the ports are actually in use, or someone has broken/shorted the switch chip. You can also notice reboot loops by watching for the switch reset.</div>
</li>
<li class="level1"><div class="li"> Diag/DMZ LED. Controlled by OpenWrt (diag module) to indicate bootup.</div>
</li>
<li class="level1"><div class="li"> Wifi. Controlled by the wifi driver; trivia - the wifi driver can also reset the power led in certain situations.</div>
</li>
</ol>

</div>

<h2 class="sectionedit4" id="stupid_things_people_do">Stupid things people do</h2>
<div class="level2">

<p>
Pin shorting
</p>

<p>
In the past we used to suggest that people shorted a few pins of the flash; when CFE booted and attempted to perform the CRC32 there would be a flash read error which would change the outcome of the CRC and the resulting failure would force CFE into recovery mode. It&#039;s a great trick, but over the years we&#039;ve learned that people are idiots and will take that as an invitation to poke mangle and short just about every pin on the device based on some irrational belief that if they find the right pin everything will magically work again. You do not want someone paranoid at the thought of breaking the device scraping up every single electrical connection on the device – it never ends well, and generally results in the flash chip or the router being damaged in the process.
</p>

<p>
- frying a chip (worst case)
- lifting/breaking electrical connections
- permanently shorting (best case)
</p>

<p>
The best case is that they simply bent a pin and you can easily bend it back - providing you can find it.
</p>

<p>
Depending on which pins are shorted/broken, it may be possible to access CFE but not to access the rest of the flash. Meaning CFE boots fine but can&#039;t read or write the firmware. This can be confirmed by JTAG.
</p>

<p>
Wrong CFE version -
Loading the wrong CFE version can also lead to devices which boot into CFE but are unable to write to the flash, or are unable to initialize the networking.
</p>

<p>
And yes, there are actually a few obscure versions that require the firmware to be named &quot;code.bin&quot; or a specific port to be used. Unfortunately nobody can remember exactly which devices, leading to all sorts of superstition.
</p>

<p>
This article is based on: <a href="https://forum.openwrt.org/viewtopic.php?id=11304" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=11304"  rel="nofollow">https://forum.openwrt.org/viewtopic.php?id=11304</a>
</p>
<hr />
<ul>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/viewtopic.php?pid=128790#p128790" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?pid=128790#p128790"  rel="nofollow">https://forum.openwrt.org/viewtopic.php?pid=128790#p128790</a></div>
</li>
</ul>

</div>

<h2 class="sectionedit5" id="by_vavasik">by Vavasik</h2>
<div class="level2">

<p>
In this case, someone manage to wipe out the <a href="../techref/bootloader.1" class="wikilink1" title="doc:techref:bootloader">Bootloader</a> of his <a href="../../toh/d-link/dir-825" class="wikilink1" title="toh:d-link:dir-825">D-Link DIR-825</a>.
</p>

<p>
The full originals by vavasik can be found at:
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://translate.google.de/translate?hl=de&amp;ie=UTF-8&amp;sl=auto&amp;tl=en&amp;u=http://webcache.googleusercontent.com/search%3Fq%3Dcache:wZfxY3lVVfQJ:forum.ixbt.com/topic.cgi%253Fid%253D14:49819%2Bhttp://forum.ixbt.com/topic.cgi%253Fid%253D14:49819%26cd%3D1%26hl%3Den%26ct%3Dclnk%26source%3Dwww.google.com&amp;prev=_t" class="urlextern" title="http://translate.google.de/translate?hl=de&amp;ie=UTF-8&amp;sl=auto&amp;tl=en&amp;u=http://webcache.googleusercontent.com/search%3Fq%3Dcache:wZfxY3lVVfQJ:forum.ixbt.com/topic.cgi%253Fid%253D14:49819%2Bhttp://forum.ixbt.com/topic.cgi%253Fid%253D14:49819%26cd%3D1%26hl%3Den%26ct%3Dclnk%26source%3Dwww.google.com&amp;prev=_t"  rel="nofollow">http://translate.google.de/translate?hl=de&amp;ie=UTF-8&amp;sl=auto&amp;tl=en&amp;u=http://webcache.googleusercontent.com/search%3Fq%3Dcache:wZfxY3lVVfQJ:forum.ixbt.com/topic.cgi%253Fid%253D14:49819%2Bhttp://forum.ixbt.com/topic.cgi%253Fid%253D14:49819%26cd%3D1%26hl%3Den%26ct%3Dclnk%26source%3Dwww.google.com&amp;prev=_t</a></div>
</li>
</ul>
<ol>
<li class="level1"><div class="li"> Open the Router’s case</div>
</li>
<li class="level1"><div class="li"> Find an IC SPI Flash SPANSION S25FL064A (Package SO3 016 wide), it is located on the backside of the router PCB.</div>
<ol>
<li class="level2"><div class="li"> There are some variations regarding the IC used by D-LINK. In my particular case, the IC is from a different player. It is a ST Microelectronics chip labeled 5P64V6P 7B469 VS, but the pin outs are exactly the same.</div>
</li>
</ol>
</li>
<li class="level1"><div class="li"> To record to flash chip it is necessary to build a simple cable that is connected in one side, to PARALEL PORT of your computer, and on other side you have to SOLDERING THE WIRES DIRECTLY INTO IC PINS.</div>
</li>
</ol>

<p>
<pre class="code">DB25 # PIN---------------RESISTOR---------------FLASH IC # PIN

7 ----------------------------[150Ω] ----------------------------- 7
10 ---------------------------[150Ω]------------------------------ 8
8 ----------------------------[150Ω]----------------------------- 16
9 ----------------------------[150Ω]----------------------------- 15
18 ---------------------------------------------------------------- 10 GND (or &quot;GND&quot; on JTAG pads)

|----------- {recommended cable length = 120 mm} ------------|</pre>

</p>

<p>
It is also necessary to provide some external power supply (during the flashing process the router’s power adapter connector should be NOT INSERTED). So, in my case I decided to use a simple 3 x AAA 1.2 Volt NiMH battery holder that I assembled together with the cable itself.
</p>

<p>
Since the batteries are placed in a serial arrange, the final voltage of the set is 3.6 Volt.
</p>

<p>
<pre class="code">FLASH IC # PIN--------------------BATTERY ARRAY--------------------FLASH IC # PIN

10 ----------------[ - 1.2 Volt +]----[ - 1.2 Volt +]----[ - 1.2 Volt +]--------------- 2</pre>

</p>
<ol>
<li class="level1"><div class="li"> 4 It is not necessary but it could prove useful, to be capable to follow the boot process through serial console. In order to achieve that it is recommended to install some connections pins into the empty board holes related to JP1 connector. You can use the pins from old computer parts.</div>
</li>
</ol>

<p>
<pre class="code">DIR 825 SERIAL PINOUTS (connector JP1) is:

PIN 1 -&gt; 3.3V (Pin 1 is the one close to a small switch and a LED indicator)
PIN 2 -&gt; RX
PIN 3 -&gt; TX
PIN 4 -&gt; GND</pre>

</p>
<ol>
<li class="level1"><div class="li"> &lt;5&gt; Use a TTL to RS-232 cable to connect to serial console. A good, easy and cheap option is to buy a USB to Phone cable like the model CA-42. Here in Brazil this cable can be found for about US$ 3.00.</div>
</li>
</ol>

<p>
Since you have the cable all you have to do is to cut off the Phone connector side and to identify the GROUND; TX and RX wires. It is quite easy and the web is plenty of guides that teach how to do that.
</p>

<p>
Use a terminal emulator software (I like PuTTY) configured as follow:
</p>

<p>
Speed (baud) 115200
Data Bits 8
Stop Bits 1
Parity None
Flow Control XON / XOFF
</p>
<ul>
<li class="level1"><div class="li"> 6 Now that the LPT ADAPTER is done and its wires are soldering to the chip, you have to connect the other side to LPT interface of your computer and also to connect the 3,6V external battery array. You must see the light of some LEDs on board.</div>
</li>
<li class="level1"><div class="li"> 7 So, if everything is done properly, download the software SPIPGMW at the following address: <a href="http://rayer.ic.cz/programm/programm.htm#SPIPGM" class="urlextern" title="http://rayer.ic.cz/programm/programm.htm#SPIPGM"  rel="nofollow">http://rayer.ic.cz/programm/programm.htm#SPIPGM</a> Run it in a DOS session. It is good use the key “i” in order to check if the chip is correctly identified.</div>
</li>
</ul>

<p>
SPIPGMW.EXE /i
</p>

<p>
Program should show:
<pre class="code">SPI connected to LPT port at I / O base address: 378h, SCK pulse width: t 0us FlashROM JEDEC ID, type: 010216h Spansion S25FL064A (8MB)</pre>

</p>

<p>
In my particular case, the software shows the ST Microelectronics chip id. If you see “unknown chip” there is a problem with LPT cable connection, check connections and try again!
</p>
<ul>
<li class="level1"><div class="li">  8 - Download and save the appropriated image toDIR-825.</div>
</li>
<li class="level1"><div class="li">  9 - Before flashing the image it is necessary to allow recording in chip with the key “u” SPIPGMW.EXE /u</div>
</li>
<li class="level1"><div class="li"> 10 – Prior to recording it is good to make a cleanup. Erase chip with the key “e” SPIPGMW.EXE /e</div>
</li>
<li class="level1"><div class="li"> 11 – Now it is time to program chip with key “p”  SPIPGMW.EXE /p file_name</div>
</li>
<li class="level1"><div class="li"> 12 - Dump chip content to a file with key file “d”  SPIPGMW.EXE /d filename_1</div>
</li>
<li class="level1"><div class="li"> 13 - Check the success of recording operation by comparing recorded file and recently dumped file fc / b filename_1 filename_2. Files must have exactly the same content.</div>
</li>
<li class="level1"><div class="li"> 14 - Disconnect LPT cable and external power supply, try to boot. Look at the serial console terminal program and follow the boot process. Luckily everything will work fine.</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> <a href="http://img189.imageshack.us/img189/134/recoveringadir825flashc.jpg" class="urlextern" title="http://img189.imageshack.us/img189/134/recoveringadir825flashc.jpg"  rel="nofollow">http://img189.imageshack.us/img189/134/recoveringadir825flashc.jpg</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://img251.imageshack.us/img251/134/recoveringadir825flashc.jpg" class="urlextern" title="http://img251.imageshack.us/img251/134/recoveringadir825flashc.jpg"  rel="nofollow">http://img251.imageshack.us/img251/134/recoveringadir825flashc.jpg</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://img833.imageshack.us/img833/134/recoveringadir825flashc.jpg" class="urlextern" title="http://img833.imageshack.us/img833/134/recoveringadir825flashc.jpg"  rel="nofollow">http://img833.imageshack.us/img833/134/recoveringadir825flashc.jpg</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://img708.imageshack.us/img708/134/recoveringadir825flashc.jpg" class="urlextern" title="http://img708.imageshack.us/img708/134/recoveringadir825flashc.jpg"  rel="nofollow">http://img708.imageshack.us/img708/134/recoveringadir825flashc.jpg</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://img267.imageshack.us/img267/134/recoveringadir825flashc.jpg" class="urlextern" title="http://img267.imageshack.us/img267/134/recoveringadir825flashc.jpg"  rel="nofollow">http://img267.imageshack.us/img267/134/recoveringadir825flashc.jpg</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://img267.imageshack.us/img267/8935/recoveringadir825flashco.jpg" class="urlextern" title="http://img267.imageshack.us/img267/8935/recoveringadir825flashco.jpg"  rel="nofollow">http://img267.imageshack.us/img267/8935/recoveringadir825flashco.jpg</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://img209.imageshack.us/img209/134/recoveringadir825flashc.jpg" class="urlextern" title="http://img209.imageshack.us/img209/134/recoveringadir825flashc.jpg"  rel="nofollow">http://img209.imageshack.us/img209/134/recoveringadir825flashc.jpg</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://img513.imageshack.us/img513/134/recoveringadir825flashc.jpg" class="urlextern" title="http://img513.imageshack.us/img513/134/recoveringadir825flashc.jpg"  rel="nofollow">http://img513.imageshack.us/img513/134/recoveringadir825flashc.jpg</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://img171.imageshack.us/img171/134/recoveringadir825flashc.jpg" class="urlextern" title="http://img171.imageshack.us/img171/134/recoveringadir825flashc.jpg"  rel="nofollow">http://img171.imageshack.us/img171/134/recoveringadir825flashc.jpg</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://img403.imageshack.us/img403/134/recoveringadir825flashc.jpg" class="urlextern" title="http://img403.imageshack.us/img403/134/recoveringadir825flashc.jpg"  rel="nofollow">http://img403.imageshack.us/img403/134/recoveringadir825flashc.jpg</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://img593.imageshack.us/img593/134/recoveringadir825flashc.jpg" class="urlextern" title="http://img593.imageshack.us/img593/134/recoveringadir825flashc.jpg"  rel="nofollow">http://img593.imageshack.us/img593/134/recoveringadir825flashc.jpg</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://img522.imageshack.us/img522/134/recoveringadir825flashc.jpg" class="urlextern" title="http://img522.imageshack.us/img522/134/recoveringadir825flashc.jpg"  rel="nofollow">http://img522.imageshack.us/img522/134/recoveringadir825flashc.jpg</a></div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> <a href="http://rayer.ic.cz/elektro/spipgm.htm" class="urlextern" title="http://rayer.ic.cz/elektro/spipgm.htm"  rel="nofollow">http://rayer.ic.cz/elektro/spipgm.htm</a> RayeR&#039;s homepage/Programmer SPI FlashROM for parallel port</div>
</li>
<li class="level1"><div class="li"> <a href="http://rayer.ic.cz/programm/programe.htm#SPIPGM" class="urlextern" title="http://rayer.ic.cz/programm/programe.htm#SPIPGM"  rel="nofollow">http://rayer.ic.cz/programm/programe.htm#SPIPGM</a> RayeR&#039;s homepage/Programming - SPIPGM.ZIP ver. 1.8 [79 kB] :</div>
</li>
</ul>
<div class="table sectionedit6"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0">SPI FlashROM supported</th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> ST Microelectronic: </td>
	</tr>
	<tr class="row2">
		<td class="col0"> M25P10 (128kB) </td>
	</tr>
	<tr class="row3">
		<td class="col0"> M25P20 (256kB)</td>
	</tr>
	<tr class="row4">
		<td class="col0"> M25P40 (512kB)</td>
	</tr>
	<tr class="row5">
		<td class="col0"> M25P80 (1MB)</td>
	</tr>
	<tr class="row6">
		<td class="col0"> M25P16 (2MB)</td>
	</tr>
	<tr class="row7">
		<td class="col0"> M25P32 (4MB)</td>
	</tr>
	<tr class="row8">
		<td class="col0"> M25P64 (8MB)</td>
	</tr>
	<tr class="row9">
		<td class="col0"> M25P128 (16MB)</td>
	</tr>
</table></div>
<ul>
<li class="level1"><div class="li"> <a href="http://richard-burke.dyndns.org/wordpress/2009/02/programming-an-asus-p5b-bios" class="urlextern" title="http://richard-burke.dyndns.org/wordpress/2009/02/programming-an-asus-p5b-bios"  rel="nofollow">Programming an ASUS P5B BIOS | Adventures in Home Computing</a></div>
</li>
</ul>

</div>

<h2 class="sectionedit7" id="write_flash_chip_by_usb">Write flash chip by USB</h2>
<div class="level2">

<p>
This is the probably easiest way to &quot;burn&quot; a flash chip: It is a cheap (cable ~20 EUR), universal (USB) and multiplatform (many <abbr title="Operating System">OS</abbr>) solution. Buy a FTDI cable C232HM-DDHSL-0 (in case of 3.3 Volts), connect the wires to the flash chip as shown below and write the data with <a href="http://flashrom.org/" class="urlextern" title="http://flashrom.org/"  rel="nofollow">flashrom</a>.
</p>

<p>
<pre class="code">C232HM-DDHSL-0       SPI-Flash SOP8
     1 red    ------ 8 Vcc
     2 orange ------ 6 SCLK
     3 yellow ------ 5 SI
     4 green  ------ 2 SO
     5 brown  ------ 1 /CS
     6 grey   ------ 3 /WP (with 4k7 Pullup)
     7 purple ------ 7 /HOLD (with 4k7 Pullup)
    10 black  ------ 4 Gnd</pre>

</p>

<p>
Write command:
</p>

<p>
<pre class="code"># time ./flashrom -p ft2232_spi:type=232H -c MX25L6406E/MX25L6436E -w ../../dump.mtd 2&gt;&amp;1 |tee log
flashrom v0.9.7-r1711 on Darwin 8.11.0 (Power Macintosh)
flashrom is free software, get the source code at http://www.flashrom.org

Calibrating delay loop... OK.
Found Macronix flash chip &quot;MX25L6406E/MX25L6436E&quot; (8192 kB, SPI) on ft2232_spi.
Reading old flash chip contents... done.
Erasing and writing flash chip... Erase/write done.
Verifying flash... VERIFIED.

real    7m1.731s
user    0m12.288s
sys     0m22.984s</pre>

</p>

<p>
The example shows burning of a MX25L6406 for the <a href="../../toh/alfa.network/ap121" class="wikilink1" title="toh:alfa.network:ap121">Alfa AP121</a>. (No, I didn&#039;t brick it. <img src="../../lib/images/smileys/icon_wink.gif" class="icon" alt=";-)" /> I just wanted to replace a 4MB Flash with 8 <abbr title="Megabyte">MB</abbr> flash.)
</p>

<p>
Warning: If you use a FTDI cable for <a href="../../OpenWrtDocs/Customizing/Hardware/Serial_Console#prebuiltcables" class="wikilink1" title="doc:hardware:port.serial">serial console</a> then you probably must disable the FTDI serial port driver or exclude the product ID 0x6014 for the FT232H chip in the serial driver. Patch for MacOS:
</p>

<p>
<pre class="code">--- tmp/FTDIUSBSerialDriver.kext/Contents/Info.plist    2012-08-08 14:01:40.000000000 +0200
+++ /System/Library/Extensions/FTDIUSBSerialDriver.kext/Contents/Info.plist     2013-11-17 10:48:54.000000000 +0100
@@ -2014,25 +2014,6 @@
                        &lt;key&gt;idVendor&lt;/key&gt;
                        &lt;integer&gt;1027&lt;/integer&gt;
                &lt;/dict&gt;
-               &lt;key&gt;FT232H&lt;/key&gt;
-               &lt;dict&gt;
-                       &lt;key&gt;CFBundleIdentifier&lt;/key&gt;
-                       &lt;string&gt;com.FTDI.driver.FTDIUSBSerialDriver&lt;/string&gt;
-                       &lt;key&gt;IOClass&lt;/key&gt;
-                       &lt;string&gt;FTDIUSBSerialDriver&lt;/string&gt;
-                       &lt;key&gt;IOProviderClass&lt;/key&gt;
-                       &lt;string&gt;IOUSBInterface&lt;/string&gt;
-                       &lt;key&gt;bConfigurationValue&lt;/key&gt;
-                       &lt;integer&gt;1&lt;/integer&gt;
-                       &lt;key&gt;bInterfaceNumber&lt;/key&gt;
-                       &lt;integer&gt;0&lt;/integer&gt;
-                       &lt;key&gt;bcdDevice&lt;/key&gt;
-                       &lt;integer&gt;2304&lt;/integer&gt;
-                       &lt;key&gt;idProduct&lt;/key&gt;
-                       &lt;integer&gt;24596&lt;/integer&gt;
-                       &lt;key&gt;idVendor&lt;/key&gt;
-                       &lt;integer&gt;1027&lt;/integer&gt;
-               &lt;/dict&gt;
                &lt;key&gt;FT4232H_A&lt;/key&gt;
                &lt;dict&gt;
                        &lt;key&gt;CFBundleIdentifier&lt;/key&gt;</pre>

</p>

<p>
<em>(Note: To get flashrom work on an old MacOS 10.4 PPC system as shown above you&#039;ll have to make some mods to flashrom.)</em>
</p>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>doc/howto/generic.debrick.txt</bdi> · Last modified: 2015/04/26 08:42 by <bdi>theoradicus</bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="generic.debrick?do=edit"  class="action source" accesskey="v" rel="nofollow" title="Show pagesource [V]"><span>Show pagesource</span></a></li><li><a href="generic.debrick?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="generic.debrick?do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="generic.debrick#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license" class="urlextern">CC Attribution-Noncommercial-Share Alike 3.0 Unported</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license"><img src="../../lib/images/license/button/cc-by-nc-sa.png" alt="CC Attribution-Noncommercial-Share Alike 3.0 Unported" /></a>        <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/openwrt/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://www.php.net" title="Powered by PHP" ><img
            src="../../lib/tpl/openwrt/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/openwrt/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../../lib/tpl/openwrt/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/openwrt/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="../../lib/exe/indexer.php?id=doc%253Ahowto%253Ageneric.debrick&amp;1432265437" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</body>
</html>
