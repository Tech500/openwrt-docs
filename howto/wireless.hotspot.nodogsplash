<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>Nodogsplash [OpenWrt Wiki]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="doc,howto,wireless.hotspot.nodogsplash"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="OpenWrt Wiki"/>
<link rel="start" href="../../index.html"/>
<link rel="contents" href="wireless.hotspot.nodogsplash?do=index" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Recent changes" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="../../feed.php?mode=list&amp;ns=doc:howto"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/doc/howto/wireless.hotspot.nodogsplash"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../../_export/raw/doc/howto/wireless.hotspot.nodogsplash"/>
<link rel="canonical" href="wireless.hotspot.nodogsplash"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php?t=openwrt&amp;tseed=6f44f363dc87908d905dc56ff3acbfc4"/>
<script type="text/javascript">/*<![CDATA[*/var NS='doc:howto';var JSINFO = {"id":"doc:howto:wireless.hotspot.nodogsplash","namespace":"doc:howto"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php?tseed=6f44f363dc87908d905dc56ff3acbfc4"></script>
<script type="text/javascript" charset="utf-8">/*<![CDATA[*/jQuery(function(){
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1432267097 166.182.3.17';
			document.forms[i].appendChild(myElement);
		}
	}
});
/*!]]>*/</script>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../../lib/tpl/openwrt/images/favicon.ico" />
<link rel="apple-touch-icon" href="../../lib/tpl/openwrt/images/apple-touch-icon.png" />
    </head>

<body>
    <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_openwrt     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="wireless.hotspot.nodogsplash#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="../../start"  accesskey="h" title="[H]"><img src="../../lib/tpl/openwrt/images/logo.png" width="386" height="98" alt="" /> <span>OpenWrt Wiki</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="wireless.hotspot.nodogsplash?do=register"  class="action register" rel="nofollow" title="Register">Register</a></li><li><a href="wireless.hotspot.nodogsplash?do=login&amp;sectok=382740b13d95f946eed36caa57076b4a"  class="action login" rel="nofollow" title="Login">Login</a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="../../start" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="../../doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="doc:howto:wireless.hotspot.nodogsplash" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Show pagesource</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Login</option><option value="register">Register</option></optgroup></select><input type="submit" value="&gt;" /></div></form>            </div>
            <ul>
                <li><a href="wireless.hotspot.nodogsplash?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a></li><li><a href="wireless.hotspot.nodogsplash?do=media&amp;ns=doc%253Ahowto"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a></li><li><a href="wireless.hotspot.nodogsplash?do=index"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                            <div class="youarehere"><span class="bchead">You are here: </span><span class="home"><bdi><a href="../../start" class="wikilink1" title="start">OpenWrt Wiki</a></bdi></span> » <bdi><a href="../start" class="wikilink1" title="doc:start">Documentation</a></bdi> » <bdi><a href="start" class="wikilink1" title="doc:howto:start">HOWTOs</a></bdi> » <bdi><span class="curid"><a href="wireless.hotspot.nodogsplash" class="wikilink1" title="doc:howto:wireless.hotspot.nodogsplash">Nodogsplash</a></span></bdi></div>
                                    <div class="plugin_multilingual">
        <ul>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/cz/doc/howto/wireless.hotspot.nodogsplash" class="media" title="cz:doc:howto:wireless.hotspot.nodogsplash"><img src="../../lib/exe/fetch.php?cache=&amp;tok=aff589&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fcz.gif" class="media" title="Čeština (Czech)" alt="Čeština (Czech)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/de/doc/howto/wireless.hotspot.nodogsplash" class="media" title="de:doc:howto:wireless.hotspot.nodogsplash"><img src="../../lib/exe/fetch.php?cache=&amp;tok=e24010&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fde.gif" class="media" title="Deutsch (German)" alt="Deutsch (German)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <span class="curid"><a href="wireless.hotspot.nodogsplash" class="media" title="doc:howto:wireless.hotspot.nodogsplash"><img src="../../lib/exe/fetch.php?cache=&amp;tok=2a37ae&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fgb.gif" class="media" title="English" alt="English" /></a></span>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/es/doc/howto/wireless.hotspot.nodogsplash" class="media" title="es:doc:howto:wireless.hotspot.nodogsplash"><img src="../../lib/exe/fetch.php?cache=&amp;tok=46c004&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fmx.gif" class="media" title="Español (Spanish, Mexico)" alt="Español (Spanish, Mexico)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/fr/doc/howto/wireless.hotspot.nodogsplash" class="media" title="fr:doc:howto:wireless.hotspot.nodogsplash"><img src="../../lib/exe/fetch.php?cache=&amp;tok=a5beba&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ffr.gif" class="media" title="Français (French)" alt="Français (French)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/hu/doc/howto/wireless.hotspot.nodogsplash" class="media" title="hu:doc:howto:wireless.hotspot.nodogsplash"><img src="../../lib/exe/fetch.php?cache=&amp;tok=6b5470&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fhu.gif" class="media" title="Magyar (Hungarian)" alt="Magyar (Hungarian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/jp/doc/howto/wireless.hotspot.nodogsplash" class="media" title="jp:doc:howto:wireless.hotspot.nodogsplash"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f999fc&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fjp.gif" class="media" title="日本語 (Japanese)" alt="日本語 (Japanese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pl/doc/howto/wireless.hotspot.nodogsplash" class="media" title="pl:doc:howto:wireless.hotspot.nodogsplash"><img src="../../lib/exe/fetch.php?cache=&amp;tok=c805c0&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fpl.gif" class="media" title="Poliski (Polish)" alt="Poliski (Polish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pt-br/doc/howto/wireless.hotspot.nodogsplash" class="media" title="pt-br:doc:howto:wireless.hotspot.nodogsplash"><img src="../../lib/exe/fetch.php?cache=&amp;tok=13127d&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fbr.gif" class="media" title="Português brasileiro (Portuguese, Brasil)" alt="Português brasileiro (Portuguese, Brasil)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/ru/doc/howto/wireless.hotspot.nodogsplash" class="media" title="ru:doc:howto:wireless.hotspot.nodogsplash"><img src="../../lib/exe/fetch.php?cache=&amp;tok=66ab5e&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fru.gif" class="media" title="Русский (Russsian)" alt="Русский (Russsian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/tr/doc/howto/wireless.hotspot.nodogsplash" class="media" title="tr:doc:howto:wireless.hotspot.nodogsplash"><img src="../../lib/exe/fetch.php?cache=&amp;tok=f4beed&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ftr.gif" class="media" title="Tϋrkçe (Turkish)" alt="Tϋrkçe (Turkish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-cn/doc/howto/wireless.hotspot.nodogsplash" class="media" title="zh-cn:doc:howto:wireless.hotspot.nodogsplash"><img src="../../lib/exe/fetch.php?cache=&amp;tok=93625a&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-cn.gif" class="media" title="官話/官话 (Chinese)" alt="官話/官话 (Chinese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-tw/doc/howto/wireless.hotspot.nodogsplash" class="media" title="zh-tw:doc:howto:wireless.hotspot.nodogsplash"><img src="../../lib/exe/fetch.php?cache=&amp;tok=b56198&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-tw.gif" class="media" title="臺灣華語 (Taiwanese)" alt="臺灣華語 (Taiwanese)" /></a>
              </div>
            </div>
          </li>
        </ul>
      </div>
        </div>
    
    
    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">

                <div class="pageId"><span>doc:howto:wireless.hotspot.nodogsplash</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="wireless.hotspot.nodogsplash#installation">Installation</a></div></li>
<li class="level1"><div class="li"><a href="wireless.hotspot.nodogsplash#configuration">Configuration</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="wireless.hotspot.nodogsplash#network">Network</a></div></li>
<li class="level2"><div class="li"><a href="wireless.hotspot.nodogsplash#wireless">Wireless</a></div></li>
<li class="level2"><div class="li"><a href="wireless.hotspot.nodogsplash#dhcpd">dhcpd</a></div></li>
<li class="level2"><div class="li"><a href="wireless.hotspot.nodogsplash#firewall">Firewall</a></div></li>
<li class="level2"><div class="li"><a href="wireless.hotspot.nodogsplash#nodogsplash1">Nodogsplash</a></div></li>
<li class="level2"><div class="li"><a href="wireless.hotspot.nodogsplash#bandwidth_control">Bandwidth Control</a></div></li>
<li class="level2"><div class="li"><a href="wireless.hotspot.nodogsplash#check_status">Check status</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="wireless.hotspot.nodogsplash#customise_splash_page">Customise splash page</a></div></li>
<li class="level1"><div class="li"><a href="wireless.hotspot.nodogsplash#restrict_access_to_domains">Restrict access to domains</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="wireless.hotspot.nodogsplash#restrict_access_to_multiple_domains">Restrict access to multiple domains</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="wireless.hotspot.nodogsplash#external_links">External links</a></div></li>
<li class="level1"><div class="li"><a href="wireless.hotspot.nodogsplash#nodogsplash_on_openwrt_1209_access_point">NoDogSplash on OpenWRT 12.09+ Access Point</a></div></li>
<li class="level1"><div class="li"><a href="wireless.hotspot.nodogsplash#quick_nodogsplash_setup_example">Quick NoDogSplash Setup Example</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="nodogsplash">Nodogsplash</h1>
<div class="level1">

<p>
<code>Nodogsplash</code> offers a simple way to open a free <a href="http://en.wikipedia.org/wiki/Hotspot (Wi-Fi)" class="interwiki iw_wp" title="http://en.wikipedia.org/wiki/Hotspot (Wi-Fi)">Hotspot (Wi-Fi)</a> providing restricted access to an Internet connection.<br/>

The goal was to use a single wireless router to both provide local secure wifi, and share a portion of our bandwidth as a free hotspot, with a splash page to advertise who is providing the hotspot, and the fact that secure, faster access is available for a small contribution towards costs.
</p>

<p>
This page describes setting up a simple wireless hotspot with the following features:
</p>
<ul>
<li class="level1"><div class="li"> Open access to the hotspot</div>
</li>
<li class="level1"><div class="li"> Capture (splash) page</div>
</li>
<li class="level1"><div class="li"> Port restrictions</div>
</li>
<li class="level1"><div class="li"> Bandwidth Limit</div>
</li>
<li class="level1"><div class="li"> Separate, secure wireless access for local use</div>
</li>
</ul>

<p>
The secure wireless is bridged to the hard-wired ports, the hotspot is separate and isolated from the local network.
</p>
<div class="table sectionedit2"><table class="inline">
	<tr class="row0">
		<td class="col0"><img src="../../_media/meta/icons/tango/48px-outdated.svg.png" class="media" alt="" /></td><td class="col1"> IMQ is still in Backfire, but not in Attitude Adjustment any more </td>
	</tr>
</table></div>

</div>

<h2 class="sectionedit3" id="installation">Installation</h2>
<div class="level2">

<p>
<a href="../techref/opkg" class="wikilink1" title="doc:techref:opkg">opkg</a>
<pre class="code">opkg update
opkg install nodogsplash</pre>

</p>

</div>

<h2 class="sectionedit4" id="configuration">Configuration</h2>
<div class="level2">

</div>

<h3 class="sectionedit5" id="network">Network</h3>
<div class="level3">

<p>
<code><a href="../uci/network" class="wikilink1" title="doc:uci:network">/etc/config/network</a></code>
</p>

<p>
<pre class="code">config &#039;interface&#039; &#039;lan&#039;
	option &#039;type&#039;	&#039;bridge&#039;
	option &#039;ifname&#039;	&#039;eth0.0&#039;
	option &#039;proto&#039;	&#039;static&#039;
	option &#039;ipaddr&#039;	&#039;10.10.10.1&#039;
	option &#039;netmask&#039;	&#039;255.255.255.0&#039;

config &#039;interface&#039; &#039;wan&#039;
	option &#039;ifname&#039;	&#039;eth0.1&#039;
	option &#039;proto&#039;	&#039;dhcp&#039;

config &#039;interface&#039; &#039;wifi&#039;
	option &#039;ifname&#039;	&#039;eth1.0&#039;
	option &#039;proto&#039;	&#039;static&#039;
	option &#039;ipaddr&#039;	&#039;10.10.15.1&#039;
	option &#039;netmask&#039;	&#039;255.255.255.0&#039;</pre>

</p>

</div>

<h3 class="sectionedit6" id="wireless">Wireless</h3>
<div class="level3">

<p>
<code><a href="../uci/wireless" class="wikilink1" title="doc:uci:wireless">/etc/config/wireless</a></code>
</p>

<p>
<pre class="code">config &#039;wifi-device&#039; &#039;wlan0&#039;
	option &#039;type&#039;	&#039;mac80211&#039;
	option &#039;channel&#039;	&#039;11&#039;
	option &#039;disabled&#039;	&#039;0&#039;

config &#039;wifi-iface&#039;
	option &#039;device&#039;	&#039;wlan0&#039;
	option &#039;network&#039;	&#039;lan&#039;
	option &#039;mode&#039;	&#039;ap&#039;
	option &#039;ssid&#039;	&#039;mywifi-secure&#039;
	option &#039;encryption&#039;	&#039;psk2&#039;
	option &#039;hidden&#039;	&#039;0&#039;
	option &#039;key&#039;	&#039;your%verylong.andsecure-pskkey&#039;

config &#039;wifi-iface&#039;
	option &#039;device&#039;	&#039;wlan0&#039;
	option &#039;network&#039;	&#039;wifi&#039;
	option &#039;mode&#039;	&#039;ap&#039;
	option &#039;ssid&#039;	&#039;public-hotspot&#039;
	option &#039;encryption&#039;	&#039;none&#039;
	option &#039;hidden&#039;	&#039;0&#039;</pre>

</p>

</div>

<h3 class="sectionedit7" id="dhcpd">dhcpd</h3>
<div class="level3">

<p>
<code><a href="../uci/dhcp" class="wikilink1" title="doc:uci:dhcp">/etc/config/dhcp</a></code>
</p>

<p>
<pre class="code">config &#039;dhcp&#039;
        	option &#039;interface&#039;	&#039;lan&#039;
        	option &#039;start&#039;	&#039;100&#039;
        	option &#039;limit&#039;	&#039;150&#039;
        	option &#039;leasetime&#039;	&#039;12h&#039;

config &#039;dhcp&#039;
        	option &#039;interface&#039;	&#039;wan&#039;
        	option &#039;ignore&#039;	&#039;1&#039;

config &#039;dhcp&#039;
        	option &#039;interface&#039;	&#039;wifi&#039;
        	option &#039;start&#039;	&#039;100&#039;
        	option &#039;limit&#039;	&#039;150&#039;
        	option &#039;leasetime&#039;	&#039;2h&#039;</pre>

</p>

</div>

<h3 class="sectionedit8" id="firewall">Firewall</h3>
<div class="level3">

<p>
Because nodogsplash uses iptables to mark/handle packets, you have to turn off the build-in firewall:
<pre class="code">/etc/init.d/firewall stop
/etc/init.d/firewall disable</pre>

</p>

</div>

<h3 class="sectionedit9" id="nodogsplash1">Nodogsplash</h3>
<div class="level3">

<p>
<code>/etc/nodogsplash/nodogsplash.conf</code>
</p>

<p>
<pre class="code">#
# Nodogsplash Configuration File
#

# Parameter: GatewayInterface
# Default: NONE
#
# GatewayInterface is not autodetected, has no default, and must be set here.
# Set GatewayInterface to the interface on your router
# that is to be managed by Nodogsplash.
# Typically br0 for the wired and wireless lan on OpenWrt White Russian.
# May be br-lan on OpenWrt Kamikaze.
#
GatewayInterface wlan0

# FirewallRuleSet: authenticated-users
#
# Control access for users after authentication.
# These rules are inserted at the beginning of the
# FORWARD chain of the router&#039;s filter table, and
# apply to packets that have come in to the router
# over the GatewayInterface from MAC addresses that
# have authenticated with Nodogsplash, and that are
# destined to be routed through the router. The rules are
# considered in order, and the first rule that matches
# a packet applies to it.
# If there are any rules in this ruleset, an authenticated
# packet that does not match any rule is rejected.
# N.B.: This ruleset is completely independent of
# the preauthenticated-users ruleset.
#
FirewallRuleSet authenticated-users {

 # You may want to open access to a machine on a local
 # subnet that is otherwise blocked (for example, to
 # serve a redirect page; see RedirectURL). If so,
 # allow that explicitly here, e.g:
 # FirewallRule allow tcp port 80 to 192.168.254.254

 # Your router may have several interfaces, and you
 # probably want to keep them private from the GatewayInterface.
 # If so, you should block the entire subnets on those interfaces, e.g.:
    #FirewallRule block to 192.168.0.0/16
    #FirewallRule block to 10.0.0.0/8

 # Typical ports you will probably want to open up include
 # 53 udp and tcp for DNS,
 # 80 for http,
 # 443 for https,
 # 22 for ssh:
    #FirewallRule allow tcp port 53
    #FirewallRule allow udp port 53
    #FirewallRule allow tcp port 80
    #FirewallRule allow tcp port 443
    #FirewallRule allow tcp port 22
    FirewallRule allow all

}
# end FirewallRuleSet authenticated-users


# FirewallRuleSet: preauthenticated-users
#
# Control access for users before authentication.
# These rules are inserted in the PREROUTING chain
# of the router&#039;s nat table, and in the
# FORWARD chain of the router&#039;s filter table.
# These rules apply to packets that have come in to the
# router over the GatewayInterface from MAC addresses that
# are not on the BlockedMACList or TrustedMACList,
# are *not* authenticated with Nodogsplash. The rules are
# considered in order, and the first rule that matches
# a packet applies to it. A packet that does not match
# any rule here is rejected.
# N.B.: This ruleset is completely independent of
# the authenticated-users and users-to-router rulesets.
#
FirewallRuleSet preauthenticated-users {
 # For preauthenticated users to resolve IP addresses in their initial
 # request not using the router itself as a DNS server,
 # you probably want to allow port 53 udp and tcp for DNS.
    FirewallRule allow tcp port 53
    FirewallRule allow udp port 53
 # For splash page content not hosted on the router, you
 # will want to allow port 80 tcp to the remote host here.
 # Doing so circumvents the usual capture and redirect of
 # any port 80 request to this remote host.
 # Note that the remote host&#039;s numerical IP address must be known
 # and used here.
 # FirewallRule allow tcp port 80 to 123.321.123.321
}
# end FirewallRuleSet preauthenticated-users


# FirewallRuleSet: users-to-router
#
# Control access to the router itself from the GatewayInterface.
# These rules are inserted at the beginning of the
# INPUT chain of the router&#039;s filter table, and
# apply to packets that have come in to the router
# over the GatewayInterface from MAC addresses that
# are not on the TrustedMACList, and are destined for
# the router itself. The rules are
# considered in order, and the first rule that matches
# a packet applies to it.
# If there are any rules in this ruleset, a
# packet that does not match any rule is rejected.
#
FirewallRuleSet users-to-router {
 # Nodogsplash automatically allows tcp to GatewayPort,
 # at GatewayAddress, to serve the splash page.
 # However you may want to open up other ports, e.g.
 # 53 for DNS and 67 for DHCP if the router itself is
 # providing these services.
    FirewallRule allow udp port 53
    FirewallRule allow tcp port 53
    FirewallRule allow udp port 67
 # You may want to allow ssh, http, and https to the router
 # for administration from the GatewayInterface. If not,
 # comment these out.
    FirewallRule allow tcp port 22
    FirewallRule allow tcp port 23
    FirewallRule allow tcp port 80
    FirewallRule allow tcp port 443
}
# end FirewallRuleSet users-to-router

# EmptyRuleSetPolicy directives
# The FirewallRuleSets that NoDogSplash permits are:
#
# authenticated-users
# preauthenticated-users
# users-to-router
# trusted-users
# trusted-users-to-router
#
# For each of these, an EmptyRuleSetPolicy can be specified.
# An EmptyRuleSet policy applies to a FirewallRuleSet if the
# FirewallRuleSet is missing from this configuration file,
# or if it exists but contains no FirewallRules.
#
# The possible values of an EmptyRuleSetPolicy are:
# allow -- packets are accepted
# block -- packets are rejected
# passthrough -- packets are passed through to pre-existing firewall rules
#
# Default EmptyRuleSetPolicies are set as follows:
# EmptyRuleSetPolicy authenticated-users passthrough
# EmptyRuleSetPolicy preauthenticated-users block
# EmptyRuleSetPolicy users-to-router block
# EmptyRuleSetPolicy trusted-users allow
# EmptyRuleSetPolicy trusted-users-to-router allow


# Parameter: GatewayName
# Default: NoDogSplash
#
# Set GatewayName to the name of your gateway. This value
# will be available as variable $gatewayname in the splash page source
# and in status output from ndsctl, but otherwise doesn&#039;t matter.
# If none is supplied, the value &quot;NoDogSplash&quot; is used.
#
# GatewayName NoDogSplash

# Parameter: GatewayAddress
# Default: Discovered from GatewayInterface
#
# This should be autodetected on an OpenWRT system, but if not:
# Set GatewayAddress to the IP address of the router on
# the GatewayInterface. This is the address that the Nodogsplash
# server listens on.
#
# GatewayAddress 192.168.1.1

# Parameter: ExternalInterface
# Default: Autodetected from /proc/net/route
#
# This should be autodetected on a OpenWRT system, but if not:
# Set ExtrnalInterface to the &#039;external&#039; interface on your router,
# i.e. the one which provides the default route to the internet.
# Typically vlan1 for OpenWRT.
#
# ExternalInterface vlan1

# Parameter: RedirectURL
# Default: none
#
# After authentication, normally a user is redirected
# to their initially requested page.
# If RedirectURL is set, the user is redirected to this URL instead.
#
# RedirectURL http://www.ilesansfil.org/

# Parameter: GatewayPort
# Default: 2050
#
# Nodogsplash&#039;s own http server uses GatewayAddress as its IP address.
# The port it listens to at that IP can be set here; default is 2050.
#
# GatewayPort 2050

# Parameter: MaxClients
# Default: 20
#
# Set MaxClients to the maximum number of users allowed to
# connect at any time. (Does not include users on the TrustedMACList,
# who do not authenticate.)
#
# MaxClients 20

# ClientIdleTimeout
# Parameter: ClientIdleTimeout
# Default: 10
#
# Set ClientIdleTimeout to the desired of number of minutes
# of inactivity before a user is automatically &#039;deauthenticated&#039;.
#
# ClientIdleTimeout 10

# Parameter: ClientForceTimeout
# Default: 360
#
# Set ClientForceTimeout to the desired number of minutes before
# a user is automatically &#039;deauthenticated&#039;, whether active or not
#
# ClientForceTimeout 360

# Parameter: AuthenticateImmediately
# Default: no
#
# Set to yes (or true or 1), to immediately authenticate users
# who make a http port 80 request on the GatewayInterface (that is,
# do not serve a splash page, just redirect to the user&#039;s request,
# or to RedirectURL if set).
#
# AuthenticateImmediately no

# Parameter: MACMechanism
# Default: block
#
# Either block or allow.
# If &#039;block&#039;, MAC addresses on BlockedMACList are blocked from
# authenticating, and all others are allowed.
# If &#039;allow&#039;, MAC addresses on AllowedMACList are allowed to
# authenticate, and all other (non-trusted) MAC&#039;s are blocked.
#
# MACMechanism block

# Parameter: BlockedMACList
# Default: none
#
# Comma-separated list of MAC addresses who will be completely blocked
# from the GatewayInterface. Ignored if MACMechanism is allow.
# N.B.: weak security, since MAC addresses are easy to spoof.
#
# BlockedMACList 00:00:DE:AD:BE:EF,00:00:C0:1D:F0:0D

# Parameter: AllowedMACList
# Default: none
#
# Comma-separated list of MAC addresses who will not be completely
# blocked from the GatewayInterface. Ignored if MACMechanism is block.
# N.B.: weak security, since MAC addresses are easy to spoof.
#
# AllowedMACList 00:00:12:34:56:78

# Parameter: TrustedMACList
# Default: none
#
# Comma-separated list of MAC addresses who are not subject to
# authentication, and are not restricted by any FirewallRuleSet.
# N.B.: weak security, since MAC addresses are easy to spoof.
#
# TrustedMACList 00:00:CA:FE:BA:BE, 00:00:C0:01:D0:0D


# Parameter: PasswordAuthentication
# Default: no
# Set to yes (or true or 1), to require a password matching
# the Password parameter to be supplied when authenticating.
#
#
# PasswordAuthentication no

# Parameter: Password
# Default: none
# Whitespace delimited string that is compared to user-supplied
# password when authenticating.
#
#
# Password nodog

# Parameter: UsernameAuthentication
# Default: no
# Set to yes (or true or 1), to require a username matching
# the Username parameter to be supplied when authenticating.
#
#
# UsernameAuthentication no

# Parameter: Username
# Default: none
# Whitespace delimited string that is compared to user-supplied
# username when authenticating.
#
#
# Username guest

# Parameter: PasswordAttempts
# Default: 5
# Integer number of failed password/username entries before
# a user is forced to reauthenticate.
#
#
# PasswordAttempts 5

# Parameter: TrafficControl
# Default: no
#
# Set to yes (or true or 1), to enable traffic control in Nodogsplash.
#
# TrafficControl no

# Parameter: DownloadLimit
# Default: 0
#
# If TrafficControl is enabled, this sets the maximum download
# speed to the GatewayInterface, in kilobits per second.
# For example if you have an ADSL connection with 768 kbit
# download speed, and you want to allow about half of that
# bandwidth for the GatewayInterface, set this to 384.
# A value of 0 means no download limiting is done.
#
# DownloadLimit 384

# Parameter: UploadLimit
# Default: 0
#
# If TrafficControl is enabled, this sets the maximum upload
# speed from the GatewayInterface, in kilobits per second.
# For example if you have an ADSL connection with 128 kbit
# upload speed, and you want to allow about half of that
# bandwidth for the GatewayInterface, set this to 64.
# A value of 0 means no upload limiting is done.
#
# UploadLimit 64

# Paramter: GatewayIPRange
# Default: 0.0.0.0/0
#
# By setting this parameter, you can specify a range of IP addresses
# on the GatewayInterface that will be responded to and managed by
# Nodogsplash. Addresses outside this range do not have their packets
# touched by Nodogsplash at all.
# Defaults to 0.0.0.0/0, that is, all addresses.
#
# GatewayIPRange 0.0.0.0/0</pre>

</p>

<p>
Allow access to email:
</p>

<p>
<pre class="code">FirewallRuleSet authenticated-users {
...
FirewallRule allow tcp port 995
FirewallRule allow tcp port 993
FirewallRule allow tcp port 465
FirewallRule allow tcp port 110
FirewallRule allow tcp port 143</pre>

</p>

<p>
Restrict access to the gateway from the hotspot side:
</p>

<p>
<pre class="code">FirewallRuleSet users-to-router {
...
#    FirewallRule allow tcp port 22
#    FirewallRule allow tcp port 80
#    FirewallRule allow tcp port 443</pre>

</p>

</div>

<h3 class="sectionedit10" id="bandwidth_control">Bandwidth Control</h3>
<div class="level3">

<p>
You can restrict bandwidth available to hotspot (adjust according to preference):
</p>

<p>
<pre class="code">trafficControl yes
...
DownloadLimit 200
...
UploadLimit 100</pre>

</p>

<p>
<strong>In backfire 10.03.1rc5 you need to edit /etc/init.d/nodogsplash and uncomment last lines to make bandwidth control to work</strong>
</p>

<p>
<pre class="code">    # if not using traffic control,
    # you can comment out the following 3 lines:
    do_module_tests &quot;imq&quot; &quot;numdevs=2&quot;
    do_module_tests &quot;ipt_IMQ&quot;
    do_module_tests &quot;sch_htb&quot;</pre>

Note: <em>ipt_IMQ = xt_IMQ</em>
</p>

<p>
<strong>You also need to install some extra kernel modules:</strong>
</p>

<p>
<pre class="code">    opkg install iptables-mod-imq
    opkg install kmod-ipt-imq
    opkg install kmod-sched</pre>

And some utilities
<pre class="code">    opkg install ip
    opkg install tc</pre>

</p>

<p>
<strong>NOTE: In Attitude Adjustment 12.09 there is no <code>iptables-mod-imq</code> package and so the above procedure will fail.</strong>
</p>

<p>
For bandwidth control in <strong>Attitude Adjustment 12.09</strong> you can install <a href="http://lartc.org/wondershaper/" class="urlextern" title="http://lartc.org/wondershaper/"  rel="nofollow">WonderShaper</a> (which also uses <a href="traffic.shaping" class="urlextern" title="http://wiki.openwrt.org/doc/howto/packet.scheduler/packet.scheduler"  rel="nofollow">tc</a> as its back-end):
</p>

<p>
<pre class="code">    opkg install wshaper</pre>

</p>

<p>
WonderShaper&#039;s UCI config file is stored in <code>/etc/config/wshaper</code>. A simple configuration for a guest network might look like this:
</p>

<p>
<pre class="code">config wshaper &#039;settings&#039;
	option network &#039;public&#039;
	option downlink &#039;64&#039;
	option uplink &#039;512&#039;</pre>

</p>

<p>
<strong>Note:</strong> The <code>downlink</code> and <code>uplink</code> maximum values will usually need to be reversed from what one might, at first glance, expect. Also note that due to overhead, actual speeds will be slightly lower.
</p>

</div>

<h3 class="sectionedit11" id="check_status">Check status</h3>
<div class="level3">

<p>
Nodogsplash package provides the <code>ndsctl</code> binary to manage it. Run ndsctl without arguments to see the help.
</p>

<p>
<pre class="code">root@openWrt:~# ndsctl       
Usage: ndsctl [options] command [arguments]

options:
  -s &lt;path&gt;         Path to the socket
  -h                Print usage

commands:
  status            View the status of nodogsplash
  clients           Display machine-readable client list
  stop              Stop the running nodogsplash
  auth ip           Authenticate user with specified ip
  deauth mac|ip     Deauthenticate user with specified mac or ip
  block mac         Block the given MAC address
  unblock mac       Unblock the given MAC address
  allow mac         Allow the given MAC address
  unallow mac       Unallow the given MAC address
  trust mac         Trust the given MAC address
  untrust mac       Untrust the given MAC address
  loglevel n        Set logging level to n
  password pass     Set gateway password
  username name     Set gateway username</pre>

</p>

</div>

<h2 class="sectionedit12" id="customise_splash_page">Customise splash page</h2>
<div class="level2">

<p>
Edit these files to customize the &quot;splash page&quot; / &quot;error page&quot;:
</p>
<ul>
<li class="level1"><div class="li"> <code>/etc/nodogsplash/htdocs/splash.html</code></div>
</li>
<li class="level1"><div class="li"> <code>/etc/nodogsplash/htdocs/infoskel.html</code></div>
</li>
</ul>

<p>
Note, to include an external <code>*.css</code> file, put it in the images directory, and include as so:
</p>

<p>
<pre class="code">@import url(&quot;$imagesdir/stylesheet.css&quot;);</pre>

</p>

<p>
Somewhere in <code>splash.html</code> you should include a link for the authentication, e.g:
</p>

<p>
<pre class="code html4strict"><span class="sc2">&lt;<a href="http://december.com/html/4/element/h3.html"><span class="kw2">h3</span></a>&gt;</span> Click <span class="sc2">&lt;<a href="http://december.com/html/4/element/a.html"><span class="kw2">a</span></a> <span class="kw3">href</span><span class="sy0">=</span><span class="st0">&quot;$authtarget&quot;</span>&gt;</span> HERE<span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/a.html"><span class="kw2">a</span></a>&gt;</span> to start browsing <span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/h3.html"><span class="kw2">h3</span></a>&gt;</span></pre>

</p>

</div>

<h2 class="sectionedit13" id="restrict_access_to_domains">Restrict access to domains</h2>
<div class="level2">

<p>
If you would want to restrict the access to the IP address 20.20.20.20 you can use this <a href="netfilter" class="wikilink1" title="doc:howto:netfilter">netfilter</a> command (supposing 10.20.30.0/24 is your hotspot network and you redirect clients to your nodogsplash webserver)
</p>

<p>
<pre class="code">  iptables -t nat -I ndsOUT -p tcp -s 10.20.30.0/24 -d 20.20.20.20 --dport 80 -j DNAT --to 10.20.30.1:2050</pre>

</p>

</div>

<h3 class="sectionedit14" id="restrict_access_to_multiple_domains">Restrict access to multiple domains</h3>
<div class="level3">

<p>
Some domains resolve to multiple different ip addresses so you need to ban all of them.
</p>
<ol>
<li class="level1"><div class="li"> Create <code>/root/banned.txt</code> with the domains to ban (do not add domains with www):<pre class="code">root@openWrt:~# head /root/banned.txt 
alice.cc
malware.ru
sersnkis.com
superdupertorrent.com
ultraload.com
downloadmuch.com</pre>
</div>
</li>
<li class="level1"><div class="li"> Create following script <code>/root/ban-domains.sh</code>:<pre class="code bash"><span class="co0">#!/bin/sh</span>
&nbsp;
<span class="kw1">for</span> domain <span class="kw1">in</span> <span class="sy0">`</span><span class="kw2">cat</span> <span class="sy0">/</span>root<span class="sy0">/</span>banned.txt<span class="sy0">`</span>; <span class="kw1">do</span>
	<span class="kw2">dig</span> <span class="sy0">@</span>8.8.8.8 <span class="re1">$domain</span> <span class="sy0">|</span> <span class="kw2">egrep</span> <span class="br0">&#91;</span><span class="nu0">0</span>-<span class="nu0">9</span><span class="br0">&#93;</span> <span class="sy0">|</span> <span class="kw2">grep</span> IN<span class="sy0">|</span> <span class="kw2">awk</span> <span class="br0">&#123;</span><span class="st_h">'print $5'</span><span class="br0">&#125;</span> <span class="sy0">&gt;&gt;</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>ips.txt
	<span class="kw1">done</span>
&nbsp;
<span class="kw1">for</span> <span class="kw2">ip</span> <span class="kw1">in</span> <span class="sy0">`</span><span class="kw2">cat</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>ips.txt<span class="sy0">`</span>; <span class="kw1">do</span>
	iptables <span class="re5">-t</span> nat <span class="re5">-I</span> ndsOUT <span class="re5">-p</span> tcp <span class="re5">-s</span> 10.20.30.0<span class="sy0">/</span><span class="nu0">24</span> <span class="re5">-d</span> <span class="re1">$ip</span> <span class="re5">--dport</span> <span class="nu0">80</span> <span class="re5">-j</span> DNAT <span class="re5">--to</span> 10.20.30.1:<span class="nu0">80</span>
	<span class="kw1">done</span>
&nbsp;
<span class="kw2">rm</span> <span class="re5">-fr</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>ips.txt</pre>
</div>
</li>
<li class="level1"><div class="li"> run <pre class="code">chmod +x /root/ban-domains.sh&quot;</pre>
</div>
</li>
<li class="level1"><div class="li"> install dig package: <pre class="code">opkg install bind-dig</pre>
</div>
</li>
<li class="level1"><div class="li"> add <code>/root/ban-domains.sh</code> to your <code>/etc/rc.local</code> file.</div>
</li>
</ol>

<p>
after executing the script you can check if it works ok running &quot;iptables -t nat -L -n&quot; and you should get something like this:
</p>

<p>
<pre class="code">Chain ndsOUT (1 references)
target     prot opt source               destination         
DNAT       tcp  --  10.20.30.0/24        199.58.211.41       tcp dpt:80 to:10.20.30.1:80 
DNAT       tcp  --  10.20.30.0/24        69.163.39.214       tcp dpt:80 to:10.20.30.1:80 
DNAT       tcp  --  10.20.30.0/24        78.140.135.6        tcp dpt:80 to:10.20.30.1:80 
DNAT       tcp  --  10.20.30.0/24        74.117.114.96       tcp dpt:80 to:10.20.30.1:80 
DNAT       tcp  --  10.20.30.0/24        88.85.73.158        tcp dpt:80 to:10.20.30.1:80 
DNAT       tcp  --  10.20.30.0/24        216.69.227.108      tcp dpt:80 to:10.20.30.1:80 
DNAT       tcp  --  10.20.30.0/24        72.8.129.153        tcp dpt:80 to:10.20.30.1:80 </pre>

</p>

</div>

<h2 class="sectionedit15" id="external_links">External links</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://kokoro.ucsd.edu/nodogsplash/" class="urlextern" title="http://kokoro.ucsd.edu/nodogsplash/"  rel="nofollow">Original Nodogsplash project homepage</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://github.com/nodogsplash/nodogsplash" class="urlextern" title="https://github.com/nodogsplash/nodogsplash"  rel="nofollow">Current Nodogsplash source repository</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://github.com/openwrt-routing/packages" class="urlextern" title="https://github.com/openwrt-routing/packages"  rel="nofollow">Nodogsplash OpenWrt package</a></div>
</li>
</ul>

</div>

<h1 class="sectionedit16" id="misc">Misc.</h1>
<div class="level1">

<p>
If your configuration does NOT use NAT, you need to check &quot;force connection tracking&quot; in the firewall configuration of the zone nodogsplash is handling. Without connection tracking, the NAT tables of will not run and redirecting to the splash page does not work.
</p>

</div>

<h2 class="sectionedit17" id="nodogsplash_on_openwrt_1209_access_point">NoDogSplash on OpenWRT 12.09+ Access Point</h2>
<div class="level2">

<p>
The following instructions are touching NoDogSplash configuration on the OpenWRT 12.09 and later firmwares with &quot;router&quot; configured as a <strong>switch</strong> or <strong>Access Point</strong> (AP). OpenWrt is not configured as a router here! This is a common setup where users want to add additional AP to extend their home WiFi coverage and do not want to mess with router from their Internet providers.
Example setup:
</p>
<ul>
<li class="level1"><div class="li">  Non OpenWRT router for intranet with address 192.168.1.1</div>
</li>
<li class="level1"><div class="li">  OpenWRT AP with static address 192.168.1.3</div>
</li>
<li class="level1"><div class="li">  Clients get DHCP subnet range 192.168.1.200-250 by router</div>
</li>
<li class="level1"><div class="li">  Clients can connect to AP WiFi within secure SSID</div>
</li>
<li class="level1"><div class="li">  Guest hotspot SSID are getting their own 192.168.15.0/24 subnet and DHCP on isolated segment</div>
</li>
</ul>

<p>
Configuration of the AP is as usual except that AP needs to have NAT for the hotspot segment only. To achieve this one needs to add custom iptables rule
</p>
<pre class="code">iptables -A POSTROUTING -t nat -j SNAT --to-source 192.168.1.3</pre>

<p>
and delete all provided firewall rules fy using OpenWRT web interface.
</p>

<p>
Detailed configuration for AP only OpenWRT is:
</p>
<ol>
<li class="level1"><div class="li"> Install package <em>nodogsplash</em></div>
</li>
<li class="level1"><div class="li"> With web interface <em>Network→WiFi</em> create: additional ESSID named hotstpot and create additional network hotstpot along with existing lan and unused wan.</div>
</li>
<li class="level1"><div class="li"> Edit <em>Network→Interfaces→HOTSPOT</em> and select Protocol: Static address with IPv4 address 192.168.5.1 and Netmask: 255.255.255.0. Leave gateway, broadcast and <abbr title="Domain Name System">DNS</abbr> servers empty. Add DHCP server for this interface with default settings. This HOTSPOT interface is internally named as wlan0-1 and will be used as NoDogSplash gateway address.</div>
</li>
<li class="level1"><div class="li"> Edit <em>Network→DHCP and <abbr title="Domain Name System">DNS</abbr></em>-Forwarder by unchecking Authoritative and add <abbr title="Domain Name System">DNS</abbr> forwardings: 192.168.1.1 to router <abbr title="Domain Name System">DNS</abbr> masquerading and/or external <abbr title="Domain Name System">DNS</abbr> servers from your internet provider.</div>
</li>
<li class="level1"><div class="li"> Remove all <em>Network→Firewall Zones</em> and add <em>Network→Firewall→Custom Rules</em> by adding iptables rule described above.</div>
</li>
<li class="level1"><div class="li"> Change <code>/etc/nodogsplash/nodogsplash.conf</code> affected lines to</div>
</li>
</ol>
<pre class="code">        GatewayInterface wlan0-1
        ExternalInterface br-lan</pre>

<p>
FirewallRuleSet authenticated-users can remain unchanged. You can also start iptables SNAT command manually if not rebooted meanwhile. Check the presence of this rule by <code>iptables -t nat -v -n -L</code>. Enable and start NoDogSplash. After above setup everything should work. Trafic shapping due to the lack of IMQ currently does not work on OpenWrt 12.09 (Attitude Adjustment).  One possibility is to install qos-scripts and luci-app-qos. Adding additional interface HOTSPOT to QOS configuration cannot separate between WAN and HOTSPOT bandwidth limit. One can choose to limit NoDogSplash and secure WiFi together to certain Upload and Download rate, but not separate!
</p>

</div>

<h2 class="sectionedit18" id="quick_nodogsplash_setup_example">Quick NoDogSplash Setup Example</h2>
<div class="level2">

<p>
This is a quick setup for Nodogsplash. It shows a splash page for any web acccess comming from br-lan.
</p>

<p>
/etc/nodogsplash/nodogsplash.conf
<pre class="code">GatewayInterface br-lan

FirewallRuleSet preauthenticated-users {
 FirewallRule allow tcp port 53
 FirewallRule allow udp port 53
 FirewallRule allow icmp
}

EmptyRuleSetPolicy authenticated-users passthrough
EmptyRuleSetPolicy users-to-router passthrough
EmptyRuleSetPolicy trusted-users allow
EmptyRuleSetPolicy trusted-users-to-router passthrough

MaxClients 30
ClientIdleTimeout 10
ClientForceTimeout 240</pre>

</p>

<p>
For the actual splash site place these <a href="https://github.com/nodogsplash/nodogsplash/tree/master/resources" class="urlextern" title="https://github.com/nodogsplash/nodogsplash/tree/master/resources"  rel="nofollow">example files</a> as follows:
</p>

<p>
<pre class="code">/etc/nodogsplash/htdocs/splash.html
/etc/nodogsplash/htdocs/infoskel.html
/etc/nodogsplash/htdocs/images/splash.jpg</pre>

</p>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>doc/howto/wireless.hotspot.nodogsplash.txt</bdi> · Last modified: 2014/06/09 23:06 by <bdi>alois_hockenschlohe2</bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="wireless.hotspot.nodogsplash?do=edit"  class="action source" accesskey="v" rel="nofollow" title="Show pagesource [V]"><span>Show pagesource</span></a></li><li><a href="wireless.hotspot.nodogsplash?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="wireless.hotspot.nodogsplash?do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="wireless.hotspot.nodogsplash#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license" class="urlextern">CC Attribution-Noncommercial-Share Alike 3.0 Unported</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license"><img src="../../lib/images/license/button/cc-by-nc-sa.png" alt="CC Attribution-Noncommercial-Share Alike 3.0 Unported" /></a>        <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/openwrt/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://www.php.net" title="Powered by PHP" ><img
            src="../../lib/tpl/openwrt/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/openwrt/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../../lib/tpl/openwrt/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/openwrt/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="../../lib/exe/indexer.php?id=doc%253Ahowto%253Awireless.hotspot.nodogsplash&amp;1432267097" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</body>
</html>
