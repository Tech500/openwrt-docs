<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>DNSCrypt [OpenWrt Wiki]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="inbox,dnscrypt"/>
<link rel="search" type="application/opensearchdescription+xml" href="../lib/exe/opensearch.php" title="OpenWrt Wiki"/>
<link rel="start" href="../index.html"/>
<link rel="contents" href="dnscrypt?do=index" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Recent changes" href="../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="../feed.php?mode=list&amp;ns=inbox"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../_export/xhtml/inbox/dnscrypt"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../_export/raw/inbox/dnscrypt"/>
<link rel="canonical" href="dnscrypt"/>
<link rel="stylesheet" type="text/css" href="../lib/exe/css.php?t=openwrt&amp;tseed=6f44f363dc87908d905dc56ff3acbfc4"/>
<script type="text/javascript">/*<![CDATA[*/var NS='inbox';var JSINFO = {"id":"inbox:dnscrypt","namespace":"inbox"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../lib/exe/js.php?tseed=6f44f363dc87908d905dc56ff3acbfc4"></script>
<script type="text/javascript" charset="utf-8">/*<![CDATA[*/jQuery(function(){
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1432265557 166.182.3.5';
			document.forms[i].appendChild(myElement);
		}
	}
});
/*!]]>*/</script>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../lib/tpl/openwrt/images/favicon.ico" />
<link rel="apple-touch-icon" href="../lib/tpl/openwrt/images/apple-touch-icon.png" />
    </head>

<body>
    <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_openwrt     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="dnscrypt#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="../start"  accesskey="h" title="[H]"><img src="../lib/tpl/openwrt/images/logo.png" width="386" height="98" alt="" /> <span>OpenWrt Wiki</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="dnscrypt?do=register"  class="action register" rel="nofollow" title="Register">Register</a></li><li><a href="dnscrypt?do=login&amp;sectok=382740b13d95f946eed36caa57076b4a"  class="action login" rel="nofollow" title="Login">Login</a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="../start" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="../doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="inbox:dnscrypt" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Show pagesource</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Login</option><option value="register">Register</option></optgroup></select><input type="submit" value="&gt;" /></div></form>            </div>
            <ul>
                <li><a href="dnscrypt?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a></li><li><a href="dnscrypt?do=media&amp;ns=inbox"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a></li><li><a href="dnscrypt?do=index"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                            <div class="youarehere"><span class="bchead">You are here: </span><span class="home"><bdi><a href="../start" class="wikilink1" title="start">OpenWrt Wiki</a></bdi></span> » <bdi><a href="start" class="wikilink1" title="inbox:start">Build and installation - Few Adjustments - NEW (shiva)</a></bdi> » <bdi><span class="curid"><a href="dnscrypt" class="wikilink1" title="inbox:dnscrypt">DNSCrypt</a></span></bdi></div>
                                    <div class="plugin_multilingual">
        <ul>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/cz/inbox/dnscrypt" class="media" title="cz:inbox:dnscrypt"><img src="../lib/exe/fetch.php?cache=&amp;tok=aff589&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fcz.gif" class="media" title="Čeština (Czech)" alt="Čeština (Czech)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/de/inbox/dnscrypt" class="media" title="de:inbox:dnscrypt"><img src="../lib/exe/fetch.php?cache=&amp;tok=e24010&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fde.gif" class="media" title="Deutsch (German)" alt="Deutsch (German)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <span class="curid"><a href="dnscrypt" class="media" title="inbox:dnscrypt"><img src="../lib/exe/fetch.php?cache=&amp;tok=2a37ae&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fgb.gif" class="media" title="English" alt="English" /></a></span>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/es/inbox/dnscrypt" class="media" title="es:inbox:dnscrypt"><img src="../lib/exe/fetch.php?cache=&amp;tok=46c004&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fmx.gif" class="media" title="Español (Spanish, Mexico)" alt="Español (Spanish, Mexico)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/fr/inbox/dnscrypt" class="media" title="fr:inbox:dnscrypt"><img src="../lib/exe/fetch.php?cache=&amp;tok=a5beba&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ffr.gif" class="media" title="Français (French)" alt="Français (French)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/hu/inbox/dnscrypt" class="media" title="hu:inbox:dnscrypt"><img src="../lib/exe/fetch.php?cache=&amp;tok=6b5470&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fhu.gif" class="media" title="Magyar (Hungarian)" alt="Magyar (Hungarian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/jp/inbox/dnscrypt" class="media" title="jp:inbox:dnscrypt"><img src="../lib/exe/fetch.php?cache=&amp;tok=f999fc&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fjp.gif" class="media" title="日本語 (Japanese)" alt="日本語 (Japanese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pl/inbox/dnscrypt" class="media" title="pl:inbox:dnscrypt"><img src="../lib/exe/fetch.php?cache=&amp;tok=c805c0&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fpl.gif" class="media" title="Poliski (Polish)" alt="Poliski (Polish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pt-br/inbox/dnscrypt" class="media" title="pt-br:inbox:dnscrypt"><img src="../lib/exe/fetch.php?cache=&amp;tok=13127d&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fbr.gif" class="media" title="Português brasileiro (Portuguese, Brasil)" alt="Português brasileiro (Portuguese, Brasil)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <a href="../ru/inbox/dnscrypt" class="media" title="ru:inbox:dnscrypt"><img src="../lib/exe/fetch.php?cache=&amp;tok=66ab5e&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fru.gif" class="media" title="Русский (Russsian)" alt="Русский (Russsian)" /></a>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/tr/inbox/dnscrypt" class="media" title="tr:inbox:dnscrypt"><img src="../lib/exe/fetch.php?cache=&amp;tok=f4beed&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ftr.gif" class="media" title="Tϋrkçe (Turkish)" alt="Tϋrkçe (Turkish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-cn/inbox/dnscrypt" class="media" title="zh-cn:inbox:dnscrypt"><img src="../lib/exe/fetch.php?cache=&amp;tok=93625a&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-cn.gif" class="media" title="官話/官话 (Chinese)" alt="官話/官话 (Chinese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-tw/inbox/dnscrypt" class="media" title="zh-tw:inbox:dnscrypt"><img src="../lib/exe/fetch.php?cache=&amp;tok=b56198&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-tw.gif" class="media" title="臺灣華語 (Taiwanese)" alt="臺灣華語 (Taiwanese)" /></a>
              </div>
            </div>
          </li>
        </ul>
      </div>
        </div>
    
    
    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">

                <div class="pageId"><span>inbox:dnscrypt</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="dnscrypt#dnscrypt">DNSCrypt</a></div></li>
<li class="level1"><div class="li"><a href="dnscrypt#installation_on_ar71xx_platforms">Installation on ar71xx platforms</a></div></li>
<li class="level1"><div class="li"><a href="dnscrypt#installation_on_x86_platforms">Installation on x86 platforms</a></div></li>
<li class="level1"><div class="li"><a href="dnscrypt#configuration">Configuration</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="dnscrypt#server_configuration">Server configuration</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="dnscrypt#dnscrypt-proxy">dnscrypt-proxy</a></div></li>
<li class="level3"><div class="li"><a href="dnscrypt#dnsmasq">dnsmasq</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="dnscrypt#client_configuration">Client configuration</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="dnscrypt#linux">Linux</a></div></li>
<li class="level3"><div class="li"><a href="dnscrypt#windows">Windows</a></div></li>
<li class="level3"><div class="li"><a href="dnscrypt#mac_os_x">Mac OS X</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="dnscrypt#troubleshooting">Troubleshooting</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="dnscrypt#how_to_check_what_features_are_supported_by_your_resolver">How to check what features are supported by your resolver</a></div></li>
<li class="level2"><div class="li"><a href="dnscrypt#how_to_check_if_your_dns_queries_are_using_dnscrypt">How to check if your DNS queries are using dnscrypt</a></div></li>
<li class="level2"><div class="li"><a href="dnscrypt#how_to_check_if_dnscrypt-proxy_is_set_up_and_running">How to check if dnscrypt-proxy is set up and running</a></div></li>
<li class="level2"><div class="li"><a href="dnscrypt#suspicious_certificate_received">Suspicious certificate received</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="dnscrypt#notes">Notes</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h2 class="sectionedit1" id="dnscrypt">DNSCrypt</h2>
<div class="level2">

<p>
DNSCrypt offers a way to protect clients against attacks related to the modification and manipulation of <abbr title="Domain Name System">DNS</abbr> traffic — The main objective of DNSCrypt is authentication of the communication channel between the client (you) and a resolver supporting the protocol — This will protect the client from <a href="http://www.google.com/search?q=man%20in%20the%20middle%20attacks&amp;btnI=lucky" class="interwiki iw_go" title="http://www.google.com/search?q=man%20in%20the%20middle%20attacks&amp;btnI=lucky">man in the middle attacks</a>. In addition, encryption of <abbr title="Domain Name System">DNS</abbr> communication improves the client&#039;s privacy. DNSCrypt is the <em>client-side</em> version of <a href="https://github.com/Cofyc/dnscrypt-wrapper" class="urlextern" title="https://github.com/Cofyc/dnscrypt-wrapper"  rel="nofollow">dnscrypt-wrapper</a>.
</p>
<div class="table sectionedit2"><table class="inline">
	<tr class="row0">
		<td class="col0"><img src="../_media/meta/icons/tango/48px-emblem-important.svg.png" class="media" alt="" /> The <a href="http://dnscrypt.org/" class="urlextern" title="http://dnscrypt.org/"  rel="nofollow">dnscrypt-proxy</a> client project is maintained by Frank Denis <a href="https://github.com/jedisct1/dnscrypt-proxy" class="urlextern" title="https://github.com/jedisct1/dnscrypt-proxy"  rel="nofollow">jedisct1</a></td>
	</tr>
</table></div>

</div>

<h2 class="sectionedit3" id="installation_on_ar71xx_platforms">Installation on ar71xx platforms</h2>
<div class="level2">

<p>
The OpenWrt package for ar71xx is maintained by <a href="https://github.com/black-roland/exOpenWrt" class="urlextern" title="https://github.com/black-roland/exOpenWrt"  rel="nofollow">black-roland</a>
</p>

<p>
This will install <code>dnscrypt-proxy</code> as well as any dependent libraries such as <code>libsodium</code>
</p>

<p>
Add third-party source to your opkg configuration file <code>/etc/opkg.conf</code> according to your OpenWRT version:
</p>

<p>
<strong>Barrier Breaker:</strong>
</p>
<pre class="code">src/gz exopenwrt http://exopenwrt.and.in.net/barrier_breaker/ar71xx/packages/exOpenWrt</pre>

<p>
<strong>Attitude Adjustment:</strong>
</p>
<pre class="code">src/gz exopenwrt http://exopenwrt.and.in.net/attitude_adjustment/ar71xx/packages</pre>

<p>
<strong>trunk:</strong>
</p>
<pre class="code">src/gz exopenwrt http://exopenwrt.and.in.net/trunk/ar71xx/packages/exOpenWrt</pre>

<p>
And proceed with the installation itself:
</p>
<pre class="code">$ opkg update
$ opkg install dnscrypt-proxy</pre>

<p>
<a href="https://forum.openwrt.org/viewtopic.php?id=36380" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=36380"  rel="nofollow">Forum thread</a>
</p>

</div>

<h2 class="sectionedit4" id="installation_on_x86_platforms">Installation on x86 platforms</h2>
<div class="level2">

<p>
The OpenWrt package for x86 is maintained by <a href="https://github.com/damianorenfer/dnscrypt-proxy-openwrt" class="urlextern" title="https://github.com/damianorenfer/dnscrypt-proxy-openwrt"  rel="nofollow">damianorenfer</a>
</p>

<p>
If not already done, install the CACert SSL certificates :
</p>
<pre class="code">root@OpenWrt:~# mkdir -p /etc/ssl/certs/
root@OpenWrt:~# wget -P /etc/ssl/certs/ http://curl.haxx.se/ca/cacert.pem</pre>

<p>
As DNSCrypt depends on libsodium, install it :
</p>
<pre class="code">root@OpenWrt:~# cd /tmp
root@OpenWrt:~# curl -OL --cacert /etc/ssl/certs/cacert.pem https://github.com/damianorenfer/libsodium-openwrt/raw/master/openwrt/bin/x86/libsodium_0.4.5-1_x86.ipk
root@OpenWrt:~# opkg install libsodium_0.4.5-1_x86.ipk
root@OpenWrt:~# rm -f libsodium*.ipk</pre>

<p>
Then get the dnscrypt-proxy package from GitHub :
</p>
<pre class="code">root@OpenWrt:~# cd /tmp
root@OpenWrt:~# curl -OL --cacert /etc/ssl/certs/cacert.pem https://github.com/damianorenfer/dnscrypt-proxy-openwrt/raw/master/bin/x86/packages/dnscrypt-proxy_1.4.0-1_x86.ipk
root@OpenWrt:~# opkg install dnscrypt-proxy_1.4.0-1_x86.ipk
root@OpenWrt:~# rm -f dnscrypt-proxy*.ipk</pre>

<p>
You can then follow the configuration section below. But default port is <code>5353</code> and <strong>NOT</strong> <code>2053</code>! Change it in <code>/etc/config/dnscrypt-proxy</code> if needed.
</p>

<p>
Note : this is only for x86 systems, but if you have some OpenWrt knowledge you can compile the packages for your platform. Procedure briefly described at <a href="https://github.com/damianorenfer/dnscrypt-proxy-openwrt" class="urlextern" title="https://github.com/damianorenfer/dnscrypt-proxy-openwrt"  rel="nofollow">https://github.com/damianorenfer/dnscrypt-proxy-openwrt</a>
</p>

</div>

<h2 class="sectionedit5" id="configuration">Configuration</h2>
<div class="level2">

<p>
DNSCrypt is listening on address and port: <code>127.0.0.1:2053</code>. We need to set OpenWRT to send <abbr title="Domain Name System">DNS</abbr> request to that address.
</p>

</div>

<h3 class="sectionedit6" id="server_configuration">Server configuration</h3>
<div class="level3">

</div>

<h4 id="dnscrypt-proxy">dnscrypt-proxy</h4>
<div class="level4">

<p>
The config file <code>/etc/config/dnscrypt-proxy</code> is simple and should be edited according to your needs. Possible values for the &#039;resolver&#039; option are the first column in the list of <a href="https://github.com/jedisct1/dnscrypt-proxy/blob/master/dnscrypt-resolvers.csv" class="urlextern" title="https://github.com/jedisct1/dnscrypt-proxy/blob/master/dnscrypt-resolvers.csv"  rel="nofollow">public DNSCrypt resolvers</a>.
</p>
<div class="table sectionedit7"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>config dnscrypt-proxy
        option address &#039;127.0.0.1&#039;
        option port    &#039;2053&#039;
      # option resolver        &#039;opendns&#039;
      # option resolvers_list  &#039;/usr/share/dnscrypt-proxy/dnscrypt-resolvers.csv&#039;
</code></td>
	</tr>
</table></div>

<p>
Description:
</p>
<div class="table sectionedit8"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>address</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> <code>127.0.0.1</code> </td><td class="col4"> The IP address of the proxy server. </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>port</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> <code>2053</code> </td><td class="col4"> Listening port for <abbr title="Domain Name System">DNS</abbr> queries. </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>resolver</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>opendns</code> </td><td class="col4"> <abbr title="Domain Name System">DNS</abbr> service for resolving queries </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>resolvers_list</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>/usr/share/dnscrypt-proxy/dnscrypt-resolvers.csv</code> </td><td class="col4"> Location of CSV file containing list of resolvers </td>
	</tr>
</table></div>

<p>
If you need to specify other options, you will have to edit the <code>/etc/init.d/dnscrypt-proxy</code> script.
</p>

<p>
<em>Note: I&#039;ve had a little bit of confusion at setup, so I want to remind you; address and port strings are for local proxy server,  you just have to pick a dnscrypt server from the resolvers list, put its name in resolver string and comment out resolvers and resolvers list settings.</em>
</p>

<p>
Now we will start DNSCrypt and enable auto boot for it:
</p>
<pre class="code">/etc/init.d/dnscrypt-proxy enable
/etc/init.d/dnscrypt-proxy start</pre>

<p>
Note: If dnscrypt-proxy is not starting after a router reboot, it may be trying to start before the network interface is fully up. Add the following to <code>/etc/rc.local</code>, above the line &quot;exit 0&quot;:
</p>
<pre class="code">sleep 10
/etc/init.d/dnscrypt-proxy start</pre>

</div>

<h4 id="dnsmasq">dnsmasq</h4>
<div class="level4">

<p>
Assuming you are using <code>dnsmasq</code>, edit the bold lines in <code>/etc/config/dhcp</code>
</p>
<div class="table sectionedit9"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>config dnsmasq
    option domainneeded         1
    option boguspriv            1
    option filterwin2k          0
    option localise_queries     1
    option rebind_protection    1
    option rebind_localhost     1
    option local                &#039;/lan/&#039;
    option domain               &#039;lan&#039;
    option expandhosts          1
    option nonegcache           0
    option authoritative        1
    option readethers           1
    option leasefile            &#039;/tmp/dhcp.leases&#039;
<strong>#   option resolvfile           &#039;/tmp/resolv.conf.auto&#039;</strong>
<strong>    option noresolv             1</strong>
<strong>    list server                 &#039;127.0.0.1#2053&#039;</strong>
<strong>    list server                 &#039;/pool.ntp.org/208.67.222.222&#039;</strong>
#   list server                 &#039;208.67.222.222&#039;
#   list server                 &#039;208.67.220.220&#039;
</code></td>
	</tr>
</table></div>
<ul>
<li class="level1"><div class="li"> We have disabled <code>/tmp/resolv.conf.auto</code> file since it instruct <code>dnsmasq</code> to use your ISP&#039;s <abbr title="Domain Name System">DNS</abbr>.</div>
</li>
<li class="level1"><div class="li"> <code>noresolv</code> option also disables <code>/etc/resolv.conf</code> file for similar reason.</div>
</li>
<li class="level1"><div class="li"> <code>127.0.0.1#2053</code> is the DNSCrypt address.</div>
</li>
<li class="level1"><div class="li"> <code>/pool.ntp.org/208.67.222.222</code> adds an exception for pool.ntp.org, which will be resolved through the standard unencrypted <abbr title="Domain Name System">DNS</abbr> channel. DNSCrypt requires precise time, otherwise it will not resolve any domain, including pool.ntp.org. So if your device&#039;s time was incorrect, it could never update its time, and therefore DNSCrypt would never work. So we set this exception so that pool.ntp.org queries will always bypass DNSCrypt and resolve with the standard unencrypted OpenDNS method.</div>
</li>
</ul>

<p>
Reboot router or restart <code>dnsmasq</code> for the changes to take effect.
</p>
<pre class="code">/etc/init.d/dnsmasq restart</pre>

</div>

<h3 class="sectionedit10" id="client_configuration">Client configuration</h3>
<div class="level3">

<p>
<em>Note: you may need admin privileges to run the commands below.</em>
</p>

</div>

<h4 id="linux">Linux</h4>
<div class="level4">
<pre class="code">sudo /etc/init.d/nscd restart</pre>

<p>
or
</p>
<pre class="code">sudo /etc/init.d/networking restart</pre>

</div>

<h4 id="windows">Windows</h4>
<div class="level4">
<pre class="code">ipconfig /flushdns</pre>

</div>

<h4 id="mac_os_x">Mac OS X</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> Mac OSX 10.4 (Tiger)</div>
<ul>
<li class="level2"><div class="li"> <pre class="code">lookupd -flushcache</pre>
</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Mac OSX 10.5/10.6 (Leopard/Snow Leopard)</div>
<ul>
<li class="level2"><div class="li"> <pre class="code">dscacheutil -flushcache</pre>
</div>
</li>
</ul>
</li>
</ul>

</div>

<h2 class="sectionedit11" id="troubleshooting">Troubleshooting</h2>
<div class="level2">

</div>

<h3 class="sectionedit12" id="how_to_check_what_features_are_supported_by_your_resolver">How to check what features are supported by your resolver</h3>
<div class="level3">
<ol>
<li class="level1"><div class="li"> The <a href="https://www.dns-oarc.net/oarc/services/dnsentropy/" class="urlextern" title="https://www.dns-oarc.net/oarc/services/dnsentropy/"  rel="nofollow">DNS randomness test</a> will show the actual IP of your <abbr title="Domain Name System">DNS</abbr>. You can check <a href="http://bgp.he.net" class="urlextern" title="http://bgp.he.net"  rel="nofollow">here</a> if the IP is associated with the service you are using (put the IP in the <em>search</em> field).</div>
</li>
<li class="level1"><div class="li"> <a href="http://dnssec.vs.uni-due.de/" class="urlextern" title="http://dnssec.vs.uni-due.de/"  rel="nofollow">DNSSEC resolver test</a> determines whether your <abbr title="Domain Name System">DNS</abbr> resolver validates DNSSEC signatures.</div>
</li>
<li class="level1"><div class="li"> If you can access <a href="http://dnscrypt.bit" class="urlextern" title="http://dnscrypt.bit"  rel="nofollow">DNSCrypt.bit</a>, your resolver can resolve domain names using <a href="http://namecoin.info/" class="urlextern" title="http://namecoin.info/"  rel="nofollow">Namecoin</a>.</div>
</li>
</ol>

</div>

<h3 class="sectionedit13" id="how_to_check_if_your_dns_queries_are_using_dnscrypt">How to check if your DNS queries are using dnscrypt</h3>
<div class="level3">

<p>
On the router:
</p>
<pre class="code">pkill -STOP dnscrypt-proxy</pre>

<p>
<abbr title="Domain Name System">DNS</abbr> resolution should not work any more.
</p>

<p>
To restore service, unfreeze the client proxy:
</p>
<pre class="code">pkill -CONT dnscrypt-proxy</pre>

</div>

<h3 class="sectionedit14" id="how_to_check_if_dnscrypt-proxy_is_set_up_and_running">How to check if dnscrypt-proxy is set up and running</h3>
<div class="level3">

<p>
The easy way is to look in the log.
</p>
<ol>
<li class="level1"><div class="li"> Check if <code>dnsmasq</code> is using only dnscrypt. Only the last block of logged nameservers is relevant.</div>
<ul>
<li class="level2"><div class="li"> <pre class="code">logread | grep -n &quot;using nameserver&quot;</pre>
</div>
</li>
<li class="level2"><div class="li"> <pre class="code">132:Jan  1 01:01:00 openwrt daemon.info dnsmasq[1883]: using nameserver 208.67.222.222#53 for domain pool.ntp.org
133:Jan  1 01:01:00 openwrt daemon.info dnsmasq[1883]: using nameserver 127.0.0.1#2053</pre>
</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Check that <code>dnscrypt-proxy</code> is working.</div>
<ul>
<li class="level2"><div class="li"> <pre class="code">logread | grep &quot;Proxying from&quot;</pre>
</div>
</li>
<li class="level2"><div class="li"> <pre class="code">Jul 1 12:00:00 openwrt daemon.info dnscrypt-proxy[1831]: Proxying from 127.0.0.1:2053 to 208.67.220.220:443</pre>
</div>
</li>
</ul>
</li>
</ol>

</div>

<h3 class="sectionedit15" id="suspicious_certificate_received">Suspicious certificate received</h3>
<div class="level3">

<p>
A &quot;suspicious&quot; certificate can reported be reported:
</p>
<div class="table sectionedit16"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>root@OpenWrtRouter:/tmp# ./dnscrypt-proxy -R dnscrypt.eu-nl -a 127.0.0.1:2053
[INFO] Generating a new key pair
[INFO] Done
[ERROR] Suspicious certificate received
[ERROR] No useable certificates found
[INFO] Refetching server certificates
[ERROR] Suspicious certificate received
[ERROR] No useable certificates found</code></td>
	</tr>
</table></div>

<p>
Check the date and time on your router: this kind of behavior is usually caused by a system clock that hasn&#039;t been set properly.
</p>

</div>

<h2 class="sectionedit17" id="notes">Notes</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Updates are announced in forum <a href="https://forum.openwrt.org/viewtopic.php?id=36380" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=36380"  rel="nofollow">https://forum.openwrt.org/viewtopic.php?id=36380</a></div>
</li>
</ul>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>inbox/dnscrypt.txt</bdi> · Last modified: 2015/05/19 13:06 by <bdi>Artyom</bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="dnscrypt?do=edit"  class="action source" accesskey="v" rel="nofollow" title="Show pagesource [V]"><span>Show pagesource</span></a></li><li><a href="dnscrypt?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="dnscrypt?do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="dnscrypt#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license" class="urlextern">CC Attribution-Noncommercial-Share Alike 3.0 Unported</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license"><img src="../lib/images/license/button/cc-by-nc-sa.png" alt="CC Attribution-Noncommercial-Share Alike 3.0 Unported" /></a>        <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../lib/tpl/openwrt/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://www.php.net" title="Powered by PHP" ><img
            src="../lib/tpl/openwrt/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../lib/tpl/openwrt/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../lib/tpl/openwrt/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../lib/tpl/openwrt/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="../lib/exe/indexer.php?id=inbox%253Adnscrypt&amp;1432265557" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</body>
</html>
