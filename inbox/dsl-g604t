<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>D-Link DSL-G604T [OpenWrt Wiki]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="ar7,4flash,16ram"/>
<link rel="search" type="application/opensearchdescription+xml" href="../lib/exe/opensearch.php" title="OpenWrt Wiki"/>
<link rel="start" href="../index.html"/>
<link rel="contents" href="dsl-g604t?do=index" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Recent changes" href="../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="../feed.php?mode=list&amp;ns=inbox"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../_export/xhtml/inbox/dsl-g604t"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../_export/raw/inbox/dsl-g604t"/>
<link rel="canonical" href="dsl-g604t"/>
<link rel="stylesheet" type="text/css" href="../lib/exe/css.php?t=openwrt&amp;tseed=6f44f363dc87908d905dc56ff3acbfc4"/>
<script type="text/javascript">/*<![CDATA[*/var NS='inbox';var JSINFO = {"id":"inbox:dsl-g604t","namespace":"inbox"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../lib/exe/js.php?tseed=6f44f363dc87908d905dc56ff3acbfc4"></script>
<script type="text/javascript" charset="utf-8">/*<![CDATA[*/jQuery(function(){
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1432265567 166.182.3.5';
			document.forms[i].appendChild(myElement);
		}
	}
});
/*!]]>*/</script>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../lib/tpl/openwrt/images/favicon.ico" />
<link rel="apple-touch-icon" href="../lib/tpl/openwrt/images/apple-touch-icon.png" />
    </head>

<body>
    <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_openwrt     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="dsl-g604t#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="../start"  accesskey="h" title="[H]"><img src="../lib/tpl/openwrt/images/logo.png" width="386" height="98" alt="" /> <span>OpenWrt Wiki</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="dsl-g604t?do=register"  class="action register" rel="nofollow" title="Register">Register</a></li><li><a href="dsl-g604t?do=login&amp;sectok=382740b13d95f946eed36caa57076b4a"  class="action login" rel="nofollow" title="Login">Login</a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="../start" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="../doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="inbox:dsl-g604t" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Show pagesource</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Login</option><option value="register">Register</option></optgroup></select><input type="submit" value="&gt;" /></div></form>            </div>
            <ul>
                <li><a href="dsl-g604t?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a></li><li><a href="dsl-g604t?do=media&amp;ns=inbox"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a></li><li><a href="dsl-g604t?do=index"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                            <div class="youarehere"><span class="bchead">You are here: </span><span class="home"><bdi><a href="../start" class="wikilink1" title="start">OpenWrt Wiki</a></bdi></span> » <bdi><a href="start" class="wikilink1" title="inbox:start">Build and installation - Few Adjustments - NEW (shiva)</a></bdi> » <bdi><span class="curid"><a href="dsl-g604t" class="wikilink1" title="inbox:dsl-g604t">D-Link DSL-G604T</a></span></bdi></div>
                                    <div class="plugin_multilingual">
        <ul>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/cz/inbox/dsl-g604t" class="media" title="cz:inbox:dsl-g604t"><img src="../lib/exe/fetch.php?cache=&amp;tok=aff589&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fcz.gif" class="media" title="Čeština (Czech)" alt="Čeština (Czech)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/de/inbox/dsl-g604t" class="media" title="de:inbox:dsl-g604t"><img src="../lib/exe/fetch.php?cache=&amp;tok=e24010&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fde.gif" class="media" title="Deutsch (German)" alt="Deutsch (German)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <span class="curid"><a href="dsl-g604t" class="media" title="inbox:dsl-g604t"><img src="../lib/exe/fetch.php?cache=&amp;tok=2a37ae&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fgb.gif" class="media" title="English" alt="English" /></a></span>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/es/inbox/dsl-g604t" class="media" title="es:inbox:dsl-g604t"><img src="../lib/exe/fetch.php?cache=&amp;tok=46c004&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fmx.gif" class="media" title="Español (Spanish, Mexico)" alt="Español (Spanish, Mexico)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/fr/inbox/dsl-g604t" class="media" title="fr:inbox:dsl-g604t"><img src="../lib/exe/fetch.php?cache=&amp;tok=a5beba&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ffr.gif" class="media" title="Français (French)" alt="Français (French)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/hu/inbox/dsl-g604t" class="media" title="hu:inbox:dsl-g604t"><img src="../lib/exe/fetch.php?cache=&amp;tok=6b5470&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fhu.gif" class="media" title="Magyar (Hungarian)" alt="Magyar (Hungarian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/jp/inbox/dsl-g604t" class="media" title="jp:inbox:dsl-g604t"><img src="../lib/exe/fetch.php?cache=&amp;tok=f999fc&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fjp.gif" class="media" title="日本語 (Japanese)" alt="日本語 (Japanese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pl/inbox/dsl-g604t" class="media" title="pl:inbox:dsl-g604t"><img src="../lib/exe/fetch.php?cache=&amp;tok=c805c0&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fpl.gif" class="media" title="Poliski (Polish)" alt="Poliski (Polish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/pt-br/inbox/dsl-g604t" class="media" title="pt-br:inbox:dsl-g604t"><img src="../lib/exe/fetch.php?cache=&amp;tok=13127d&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fbr.gif" class="media" title="Português brasileiro (Portuguese, Brasil)" alt="Português brasileiro (Portuguese, Brasil)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/ru/inbox/dsl-g604t" class="media" title="ru:inbox:dsl-g604t"><img src="../lib/exe/fetch.php?cache=&amp;tok=66ab5e&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fru.gif" class="media" title="Русский (Russsian)" alt="Русский (Russsian)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/tr/inbox/dsl-g604t" class="media" title="tr:inbox:dsl-g604t"><img src="../lib/exe/fetch.php?cache=&amp;tok=f4beed&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Ftr.gif" class="media" title="Tϋrkçe (Turkish)" alt="Tϋrkçe (Turkish)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-cn/inbox/dsl-g604t" class="media" title="zh-cn:inbox:dsl-g604t"><img src="../lib/exe/fetch.php?cache=&amp;tok=93625a&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-cn.gif" class="media" title="官話/官话 (Chinese)" alt="官話/官话 (Chinese)" /></a>
              </div>
            </div>
          </li>
          <li>
            <div class="li">
              <div class="flag_not_exists">
                <a href="http://wiki.openwrt.org/zh-tw/inbox/dsl-g604t" class="media" title="zh-tw:inbox:dsl-g604t"><img src="../lib/exe/fetch.php?cache=&amp;tok=b56198&amp;media=http%253A%252F%252Fwiki.openwrt.org%252Flib%252Fplugins%252Fmultilingual%252Fflags%252Fzh-tw.gif" class="media" title="臺灣華語 (Taiwanese)" alt="臺灣華語 (Taiwanese)" /></a>
              </div>
            </div>
          </li>
        </ul>
      </div>
        </div>
    
    
    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">

                <div class="pageId"><span>inbox:dsl-g604t</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level2"><div class="li"><a href="dsl-g604t#status">Status</a></div></li>
<li class="level1"><div class="li"><a href="dsl-g604t#info">Info</a></div></li>
<li class="level1"><div class="li"><a href="dsl-g604t#image_generation">Image Generation</a></div></li>
<li class="level1"><div class="li"><a href="dsl-g604t#oem_easy_installation">OEM &#039;Easy&#039; Installation</a></div></li>
<li class="level2"><div class="li"><a href="dsl-g604t#adam2_access">ADAM2 Access</a></div></li>
<li class="level2"><div class="li"><a href="dsl-g604t#partitioning">Partitioning</a></div></li>
<li class="level2"><div class="li"><a href="dsl-g604t#flashing">Flashing</a></div></li>
<li class="level1"><div class="li"><a href="dsl-g604t#configuration">Configuration</a></div></li>
<li class="level2"><div class="li"><a href="dsl-g604t#wan">WAN</a></div></li>
<li class="level2"><div class="li"><a href="dsl-g604t#switch">Switch</a></div></li>
<li class="level2"><div class="li"><a href="dsl-g604t#tags">Tags</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="d-link_dsl-g604t">D-Link DSL-G604T</h1>
<div class="level1">

<p>
D-Link DSL-G604T ADSL2/2+ Wireless Router
</p>

</div>

<h3 class="sectionedit2" id="status">Status</h3>
<div class="level3">

<p>
Works reliably for basic DSL, Ethernet operations. Wireless it still under development, cant vouch for how well that works currently.
</p>

</div>

<h2 class="sectionedit3" id="info">Info</h2>
<div class="level2">
<div class="table sectionedit4"><table class="inline">
	<tr class="row0">
		<td class="col0"> <strong>Architecture:</strong> MIPS (little endian) </td>
	</tr>
	<tr class="row1">
		<td class="col0"> <strong>Vendor:</strong> D-Link </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <strong>Bootloader:</strong> ADAM2 </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <strong>System-On-Chip:</strong> TI AR7 TNETD7300 </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <strong>CPU Speed:</strong> 150 Mhz </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <strong>Flash Size:</strong> 4 MiB </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <strong>RAM Size:</strong> 16 MiB </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <strong>Wireless:</strong> TI ACX111 </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <strong>Ethernet:</strong> IP175A </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <strong>ADSL:</strong> TI AR7, ADSL2/2+ (up to 24Mbit/s) </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <strong>USB:</strong> No </td>
	</tr>
</table></div>

</div>

<h2 class="sectionedit5" id="image_generation">Image Generation</h2>
<div class="level2">

<p>
For the sake of keeping up to date use trunk, these settings where verified as working at revision 22452. Changes from the defaults are marked <strong>Disable</strong> that generated a working cutdown image.
</p>

<p>
<img src="../lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> Why disable wireless?
<img src="../lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> Maybe enable mac80211-based wireless instead?
</p>
<div class="table sectionedit6"><table class="inline">
	<tr class="row0">
		<td class="col0"><pre class="code">Target System (TI AR7)
Target Profile (Annex-A DSL firmware (default))
Target Images ---&gt; JFFS2 **Disable**

Base system ---&gt; wireless-tools **Disable** Note: Need to disable kmod-acx to turn this off.

Kernel modules ---&gt; Network Devices ---&gt; kmod-sangam-atm-annex-a ---&gt; Configuration ---&gt; Firmware ---&gt; D7.05.01.00
Kernel modules ---&gt; Wireless Drivers ---&gt; kmod-acx **Disable**</pre>
</td>
	</tr>
</table></div>

<p>
NOTE: For some ISPs, you may need to select &quot;Annex-B DSL firmware&quot; and &quot;kmod-sangam-atm-annex-b&quot; instead of their annex-A equivalents.
</p>

<p>
<img src="../lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> For installs from OEM Firmware does the checksum from the tichsum utility need to be added for adam2 to boot it? Doesn&#039;t need once OpenWRT is on as ADAM2 gets patched. You can find some information about the tichsum utility here
<a href="http://www.seattlewireless.net/DlinkDslG604t" class="urlextern" title="http://www.seattlewireless.net/DlinkDslG604t"  rel="nofollow">http://www.seattlewireless.net/DlinkDslG604t</a>
</p>

</div>

<h2 class="sectionedit7" id="oem_easy_installation">OEM &#039;Easy&#039; Installation</h2>
<div class="level2">

</div>

<h3 class="sectionedit8" id="adam2_access">ADAM2 Access</h3>
<div class="level3">

<p>
Before flashing OpenWRT to the device the <abbr title="File Transfer Protocol">FTP</abbr> server ADAM2 starts needs to be found, if the stock firmware is loaded on this model the steps are as such;
</p>

<p>
Connect to router with telnet, <strong>Username and password is admin</strong> (try root/admin if it does not work)
Query the ADAM2 enviroment to discover the IP with;
</p>
<div class="table sectionedit9"><table class="inline">
	<tr class="row0">
		<td class="col0"><pre class="code"># cat /proc/ticfg/env | grep my_ipaddress</pre>
</td>
	</tr>
</table></div>

<p>
If the IP is set it will be shown like this:
</p>
<div class="table sectionedit10"><table class="inline">
	<tr class="row0">
		<td class="col0"><pre class="code">my_ipaddress    10.8.8.8</pre>
</td>
	</tr>
</table></div>

<p>
If it&#039;s not displayed, or to change it, it can be set with the command:
</p>
<div class="table sectionedit11"><table class="inline">
	<tr class="row0">
		<td class="col0"><pre class="code"># echo &quot;my_ipaddress 192.168.1.1&quot; &gt; /proc/sys/dev/adam2/environment</pre>
</td>
	</tr>
</table></div>

<p>
Set a static IP so a connection to the router can be established, and apply power to the router. There will be a few second window where a connection can established with <abbr title="File Transfer Protocol">FTP</abbr>, <strong>Username and Password is adam2</strong>
</p>

</div>

<h3 class="sectionedit12" id="partitioning">Partitioning</h3>
<div class="level3">

<p>
The flash on the G604T device is divided into partitions. The offsets need to be changed to start OpenWrt on the device.
</p>

<p>
The original firmware uses these partitions (in <strong>physical</strong> order):
</p>
<div class="table sectionedit13"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Bootloader name </th><th class="col1"> start </th><th class="col2"> end </th><th class="col3"> size </th><th class="col4"> use </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> mtd2 </td><td class="col1"> 0x90000000 </td><td class="col2"> 0x90010000 </td><td class="col3"> 64 KiB </td><td class="col4"> Bootloader </td>
	</tr>
	<tr class="row2">
		<td class="col0"> mtd1 </td><td class="col1"> 0x90010090 </td><td class="col2"> 0x90091000 </td><td class="col3"> ~516 KiB </td><td class="col4"> Kernel </td>
	</tr>
	<tr class="row3">
		<td class="col0"> mtd0 </td><td class="col1"> 0x90091000 </td><td class="col2"> 0x903f0000 </td><td class="col3"> 3452 KiB </td><td class="col4"> Root filesystem </td>
	</tr>
	<tr class="row4">
		<td class="col0"> mtd3 </td><td class="col1"> 0x903f0000 </td><td class="col2"> 0x90400000 </td><td class="col3"> 64 KiB </td><td class="col4"> Configuration </td>
	</tr>
</table></div>

<p>
and another &quot;virtual&quot; partition&quot; that covers both mtd1 and mtd0
</p>
<div class="table sectionedit14"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Bootloader name </th><th class="col1"> start </th><th class="col2"> end </th><th class="col3"> size </th><th class="col4"> use </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> mtd4 </td><td class="col1"> 0x90010000 </td><td class="col2"> 0x903f0000 </td><td class="col3"> 3968 KiB </td><td class="col4"> Kernel + FS </td>
	</tr>
</table></div>

<p>
The <em>mtd2</em> partition contains the bootloader. <strong>Never</strong> touch it. If the bootloader gets corrupted, the router won&#039;t boot anymore (in that case reprogramming the entire flash with the JTAG should bring it back to life). Just to be safe, during normal usage the kernel won&#039;t allow you to overwrite it even if explicitly requested.
</p>

<p>
The <em>mtd3</em> partition contains both the bootloader configuration and the original firmware settings. OpenWrt will ignore anything written in here. Don&#039;t touch it as well, or ADAM2 might get confused and unable to boot anymore.
</p>

<p>
To run OpenWRT of this device the partition layout need to be modified as follows (changes are in <strong>bold</strong>), the offset from the image generation section is needed here.
</p>

<p>
Partitions: (in physical ordering):
</p>
<div class="table sectionedit15"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Bootloader name </th><th class="col1"> Kernel name </th><th class="col2"> Start </th><th class="col3"> End </th><th class="col4"> Use </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> mtd2 </td><td class="col1"> loader </td><td class="col2"> 0x90000000 </td><td class="col3"> 0x90010000 </td><td class="col4"> Bootloader (ADAM2) </td>
	</tr>
	<tr class="row2">
		<td class="col0"> mtd1 </td><td class="col1 leftalign"> linux  </td><td class="col2"> <strong>0x90010000</strong> </td><td class="col3"> <strong>0x903f0000</strong> </td><td class="col4"> Linux kernel (only the start address is used) </td>
	</tr>
	<tr class="row3">
		<td class="col0"> mtd0 </td><td class="col1"> rootfs </td><td class="col2"> <strong>0x90010000</strong> </td><td class="col3"> <strong>0x903f0000</strong> </td><td class="col4"> Read-only squashfs + jffs2 filesystem (only the end address is used) </td>
	</tr>
	<tr class="row4">
		<td class="col0"> mtd3 </td><td class="col1"> config </td><td class="col2"> 0x903f0000 </td><td class="col3"> 0x90400000 </td><td class="col4"> Original firmware configuration </td>
	</tr>
</table></div>

<p>
the &quot;virtual&quot; partition remains unchanged as
</p>
<div class="table sectionedit16"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Bootloader name </th><th class="col1"> Kernel name </th><th class="col2"> Start </th><th class="col3"> End </th><th class="col4"> Use </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> mtd4 </td><td class="col1"> rootfs_data </td><td class="col2"> 0x90010000 </td><td class="col3"> 0x903f0000 </td><td class="col4"> Kernel + FS </td>
	</tr>
</table></div>

<p>
To be more precise, the kernel, once booted, will map another &quot;virtual&quot; partiton as <em>/dev/mtdblock4</em> that will point to the newly created jffs2 partition located inside mtd0. Just ignore it for this discussion.
</p>

<p>
Note that the end of mtd1 and the start of mtd0 are dummy addresses; OpenWrt auto-detects the boundary between the kernel and the file system. The extra addresses are only used by firmwares based on 2.4.x kernels.
</p>

<p>
The commands needed to make and check the above adjustments are;
</p>
<div class="table sectionedit17"><table class="inline">
	<tr class="row0">
		<td class="col0"><pre class="code">quote &quot;SETENV mtd1,0x90010000,0x903f0000&quot;
quote &quot;GETENV mtd1&quot;</pre>
</td>
	</tr>
</table></div>

<p>
Check each partition before continuing, error here will likely brick the device.
</p>

</div>

<h3 class="sectionedit18" id="flashing">Flashing</h3>
<div class="level3">

<p>
When this has been completed the image can be flashed to the Kernel+FS partition <em>mtd4</em>
</p>
<div class="table sectionedit19"><table class="inline">
	<tr class="row0">
		<td class="col0"><pre class="code">quote &quot;MEDIA FLSH&quot;
binary
debug
hash
put &quot;openwrt-ar7-squashfs.bin&quot; &quot;openwrt-ar7-squashfs.bin mtd4&quot;
quote REBOOT
quit</pre>
</td>
	</tr>
</table></div>

<p>
The router will reboot and set itself up, do not remove power as this could break it. Leave it until the status light has a steady heartbeat, then it is safe to power down.
</p>

<p>
<strong>There is a problem with some ftp clients relating to window size and retransmissions, if you are running linux and flashing is way too slow, you might need to change the window size. to do this from a terminal:</strong>
</p>
<div class="table sectionedit20"><table class="inline">
	<tr class="row0">
		<td class="col0"><pre class="code">$sudo su
#echo 0 512 512 &gt; /proc/sys/net/ipv4/tcp_wmem</pre>
</td>
	</tr>
</table></div>

</div>

<h2 class="sectionedit21" id="configuration">Configuration</h2>
<div class="level2">

</div>

<h3 class="sectionedit22" id="wan">WAN</h3>
<div class="level3">

<p>
To bring the WAN up, add the settings to the <em> /etc/config/network </em> file
</p>
<div class="table sectionedit23"><table class="inline">
	<tr class="row0">
		<td class="col0"><pre class="code">config interface wan
        option ifname   ppp0
        option unit     0
        option proto    pppoa
        option encaps   vc
        option vpi      0 # get your actual VPI and VCI from your ISP
        option vci      38
        option username (your username here)
        option password (your password here)</pre>
</td>
	</tr>
</table></div>

<p>
If your ISP uses pppoe instead, the setup will looks like this:
</p>
<div class="table sectionedit24"><table class="inline">
	<tr class="row0">
		<td class="col0"><pre class="code">config atm-bridge
        option unit     0
        option encaps   llc
        option vpi      0 # get these from your ISP
        option vci      38

config interface wan
        option ifname   nas0
        option proto    pppoe
        option username (your username here)
        option password (your password here)</pre>
</td>
	</tr>
</table></div>

</div>

<h3 class="sectionedit25" id="switch">Switch</h3>
<div class="level3">

<p>
As of r22728 the switch can be configured in this device, the drivers are included by default as is swconfig. The switch is a 5 port switch only 0-3 are available as ethernet ports and 4 is the CPU port.
Documentation on configuring the switch can be found <a href="../doc/uci/network/switch" class="wikilink1" title="doc:uci:network:switch">here</a>
</p>

</div>

<h3 class="sectionedit26" id="tags">Tags</h3>
<div class="level3">
<div class="tags"><span>
	<a href="../tag/ar7?do=showtag&amp;tag=ar7" class="wikilink1" title="tag:ar7" rel="tag">ar7</a>,
	<a href="../tag/4flash?do=showtag&amp;tag=4Flash" class="wikilink1" title="tag:4flash" rel="tag">4Flash</a>,
	<a href="../tag/16ram?do=showtag&amp;tag=16RAM" class="wikilink1" title="tag:16ram" rel="tag">16RAM</a>
</span></div>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>inbox/dsl-g604t.txt</bdi> · Last modified: 2014/09/12 01:21 by <bdi>yussi</bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="dsl-g604t?do=edit"  class="action source" accesskey="v" rel="nofollow" title="Show pagesource [V]"><span>Show pagesource</span></a></li><li><a href="dsl-g604t?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="dsl-g604t?do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="dsl-g604t#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license" class="urlextern">CC Attribution-Noncommercial-Share Alike 3.0 Unported</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license"><img src="../lib/images/license/button/cc-by-nc-sa.png" alt="CC Attribution-Noncommercial-Share Alike 3.0 Unported" /></a>        <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../lib/tpl/openwrt/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://www.php.net" title="Powered by PHP" ><img
            src="../lib/tpl/openwrt/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../lib/tpl/openwrt/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../lib/tpl/openwrt/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../lib/tpl/openwrt/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="../lib/exe/indexer.php?id=inbox%253Adsl-g604t&amp;1432265567" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</body>
</html>
